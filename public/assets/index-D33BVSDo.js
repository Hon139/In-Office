var Es=Math.pow;(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var As={};/*!
 * melonJS Game Engine - v17.4.0
 * http://www.melonjs.org
 * melonjs is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * @copyright (C) 2011 - 2024 Olivier Biot (AltByte Pte Ltd)
 */var Be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Da(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ht=function(s){return s&&s.Math===Math&&s},pe=Ht(typeof globalThis=="object"&&globalThis)||Ht(typeof window=="object"&&window)||Ht(typeof self=="object"&&self)||Ht(typeof Be=="object"&&Be)||Ht(typeof Be=="object"&&Be)||function(){return this}()||Function("return this")(),Yr={},Ue=function(s){try{return!!s()}catch(e){return!0}},iu=Ue,_t=!iu(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),su=Ue,Na=!su(function(){var s=function(){}.bind();return typeof s!="function"||s.hasOwnProperty("prototype")}),ru=Na,wi=Function.prototype.call,Wr=ru?wi.bind(wi):function(){return wi.apply(wi,arguments)},ka={},Fa={}.propertyIsEnumerable,$a=Object.getOwnPropertyDescriptor,nu=$a&&!Fa.call({1:2},1);ka.f=nu?function(e){var t=$a(this,e);return!!t&&t.enumerable}:Fa;var Ua=function(s,e){return{enumerable:!(s&1),configurable:!(s&2),writable:!(s&4),value:e}},Va=Na,za=Function.prototype,nr=za.call,ou=Va&&za.bind.bind(nr,nr),be=Va?ou:function(s){return function(){return nr.apply(s,arguments)}},Ga=be,au=Ga({}.toString),lu=Ga("".slice),ja=function(s){return lu(au(s),8,-1)},hu=be,uu=Ue,fu=ja,Ss=Object,cu=hu("".split),du=uu(function(){return!Ss("z").propertyIsEnumerable(0)})?function(s){return fu(s)==="String"?cu(s,""):Ss(s)}:Ss,Xa=function(s){return s==null},pu=Xa,gu=TypeError,Kr=function(s){if(pu(s))throw new gu("Can't call method on "+s);return s},yu=du,mu=Kr,qr=function(s){return yu(mu(s))},Cs=typeof document=="object"&&document.all,we=typeof Cs=="undefined"&&Cs!==void 0?function(s){return typeof s=="function"||s===Cs}:function(s){return typeof s=="function"},vu=we,rs=function(s){return typeof s=="object"?s!==null:vu(s)},Ps=pe,_u=we,xu=function(s){return _u(s)?s:void 0},Ha=function(s,e){return arguments.length<2?xu(Ps[s]):Ps[s]&&Ps[s][e]},bu=be,wu=bu({}.isPrototypeOf),Tu=typeof navigator!="undefined"&&String(navigator.userAgent)||"",Ya=pe,Rs=Tu,Un=Ya.process,Vn=Ya.Deno,zn=Un&&Un.versions||Vn&&Vn.version,Gn=zn&&zn.v8,me,Vi;Gn&&(me=Gn.split("."),Vi=me[0]>0&&me[0]<4?1:+(me[0]+me[1]));!Vi&&Rs&&(me=Rs.match(/Edge\/(\d+)/),(!me||me[1]>=74)&&(me=Rs.match(/Chrome\/(\d+)/),me&&(Vi=+me[1])));var Eu=Vi,jn=Eu,Au=Ue,Su=pe,Cu=Su.String,Wa=!!Object.getOwnPropertySymbols&&!Au(function(){var s=Symbol("symbol detection");return!Cu(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&jn&&jn<41}),Pu=Wa,Ka=Pu&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ru=Ha,Iu=we,Ou=wu,Mu=Ka,Lu=Object,qa=Mu?function(s){return typeof s=="symbol"}:function(s){var e=Ru("Symbol");return Iu(e)&&Ou(e.prototype,Lu(s))},Bu=String,Du=function(s){try{return Bu(s)}catch(e){return"Object"}},Nu=we,ku=Du,Fu=TypeError,$u=function(s){if(Nu(s))return s;throw new Fu(ku(s)+" is not a function")},Uu=$u,Vu=Xa,zu=function(s,e){var t=s[e];return Vu(t)?void 0:Uu(t)},Is=Wr,Os=we,Ms=rs,Gu=TypeError,ju=function(s,e){var t,i;if(e==="string"&&Os(t=s.toString)&&!Ms(i=Is(t,s))||Os(t=s.valueOf)&&!Ms(i=Is(t,s))||e!=="string"&&Os(t=s.toString)&&!Ms(i=Is(t,s)))return i;throw new Gu("Can't convert object to primitive value")},Za={exports:{}},Xn=pe,Xu=Object.defineProperty,Zr=function(s,e){try{Xu(Xn,s,{value:e,configurable:!0,writable:!0})}catch(t){Xn[s]=e}return e},Hu=pe,Yu=Zr,Hn="__core-js_shared__",Yn=Za.exports=Hu[Hn]||Yu(Hn,{});(Yn.versions||(Yn.versions=[])).push({version:"3.37.1",mode:"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qr=Za.exports,Wn=Qr,Qa=function(s,e){return Wn[s]||(Wn[s]=e||{})},Wu=Kr,Ku=Object,qu=function(s){return Ku(Wu(s))},Zu=be,Qu=qu,Ju=Zu({}.hasOwnProperty),xt=Object.hasOwn||function(e,t){return Ju(Qu(e),t)},ef=be,tf=0,sf=Math.random(),rf=ef(1 .toString),Ja=function(s){return"Symbol("+(s===void 0?"":s)+")_"+rf(++tf+sf,36)},nf=pe,of=Qa,Kn=xt,af=Ja,lf=Wa,hf=Ka,Rt=nf.Symbol,Ls=of("wks"),uf=hf?Rt.for||Rt:Rt&&Rt.withoutSetter||af,Jr=function(s){return Kn(Ls,s)||(Ls[s]=lf&&Kn(Rt,s)?Rt[s]:uf("Symbol."+s)),Ls[s]},ff=Wr,qn=rs,Zn=qa,cf=zu,df=ju,pf=Jr,gf=TypeError,yf=pf("toPrimitive"),mf=function(s,e){if(!qn(s)||Zn(s))return s;var t=cf(s,yf),i;if(t){if(e===void 0&&(e="default"),i=ff(t,s,e),!qn(i)||Zn(i))return i;throw new gf("Can't convert object to primitive value")}return e===void 0&&(e="number"),df(s,e)},vf=mf,_f=qa,el=function(s){var e=vf(s,"string");return _f(e)?e:e+""},xf=pe,Qn=rs,or=xf.document,bf=Qn(or)&&Qn(or.createElement),wf=function(s){return bf?or.createElement(s):{}},Tf=_t,Ef=Ue,Af=wf,tl=!Tf&&!Ef(function(){return Object.defineProperty(Af("div"),"a",{get:function(){return 7}}).a!==7}),Sf=_t,Cf=Wr,Pf=ka,Rf=Ua,If=qr,Of=el,Mf=xt,Lf=tl,Jn=Object.getOwnPropertyDescriptor;Yr.f=Sf?Jn:function(e,t){if(e=If(e),t=Of(t),Lf)try{return Jn(e,t)}catch(i){}if(Mf(e,t))return Rf(!Cf(Pf.f,e,t),e[t])};var ns={},Bf=_t,Df=Ue,Nf=Bf&&Df(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),kf=rs,Ff=String,$f=TypeError,il=function(s){if(kf(s))return s;throw new $f(Ff(s)+" is not an object")},Uf=_t,Vf=tl,zf=Nf,Ti=il,eo=el,Gf=TypeError,Bs=Object.defineProperty,jf=Object.getOwnPropertyDescriptor,Ds="enumerable",Ns="configurable",ks="writable";ns.f=Uf?zf?function(e,t,i){if(Ti(e),t=eo(t),Ti(i),typeof e=="function"&&t==="prototype"&&"value"in i&&ks in i&&!i[ks]){var r=jf(e,t);r&&r[ks]&&(e[t]=i.value,i={configurable:Ns in i?i[Ns]:r[Ns],enumerable:Ds in i?i[Ds]:r[Ds],writable:!1})}return Bs(e,t,i)}:Bs:function(e,t,i){if(Ti(e),t=eo(t),Ti(i),Vf)try{return Bs(e,t,i)}catch(r){}if("get"in i||"set"in i)throw new Gf("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var Xf=_t,Hf=ns,Yf=Ua,sl=Xf?function(s,e,t){return Hf.f(s,e,Yf(1,t))}:function(s,e,t){return s[e]=t,s},rl={exports:{}},ar=_t,Wf=xt,nl=Function.prototype,Kf=ar&&Object.getOwnPropertyDescriptor,ol=Wf(nl,"name"),qf=ol&&function(){}.name==="something",Zf=ol&&(!ar||ar&&Kf(nl,"name").configurable),al={PROPER:qf,CONFIGURABLE:Zf},Qf=be,Jf=we,lr=Qr,ec=Qf(Function.toString);Jf(lr.inspectSource)||(lr.inspectSource=function(s){return ec(s)});var tc=lr.inspectSource,ic=pe,sc=we,to=ic.WeakMap,rc=sc(to)&&/native code/.test(String(to)),nc=Qa,oc=Ja,io=nc("keys"),ac=function(s){return io[s]||(io[s]=oc(s))},ll={},lc=rc,hl=pe,hc=sl,Fs=xt,$s=Qr,uc=ac,fc=ll,so="Object already initialized",ro=hl.TypeError,cc=hl.WeakMap,hr,zi,ur,dc=function(s){return ur(s)?zi(s):hr(s,{})};if(lc||$s.state){var Se=$s.state||($s.state=new cc);Se.get=Se.get,Se.has=Se.has,Se.set=Se.set,hr=function(s,e){if(Se.has(s))throw new ro(so);return e.facade=s,Se.set(s,e),e},zi=function(s){return Se.get(s)||{}},ur=function(s){return Se.has(s)}}else{var wt=uc("state");fc[wt]=!0,hr=function(s,e){if(Fs(s,wt))throw new ro(so);return e.facade=s,hc(s,wt,e),e},zi=function(s){return Fs(s,wt)?s[wt]:{}},ur=function(s){return Fs(s,wt)}}var pc={get:zi,enforce:dc},en=be,gc=Ue,yc=we,Ei=xt,fr=_t,mc=al.CONFIGURABLE,vc=tc,ul=pc,_c=ul.enforce,xc=ul.get,no=String,Fi=Object.defineProperty,bc=en("".slice),wc=en("".replace),Tc=en([].join),Ec=fr&&!gc(function(){return Fi(function(){},"length",{value:8}).length!==8}),Ac=String(String).split("String"),Sc=rl.exports=function(s,e,t){bc(no(e),0,7)==="Symbol("&&(e="["+wc(no(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Ei(s,"name")||mc&&s.name!==e)&&(fr?Fi(s,"name",{value:e,configurable:!0}):s.name=e),Ec&&t&&Ei(t,"arity")&&s.length!==t.arity&&Fi(s,"length",{value:t.arity});try{t&&Ei(t,"constructor")&&t.constructor?fr&&Fi(s,"prototype",{writable:!1}):s.prototype&&(s.prototype=void 0)}catch(r){}var i=_c(s);return Ei(i,"source")||(i.source=Tc(Ac,typeof e=="string"?e:"")),s};Function.prototype.toString=Sc(function(){return yc(this)&&xc(this).source||vc(this)},"toString");var Cc=rl.exports,Pc=we,Rc=ns,Ic=Cc,Oc=Zr,Mc=function(s,e,t,i){i||(i={});var r=i.enumerable,n=i.name!==void 0?i.name:e;if(Pc(t)&&Ic(t,n,i),i.global)r?s[e]=t:Oc(e,t);else{try{i.unsafe?s[e]&&(r=!0):delete s[e]}catch(o){}r?s[e]=t:Rc.f(s,e,{value:t,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return s},fl={},Lc=Math.ceil,Bc=Math.floor,Dc=Math.trunc||function(e){var t=+e;return(t>0?Bc:Lc)(t)},Nc=Dc,cl=function(s){var e=+s;return e!==e||e===0?0:Nc(e)},kc=cl,Fc=Math.max,$c=Math.min,Uc=function(s,e){var t=kc(s);return t<0?Fc(t+e,0):$c(t,e)},Vc=cl,zc=Math.min,Gc=function(s){var e=Vc(s);return e>0?zc(e,9007199254740991):0},jc=Gc,Xc=function(s){return jc(s.length)},Hc=qr,Yc=Uc,Wc=Xc,Kc=function(s){return function(e,t,i){var r=Hc(e),n=Wc(r);if(n===0)return!s&&-1;var o=Yc(i,n),l;if(s&&t!==t){for(;n>o;)if(l=r[o++],l!==l)return!0}else for(;n>o;o++)if((s||o in r)&&r[o]===t)return s||o||0;return!s&&-1}},qc={indexOf:Kc(!1)},Zc=be,Us=xt,Qc=qr,Jc=qc.indexOf,ed=ll,oo=Zc([].push),td=function(s,e){var t=Qc(s),i=0,r=[],n;for(n in t)!Us(ed,n)&&Us(t,n)&&oo(r,n);for(;e.length>i;)Us(t,n=e[i++])&&(~Jc(r,n)||oo(r,n));return r},id=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sd=td,rd=id,nd=rd.concat("length","prototype");fl.f=Object.getOwnPropertyNames||function(e){return sd(e,nd)};var dl={};dl.f=Object.getOwnPropertySymbols;var od=Ha,ad=be,ld=fl,hd=dl,ud=il,fd=ad([].concat),cd=od("Reflect","ownKeys")||function(e){var t=ld.f(ud(e)),i=hd.f;return i?fd(t,i(e)):t},ao=xt,dd=cd,pd=Yr,gd=ns,yd=function(s,e,t){for(var i=dd(e),r=gd.f,n=pd.f,o=0;o<i.length;o++){var l=i[o];!ao(s,l)&&!(t&&ao(t,l))&&r(s,l,n(e,l))}},md=Ue,vd=we,_d=/#|\.prototype\./,ci=function(s,e){var t=bd[xd(s)];return t===Td?!0:t===wd?!1:vd(e)?md(e):!!e},xd=ci.normalize=function(s){return String(s).replace(_d,".").toLowerCase()},bd=ci.data={},wd=ci.NATIVE="N",Td=ci.POLYFILL="P",Ed=ci,Ai=pe,Ad=Yr.f,Sd=sl,Cd=Mc,Pd=Zr,Rd=yd,Id=Ed,di=function(s,e){var t=s.target,i=s.global,r=s.stat,n,o,l,u,h,d;if(i?o=Ai:r?o=Ai[t]||Pd(t,{}):o=Ai[t]&&Ai[t].prototype,o)for(l in e){if(h=e[l],s.dontCallGetSet?(d=Ad(o,l),u=d&&d.value):u=o[l],n=Id(i?l:t+(r?".":"#")+l,s.forced),!n&&u!==void 0){if(typeof h==typeof u)continue;Rd(h,u)}(s.sham||u&&u.sham)&&Sd(h,"sham",!0),Cd(o,l,h,s)}},Od=di,Vs=pe;Od({global:!0,forced:Vs.globalThis!==Vs},{globalThis:Vs});var Md=Jr,Ld=Md("toStringTag"),pl={};pl[Ld]="z";var Bd=String(pl)==="[object z]",Dd=Bd,Nd=we,$i=ja,kd=Jr,Fd=kd("toStringTag"),$d=Object,Ud=$i(function(){return arguments}())==="Arguments",Vd=function(s,e){try{return s[e]}catch(t){}},zd=Dd?$i:function(s){var e,t,i;return s===void 0?"Undefined":s===null?"Null":typeof(t=Vd(e=$d(s),Fd))=="string"?t:Ud?$i(e):(i=$i(e))==="Object"&&Nd(e.callee)?"Arguments":i},Gd=zd,jd=String,Xd=function(s){if(Gd(s)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return jd(s)},gl=`	
\v\f\r                　\u2028\u2029\uFEFF`,Hd=be,Yd=Kr,Wd=Xd,cr=gl,lo=Hd("".replace),Kd=RegExp("^["+cr+"]+"),qd=RegExp("(^|[^"+cr+"])["+cr+"]+$"),ho=function(s){return function(e){var t=Wd(Yd(e));return s&1&&(t=lo(t,Kd,"")),s&2&&(t=lo(t,qd,"$1")),t}},yl={start:ho(1),end:ho(2)},Zd=al.PROPER,Qd=Ue,uo=gl,fo="​᠎",ml=function(s){return Qd(function(){return!!uo[s]()||fo[s]()!==fo||Zd&&uo[s].name!==s})},Jd=yl.start,ep=ml,vl=ep("trimStart")?function(){return Jd(this)}:"".trimStart,tp=di,co=vl;tp({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==co},{trimLeft:co});var ip=di,po=vl;ip({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==po},{trimStart:po});var sp=pe,rp=be,_l=function(s,e){return rp(sp[s].prototype[e])},np=_l;np("String","trimLeft");var op=yl.end,ap=ml,xl=ap("trimEnd")?function(){return op(this)}:"".trimEnd,lp=di,go=xl;lp({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==go},{trimRight:go});var hp=di,yo=xl;hp({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==yo},{trimEnd:yo});var up=_l;up("String","trimRight");typeof globalThis!="undefined"&&typeof globalThis.console=="undefined"&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});(()=>{function s(e,t,i,r,n){if(![e,t,i,r].every(m=>Number.isFinite(m)))return;n=c(n);let o,l,u,h;if(n.length===4)o=y(n[0]),l=y(n[1]),u=y(n[2]),h=y(n[3]);else if(n.length===3)o=y(n[0]),l=y(n[1]),h=y(n[1]),u=y(n[2]);else if(n.length===2)o=y(n[0]),u=y(n[0]),l=y(n[1]),h=y(n[1]);else if(n.length===1)o=y(n[0]),l=y(n[0]),u=y(n[0]),h=y(n[0]);else throw new Error(n.length+" is not a valid size for radii sequence.");const d=[o,l,u,h],a=d.find(({x:m,y:_})=>m<0||_<0);if(d.some(({x:m,y:_})=>!Number.isFinite(m)||!Number.isFinite(_)))return;if(a)throw new Error("Radius value "+a+" is negative.");v(d),i<0&&r<0?(this.moveTo(e-o.x,t),this.ellipse(e+i+l.x,t-l.y,l.x,l.y,0,-Math.PI*1.5,-Math.PI),this.ellipse(e+i+u.x,t+r+u.y,u.x,u.y,0,-Math.PI,-Math.PI/2),this.ellipse(e-h.x,t+r+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(e-o.x,t-o.y,o.x,o.y,0,0,-Math.PI/2)):i<0?(this.moveTo(e-o.x,t),this.ellipse(e+i+l.x,t+l.y,l.x,l.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(e+i+u.x,t+r-u.y,u.x,u.y,0,-Math.PI,-Math.PI*1.5,1),this.ellipse(e-h.x,t+r-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(e-o.x,t+o.y,o.x,o.y,0,0,-Math.PI/2,1)):r<0?(this.moveTo(e+o.x,t),this.ellipse(e+i-l.x,t-l.y,l.x,l.y,0,Math.PI/2,0,1),this.ellipse(e+i-u.x,t+r+u.y,u.x,u.y,0,0,-Math.PI/2,1),this.ellipse(e+h.x,t+r+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(e+o.x,t-o.y,o.x,o.y,0,-Math.PI,-Math.PI*1.5,1)):(this.moveTo(e+o.x,t),this.ellipse(e+i-l.x,t+l.y,l.x,l.y,0,-Math.PI/2,0),this.ellipse(e+i-u.x,t+r-u.y,u.x,u.y,0,0,Math.PI/2),this.ellipse(e+h.x,t+r-h.y,h.x,h.y,0,Math.PI/2,Math.PI),this.ellipse(e+o.x,t+o.y,o.x,o.y,0,Math.PI,Math.PI*1.5)),this.closePath(),this.moveTo(e,t);function f(m){const{x:_,y:x,z:b,w:E}=m;return{x:_,y:x,z:b,w:E}}function c(m){const _=typeof m;return _==="undefined"||m===null?[0]:_==="function"?[NaN]:_==="object"?typeof m[Symbol.iterator]=="function"?[...m].map(x=>{const b=typeof x;return b==="undefined"||x===null?0:b==="function"?NaN:b==="object"?f(x):p(x)}):[f(m)]:[p(m)]}function p(m){return+m}function y(m){const _=p(m);return Number.isFinite(_)?{x:_,y:_}:Object(m)===m?{x:p(m.x||0),y:p(m.y||0)}:{x:NaN,y:NaN}}function v(m){const[_,x,b,E]=m,S=[Math.abs(i)/(_.x+x.x),Math.abs(r)/(x.y+b.y),Math.abs(i)/(b.x+E.x),Math.abs(r)/(_.y+E.y)],I=Math.min(...S);I<=1&&m.forEach(j=>{j.x*=I,j.y*=I})}}globalThis.CanvasRenderingContext2D&&typeof globalThis.Path2D.prototype.roundRect=="undefined"&&(globalThis.Path2D.prototype.roundRect=s),globalThis.CanvasRenderingContext2D&&typeof globalThis.CanvasRenderingContext2D.prototype.roundRect=="undefined"&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=s),globalThis.OffscreenCanvasRenderingContext2D&&typeof globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=="undefined"&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=s)})();var te=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},ie={searchParams:"URLSearchParams"in te,iterable:"Symbol"in te&&"iterator"in Symbol,blob:"FileReader"in te&&"Blob"in te&&function(){try{return new Blob,!0}catch(s){return!1}}(),formData:"FormData"in te,arrayBuffer:"ArrayBuffer"in te};function fp(s){return s&&DataView.prototype.isPrototypeOf(s)}if(ie.arrayBuffer)var cp=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],dp=ArrayBuffer.isView||function(s){return s&&cp.indexOf(Object.prototype.toString.call(s))>-1};function zt(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(s)||s==="")throw new TypeError('Invalid character in header field name: "'+s+'"');return s.toLowerCase()}function tn(s){return typeof s!="string"&&(s=String(s)),s}function sn(s){var e={next:function(){var t=s.shift();return{done:t===void 0,value:t}}};return ie.iterable&&(e[Symbol.iterator]=function(){return e}),e}function J(s){this.map={},s instanceof J?s.forEach(function(e,t){this.append(t,e)},this):Array.isArray(s)?s.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):s&&Object.getOwnPropertyNames(s).forEach(function(e){this.append(e,s[e])},this)}J.prototype.append=function(s,e){s=zt(s),e=tn(e);var t=this.map[s];this.map[s]=t?t+", "+e:e};J.prototype.delete=function(s){delete this.map[zt(s)]};J.prototype.get=function(s){return s=zt(s),this.has(s)?this.map[s]:null};J.prototype.has=function(s){return this.map.hasOwnProperty(zt(s))};J.prototype.set=function(s,e){this.map[zt(s)]=tn(e)};J.prototype.forEach=function(s,e){for(var t in this.map)this.map.hasOwnProperty(t)&&s.call(e,this.map[t],t,this)};J.prototype.keys=function(){var s=[];return this.forEach(function(e,t){s.push(t)}),sn(s)};J.prototype.values=function(){var s=[];return this.forEach(function(e){s.push(e)}),sn(s)};J.prototype.entries=function(){var s=[];return this.forEach(function(e,t){s.push([t,e])}),sn(s)};ie.iterable&&(J.prototype[Symbol.iterator]=J.prototype.entries);function zs(s){if(!s._noBody){if(s.bodyUsed)return Promise.reject(new TypeError("Already read"));s.bodyUsed=!0}}function bl(s){return new Promise(function(e,t){s.onload=function(){e(s.result)},s.onerror=function(){t(s.error)}})}function pp(s){var e=new FileReader,t=bl(e);return e.readAsArrayBuffer(s),t}function gp(s){var e=new FileReader,t=bl(e),i=/charset=([A-Za-z0-9_-]+)/.exec(s.type),r=i?i[1]:"utf-8";return e.readAsText(s,r),t}function yp(s){for(var e=new Uint8Array(s),t=new Array(e.length),i=0;i<e.length;i++)t[i]=String.fromCharCode(e[i]);return t.join("")}function mo(s){if(s.slice)return s.slice(0);var e=new Uint8Array(s.byteLength);return e.set(new Uint8Array(s)),e.buffer}function wl(){return this.bodyUsed=!1,this._initBody=function(s){this.bodyUsed=this.bodyUsed,this._bodyInit=s,s?typeof s=="string"?this._bodyText=s:ie.blob&&Blob.prototype.isPrototypeOf(s)?this._bodyBlob=s:ie.formData&&FormData.prototype.isPrototypeOf(s)?this._bodyFormData=s:ie.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)?this._bodyText=s.toString():ie.arrayBuffer&&ie.blob&&fp(s)?(this._bodyArrayBuffer=mo(s.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ie.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(s)||dp(s))?this._bodyArrayBuffer=mo(s):this._bodyText=s=Object.prototype.toString.call(s):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof s=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ie.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ie.blob&&(this.blob=function(){var s=zs(this);if(s)return s;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var s=zs(this);return s||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(ie.blob)return this.blob().then(pp);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var s=zs(this);if(s)return s;if(this._bodyBlob)return gp(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(yp(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ie.formData&&(this.formData=function(){return this.text().then(_p)}),this.json=function(){return this.text().then(JSON.parse)},this}var mp=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function vp(s){var e=s.toUpperCase();return mp.indexOf(e)>-1?e:s}function ht(s,e){if(!(this instanceof ht))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(s instanceof ht){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,e.headers||(this.headers=new J(s.headers)),this.method=s.method,this.mode=s.mode,this.signal=s.signal,!t&&s._bodyInit!=null&&(t=s._bodyInit,s.bodyUsed=!0)}else this.url=String(s);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new J(e.headers)),this.method=vp(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in te){var n=new AbortController;return n.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var r=/\?/;this.url+=(r.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}ht.prototype.clone=function(){return new ht(this,{body:this._bodyInit})};function _p(s){var e=new FormData;return s.trim().split("&").forEach(function(t){if(t){var i=t.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(n))}}),e}function xp(s){var e=new J,t=s.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(i){return i.indexOf(`
`)===0?i.substr(1,i.length):i}).forEach(function(i){var r=i.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();try{e.append(n,o)}catch(l){console.warn("Response "+l.message)}}}),e}wl.call(ht.prototype);function Oe(s,e){if(!(this instanceof Oe))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new J(e.headers),this.url=e.url||"",this._initBody(s)}wl.call(Oe.prototype);Oe.prototype.clone=function(){return new Oe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new J(this.headers),url:this.url})};Oe.error=function(){var s=new Oe(null,{status:200,statusText:""});return s.ok=!1,s.status=0,s.type="error",s};var bp=[301,302,303,307,308];Oe.redirect=function(s,e){if(bp.indexOf(e)===-1)throw new RangeError("Invalid status code");return new Oe(null,{status:e,headers:{location:s}})};var rt=te.DOMException;try{new rt}catch(s){rt=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack},rt.prototype=Object.create(Error.prototype),rt.prototype.constructor=rt}function Tl(s,e){return new Promise(function(t,i){var r=new ht(s,e);if(r.signal&&r.signal.aborted)return i(new rt("Aborted","AbortError"));var n=new XMLHttpRequest;function o(){n.abort()}n.onload=function(){var h={statusText:n.statusText,headers:xp(n.getAllResponseHeaders()||"")};r.url.indexOf("file://")===0&&(n.status<200||n.status>599)?h.status=200:h.status=n.status,h.url="responseURL"in n?n.responseURL:h.headers.get("X-Request-URL");var d="response"in n?n.response:n.responseText;setTimeout(function(){t(new Oe(d,h))},0)},n.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request timed out"))},0)},n.onabort=function(){setTimeout(function(){i(new rt("Aborted","AbortError"))},0)};function l(h){try{return h===""&&te.location.href?te.location.href:h}catch(d){return h}}if(n.open(r.method,l(r.url),!0),r.credentials==="include"?n.withCredentials=!0:r.credentials==="omit"&&(n.withCredentials=!1),"responseType"in n&&(ie.blob?n.responseType="blob":ie.arrayBuffer&&(n.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof J||te.Headers&&e.headers instanceof te.Headers)){var u=[];Object.getOwnPropertyNames(e.headers).forEach(function(h){u.push(zt(h)),n.setRequestHeader(h,tn(e.headers[h]))}),r.headers.forEach(function(h,d){u.indexOf(d)===-1&&n.setRequestHeader(d,h)})}else r.headers.forEach(function(h,d){n.setRequestHeader(d,h)});r.signal&&(r.signal.addEventListener("abort",o),n.onreadystatechange=function(){n.readyState===4&&r.signal.removeEventListener("abort",o)}),n.send(typeof r._bodyInit=="undefined"?null:r._bodyInit)})}Tl.polyfill=!0;te.fetch||(te.fetch=Tl,te.Headers=J,te.Request=ht,te.Response=Oe);const wp=Math.PI/180,ee=Math.PI*2,El=Math.PI*.5,Tp=1e-6;function Nt(s){return(s&s-1)===0}function vo(s){return s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,s++,s}function rn(s){return s*wp}function P(s,e,t){return s<e?e:s>t?t:+s}function Gs(s,e){return~~(Math.random()*(e-s))+s}function Tt(s,e){return Math.random()*(e-s)+s}function _o(s,e,t=2){return Math.abs(s-e)<Math.pow(10,-t)/2}function re(s){return Math.pow(s,2)}class Ep{constructor(){this.objectClass={},this.instance_counter=0}register(e,t,i=!1){if(typeof t!="undefined")this.objectClass[e]={class:t,pool:i?[]:void 0};else throw new Error("Cannot register object '"+e+"', invalid class")}pull(e,...t){let i=this.objectClass[e];if(i){let r=i.class,n=i.pool,o;return n&&(o=n.pop())?(o.onResetEvent.apply(o,t),this.instance_counter--):(o=new(r.bind.apply(r,[r,...t])),n&&(o.className=e)),o}throw new Error("Cannot instantiate object of type '"+e+"'")}purge(){for(let e in this.objectClass)this.objectClass[e]&&(this.objectClass[e].pool=[]);this.instance_counter=0}push(e,t=!0){if(!this.poolable(e)){if(t===!0)throw new Error("me.pool: object "+e+" cannot be recycled");return!1}return this.objectClass[e.className].pool.push(e),this.instance_counter++,!0}exists(e){return e in this.objectClass}poolable(e){let t=e.className;return typeof t!="undefined"&&typeof e.onResetEvent=="function"&&t in this.objectClass&&typeof this.objectClass[t].pool!="undefined"}getInstanceCount(){return this.instance_counter}}let g=new Ep;const xo=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function et(s){return xo[(s&240)>>4]+xo[s&15]}function js(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*(2/3-t)*6:s}const Ap=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,Sp=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Cp=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Pp=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Rp=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;let dr=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach(s=>{dr.set(s[0],s[1])});class ue{constructor(e=0,t=0,i=0,r=1){this.onResetEvent(e,t,i,r)}onResetEvent(e=0,t=0,i=0,r=1){typeof this.glArray=="undefined"&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(e,t,i,r)}get r(){return~~(this.glArray[0]*255)}set r(e){this.glArray[0]=P(~~e||0,0,255)/255}get g(){return~~(this.glArray[1]*255)}set g(e){this.glArray[1]=P(~~e||0,0,255)/255}get b(){return~~(this.glArray[2]*255)}set b(e){this.glArray[2]=P(~~e||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(e=1){this.glArray[3]=P(+e,0,1)}setColor(e,t,i,r=1){return this.r=e,this.g=t,this.b=i,this.alpha=r,this}setFloat(e,t,i,r=1){const n=this.glArray;return n[0]=P(+e,0,1),n[1]=P(+t,0,1),n[2]=P(+i,0,1),n[3]=P(+r,0,1),this}setHSV(e,t,i){let r,n,o,l=Math.floor(e*6),u=e*6-l,h=i*(1-t),d=i*(1-u*t),a=i*(1-(1-u)*t);switch(l%6){case 0:r=i,n=a,o=h;break;case 1:r=d,n=i,o=h;break;case 2:r=h,n=i,o=a;break;case 3:r=h,n=d,o=i;break;case 4:r=a,n=h,o=i;break;case 5:r=i,n=h,o=d;break}return this.setColor(r*255,n*255,o*255)}setHSL(e,t,i){let r,n,o;if(t===0)r=n=o=i;else{let l=i<.5?i*(1+t):i+t-i*t,u=2*i-l;r=js(u,l,e+1/3),n=js(u,l,e),o=js(u,l,e-1/3)}return this.setColor(r*255,n*255,o*255)}clone(){return g.pull("Color").copy(this)}copy(e){return typeof e=="string"?this.parseCSS(e):(this.glArray.set(e.glArray),this)}add(e){return this.glArray[0]=P(this.glArray[0]+e.glArray[0],0,1),this.glArray[1]=P(this.glArray[1]+e.glArray[1],0,1),this.glArray[2]=P(this.glArray[2]+e.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+e.glArray[3])/2,this}darken(e){return e=P(e,0,1),this.glArray[0]*=e,this.glArray[1]*=e,this.glArray[2]*=e,this}lerp(e,t){return t=P(t,0,1),this.glArray[0]+=(e.glArray[0]-this.glArray[0])*t,this.glArray[1]+=(e.glArray[1]-this.glArray[1])*t,this.glArray[2]+=(e.glArray[2]-this.glArray[2])*t,this}lighten(e){return e=P(e,0,1),this.glArray[0]=P(this.glArray[0]+(1-this.glArray[0])*e,0,1),this.glArray[1]=P(this.glArray[1]+(1-this.glArray[1])*e,0,1),this.glArray[2]=P(this.glArray[2]+(1-this.glArray[2])*e,0,1),this}random(e=0,t=255){return e<0&&(e=0),t>255&&(t=255),this.setColor(Gs(e,t),Gs(e,t),Gs(e,t),this.alpha)}equals(e){return this.glArray[0]===e.glArray[0]&&this.glArray[1]===e.glArray[1]&&this.glArray[2]===e.glArray[2]&&this.glArray[3]===e.glArray[3]}parseCSS(e){return dr.has(e)?this.setColor.apply(this,dr.get(e)):this.parseRGB(e)}parseRGB(e){let t=Ap.exec(e);return t?this.setColor(+t[1],+t[2],+t[3],+t[5]):this.parseHex(e)}parseHex(e,t=!1){let i;if(i=Rp.exec(e))return this.setColor(parseInt(i[t===!1?1:2],16),parseInt(i[t===!1?2:3],16),parseInt(i[t===!1?3:4],16),(P(parseInt(i[t===!1?4:1],16),0,255)/255).toFixed(1));if(i=Pp.exec(e))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=Cp.exec(e)){let r=i[t===!1?1:2],n=i[t===!1?2:3],o=i[t===!1?3:4],l=i[t===!1?4:1];return this.setColor(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),(P(parseInt(l+l,16),0,255)/255).toFixed(1))}if(i=Sp.exec(e))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+e)}toUint32(e=1){const t=this.glArray,i=t[0]*255>>0,r=t[1]*255>>0,n=t[2]*255>>0;return e*255>>0<<24|i<<16|r<<8|n}toArray(){return this.glArray}toHex(){return"#"+et(this.r)+et(this.g)+et(this.b)}toHex8(e=this.alpha){return"#"+et(this.r)+et(this.g)+et(this.b)+et(e*255)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(e=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+e+")"}}class B{constructor(e=0,t=0){this.onResetEvent(e,t)}onResetEvent(e=0,t=0){this.x=e,this.y=t}_set(e,t){return this.x=e,this.y=t,this}set(e,t){if(e!==+e||t!==+t)throw new Error("invalid x,y parameters (not a number)");return this._set(e,t)}setZero(){return this.set(0,0)}setV(e){return this._set(e.x,e.y)}add(e){return this._set(this.x+e.x,this.y+e.y)}sub(e){return this._set(this.x-e.x,this.y-e.y)}scale(e,t=e){return this._set(this.x*e,this.y*t)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(e){return this._set(this.x*e.x,this.y*e.y)}div(e){return this._set(this.x/e,this.y/e)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(e,t){return new B(P(this.x,e,t),P(this.y,e,t))}clampSelf(e,t){return this._set(P(this.x,e,t),P(this.y,e,t))}minV(e){return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y)}maxV(e){return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y)}floor(){return new B(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new B(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new B(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(e){return this._set(e.x,e.y)}equals(...e){let t,i;return e.length===2?[t,i]=e:[t,i]=[e[0].x,e[0].y],this.x===t&&this.y===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(e,t){let i=0,r=0;typeof t=="object"&&(i=t.x,r=t.y);let n=this.x-i,o=this.y-r,l=Math.cos(e),u=Math.sin(e);return this._set(n*l-o*u+i,n*u+o*l+r)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}moveTowards(e,t){let i=Math.atan2(e.y-this.y,e.x-this.x),r=this.distance(e);return r===0||t>=0&&r<=t*t?e:(this.x+=Math.cos(i)*t,this.y+=Math.sin(i)*t,this)}distance(e){let t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}angle(e){return Math.acos(P(this.dot(e)/(this.length()*e.length()),-1,1))}project(e){return this.scale(this.dot(e)/e.length2())}projectN(e){return this.scale(this.dot(e))}clone(){return g.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}class De{constructor(e=0,t=0,i=0){this.onResetEvent(e,t,i)}onResetEvent(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}_set(e,t,i=0){return this.x=e,this.y=t,this.z=i,this}set(e,t,i){if(e!==+e||t!==+t||typeof i!="undefined"&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(e,t,i)}setZero(){return this.set(0,0,0)}setV(e){return this._set(e.x,e.y,e.z)}add(e){return this._set(this.x+e.x,this.y+e.y,this.z+(e.z||0))}sub(e){return this._set(this.x-e.x,this.y-e.y,this.z-(e.z||0))}scale(e,t=e,i=1){return this._set(this.x*e,this.y*t,this.z*i)}scaleV(e){return this.scale(e.x,e.y,e.z)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(e){return this._set(this.x/e,this.y/e,this.z/e)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(e,t){return new De(P(this.x,e,t),P(this.y,e,t),P(this.z,e,t))}clampSelf(e,t){return this._set(P(this.x,e,t),P(this.y,e,t),P(this.z,e,t))}minV(e){let t=e.z||0;return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y,this.z<t?this.z:t)}maxV(e){let t=e.z||0;return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y,this.z>t?this.z:t)}floor(){return new De(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new De(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new De(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(e){return this._set(e.x,e.y,e.z||0)}equals(...e){let t,i,r;return e.length>=2?[t,i,r]=e:[t,i,r]=[e[0].x,e[0].y,e[0].z],typeof r=="undefined"&&(r=this.z),this.x===t&&this.y===i&&this.z===r}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(e,t){let i=0,r=0;typeof t=="object"&&(i=t.x,r=t.y);let n=this.x-i,o=this.y-r,l=Math.cos(e),u=Math.sin(e);return this._set(n*l-o*u+i,n*u+o*l+r,this.z)}dot(e){return this.x*e.x+this.y*e.y+this.z*(typeof e.z!="undefined"?e.z:this.z)}cross(e){let t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,l=e.z;return this.x=i*l-r*o,this.y=r*n-t*l,this.z=t*o-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}moveTowards(e,t){let i=Math.atan2(e.y-this.y,e.x-this.x),r=this.x-e.x,n=this.y-e.y,o=Math.sqrt(r*r+n*n);return o===0||t>=0&&o<=t*t?e:(this.x+=Math.cos(i)*t,this.y+=Math.sin(i)*t,this)}distance(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-(e.z||0);return Math.sqrt(t*t+i*i+r*r)}angle(e){return Math.acos(P(this.dot(e)/(this.length()*e.length()),-1,1))}project(e){let t=this.dot(e)/e.length2();return this.scale(t,t,t)}projectN(e){let t=this.dot(e)/e.length2();return this.scale(t,t,t)}clone(){return g.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class Ne extends B{constructor(e=0,t=0,i){if(super(e,t),typeof i=="undefined")throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(e=0,t=0,i){this.setMuted(e,t),typeof i!="undefined"&&this.setCallback(i.onUpdate,i.scope)}get x(){return this._x}set x(e){let t=this.onUpdate.call(this.scope,e,this._y,this._x,this._y);t&&"x"in t?this._x=t.x:this._x=e}get y(){return this._y}set y(e){let t=this.onUpdate.call(this.scope,this._x,e,this._x,this._y);t&&"y"in t?this._y=t.y:this._y=e}_set(e,t){let i=this.onUpdate.call(this.scope,e,t,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=e,this._y=t),this}setMuted(e,t){return this._x=e,this._y=t,this}setCallback(e,t=null){if(typeof e!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}add(e){return this._set(this._x+e.x,this._y+e.y)}sub(e){return this._set(this._x-e.x,this._y-e.y)}scale(e,t=e){return this._set(this._x*e,this._y*t)}scaleV(e){return this._set(this._x*e.x,this._y*e.y)}div(e){return this._set(this._x/e,this._y/e)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(e,t){return new Ne(P(this.x,e,t),P(this.y,e,t),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(e,t){return this._set(P(this._x,e,t),P(this._y,e,t))}minV(e){return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y)}maxV(e){return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y)}floor(){return new Ne(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new Ne(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new Ne(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(e){return this._set(e.x,e.y)}equals(e){return this._x===e.x&&this._y===e.y}perp(){return this._set(this._y,-this._x)}rotate(e,t){let i=0,r=0;typeof t=="object"&&(i=t.x,r=t.y);let n=this._x-i,o=this._y-r,l=Math.cos(e),u=Math.sin(e);return this._set(n*l-o*u+i,n*u+o*l+r)}dot(e){return this._x*e.x+this._y*e.y}cross(e){return this._x*e.y-this._y*e.x}lerp(e,t){return this._set(this._x+(e.x-this._x)*t,this._y+(e.y-this._y)*t)}moveTowards(e,t){let i=Math.atan2(e.y-this._y,e.x-this._x),r=this.distance(e);return r===0||t>=0&&r<=t*t?e:(this._x+=Math.cos(i)*t,this._y+=Math.sin(i)*t,this)}distance(e){return Math.sqrt((this._x-e.x)*(this._x-e.x)+(this._y-e.y)*(this._y-e.y))}clone(){return g.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return g.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class ke extends De{constructor(e=0,t=0,i=0,r){if(super(e,t,i),typeof r=="undefined")throw new Error("undefined `onUpdate` callback");this.setCallback(r.onUpdate,r.scope)}onResetEvent(e=0,t=0,i=0,r){return this.setMuted(e,t,i),typeof r!="undefined"&&this.setCallback(r.onUpdate,r.scope),this}get x(){return this._x}set x(e){let t=this.onUpdate.call(this.scope,e,this._y,this._z,this._x,this._y,this._z);t&&"x"in t?this._x=t.x:this._x=e}get y(){return this._y}set y(e){let t=this.onUpdate.call(this.scope,this._x,e,this._z,this._x,this._y,this._z);t&&"y"in t?this._y=t.y:this._y=e}get z(){return this._z}set z(e){let t=this.onUpdate.call(this.scope,this._x,this._y,e,this._x,this._y,this._z);t&&"z"in t?this._z=t.z:this._z=e}_set(e,t,i){let r=this.onUpdate.call(this.scope,e,t,i,this._x,this._y,this._z);return r&&"x"in r&&"y"in r&&"z"in r?(this._x=r.x,this._y=r.y,this._z=r.z):(this._x=e,this._y=t,this._z=i||0),this}setMuted(e,t,i){return this._x=e,this._y=t,this._z=i||0,this}setCallback(e,t=null){if(typeof e!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}add(e){return this._set(this._x+e.x,this._y+e.y,this._z+(e.z||0))}sub(e){return this._set(this._x-e.x,this._y-e.y,this._z-(e.z||0))}scale(e,t=e,i=1){return this._set(this._x*e,this._y*t,this._z*i)}scaleV(e){return this._set(this._x*e.x,this._y*e.y,this._z*(e.z||1))}div(e){return this._set(this._x/e,this._y/e,this._z/e)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(e,t){return new ke(P(this._x,e,t),P(this._y,e,t),P(this._z,e,t),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(e,t){return this._set(P(this._x,e,t),P(this._y,e,t),P(this._z,e,t))}minV(e){let t=e.z||0;return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y,this._z<t?this._z:t)}maxV(e){let t=e.z||0;return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y,this._z>t?this._z:t)}floor(){return new ke(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new ke(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new ke(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(e){return this._set(e.x,e.y,e.z||0)}equals(e){return this._x===e.x&&this._y===e.y&&this._z===(e.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(e,t){let i=0,r=0;typeof t=="object"&&(i=t.x,r=t.y);let n=this.x-i,o=this.y-r,l=Math.cos(e),u=Math.sin(e);return this._set(n*l-o*u+i,n*u+o*l+r,this.z)}dot(e){return this._x*e.x+this._y*e.y+this._z*(e.z||1)}cross(e){let t=this._x,i=this._y,r=this._z,n=e.x,o=e.y,l=e.z;return this._set(i*l-r*o,r*n-t*l,t*o-i*n)}lerp(e,t){return this._set(this._x+(e.x-this._x)*t,this._y+(e.y-this._y)*t,this._z+(e.z-this._z)*t)}moveTowards(e,t){let i=Math.atan2(e.y-this._y,e.x-this._x),r=this._x-e.x,n=this._y-e.y,o=Math.sqrt(r*r+n*n);return o===0||t>=0&&o<=t*t?e:this._set(this._x+Math.cos(i)*t,this._y+Math.sin(i)*t,this._z)}distance(e){let t=this._x-e.x,i=this._y-e.y,r=this._z-(e.z||0);return Math.sqrt(t*t+i*i+r*r)}clone(){return g.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return g.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}class Qt{constructor(...e){this.onResetEvent(...e)}onResetEvent(){const e=arguments[0],t=arguments.length;if(typeof this.val=="undefined"&&(this.val=new Float32Array(9)),t===1)if(e.val.length===9)this.copy(e);else if(e.val.length===16)this.fromMat3d(arguments[0]);else throw new Error("invalid Matrix2d constructor parameter");else arguments.length>=6?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){let e=this.val;return arguments.length===9?(e[0]=arguments[0],e[1]=arguments[1],e[2]=arguments[2],e[3]=arguments[3],e[4]=arguments[4],e[5]=arguments[5],e[6]=arguments[6],e[7]=arguments[7],e[8]=arguments[8]):arguments.length===6&&(e[0]=arguments[0],e[1]=arguments[2],e[2]=arguments[4],e[3]=arguments[1],e[4]=arguments[3],e[5]=arguments[5],e[6]=0,e[7]=0,e[8]=1),this}transform(e,t,i,r,n,o){let l=this.val,u=l[0],h=l[1],d=l[3],a=l[4],f=e,c=t,p=i,y=r,v=n,m=o;return l[0]=u*f+d*c,l[1]=h*f+a*c,l[3]=u*p+d*y,l[4]=h*p+a*y,l[6]+=u*v+d*m,l[7]+=h*v+a*m,this}copy(e){return this.val.set(e.val),this}fromMat3d(e){let t=e.val,i=this.val;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],this}multiply(e){let t=e.val,i=this.val,r=i[0],n=i[1],o=i[3],l=i[4],u=t[0],h=t[1],d=t[3],a=t[4],f=t[6],c=t[7];return i[0]=r*u+o*h,i[1]=n*u+l*h,i[3]=r*d+o*a,i[4]=n*d+l*a,i[6]+=r*f+o*c,i[7]+=n*f+l*c,this}transpose(){let e=this.val,t=e[1],i=e[2],r=e[5];return e[1]=e[3],e[2]=e[6],e[3]=t,e[5]=e[7],e[6]=i,e[7]=r,this}invert(){let e=this.val,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],l=e[5],u=e[6],h=e[7],d=e[8],a=d*o-l*h,f=l*u-d*n,c=h*n-o*u,p=t*a+i*f+r*c;return e[0]=a/p,e[1]=(r*h-d*i)/p,e[2]=(l*i-r*o)/p,e[3]=f/p,e[4]=(d*t-r*u)/p,e[5]=(r*n-l*t)/p,e[6]=c/p,e[7]=(i*u-h*t)/p,e[8]=(o*t-i*n)/p,this}apply(e){let t=this.val,i=e.x,r=e.y,n=typeof e.z!="undefined"?e.z:1;return e.x=i*t[0]+r*t[3]+n*t[6],e.y=i*t[1]+r*t[4]+n*t[7],typeof e.z!="undefined"&&(e.z=i*t[2]+r*t[5]+n*t[8]),e}applyInverse(e){let t=this.val,i=e.x,r=e.y,n=1/(t[0]*t[4]+t[3]*-t[1]);return e.x=t[4]*n*i+-t[3]*n*r+(t[7]*t[3]-t[6]*t[4])*n,e.y=t[0]*n*r+-t[1]*n*i+(-t[7]*t[0]+t[6]*t[1])*n,e}scale(e,t=e){let i=this.val;return i[0]*=e,i[1]*=e,i[3]*=t,i[4]*=t,this}scaleV(e){return this.scale(e.x,e.y)}scaleX(e){return this.scale(e,1)}scaleY(e){return this.scale(1,e)}rotate(e){if(e!==0){let t=this.val,i=t[0],r=t[1],n=t[2],o=t[3],l=t[4],u=t[5],h=Math.sin(e),d=Math.cos(e);t[0]=d*i+h*o,t[1]=d*r+h*l,t[2]=d*n+h*u,t[3]=d*o-h*i,t[4]=d*l-h*r,t[5]=d*u-h*n}return this}translate(){let e=this.val,t,i;return arguments.length===2?(t=arguments[0],i=arguments[1]):(t=arguments[0].x,i=arguments[0].y),e[6]+=e[0]*t+e[3]*i,e[7]+=e[1]*t+e[4]*i,this}isIdentity(){let e=this.val;return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===1&&e[5]===0&&e[6]===0&&e[7]===0&&e[8]===1}equals(e){let t=e.val,i=this.val;return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]}clone(){return g.pull("Matrix2d",this)}toArray(){return this.val}toString(){let e=this.val;return"me.Matrix2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}}class Gi{constructor(...e){this.onResetEvent(...e)}onResetEvent(){const e=arguments[0],t=arguments.length;typeof this.val=="undefined"&&(this.val=new Float32Array(16)),t===1&&e.val.length===16?this.copy(e):t===16?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(e,t,i,r,n,o,l,u,h,d,a,f,c,p,y,v){let m=this.val;return m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=l,m[7]=u,m[8]=h,m[9]=d,m[10]=a,m[11]=f,m[12]=c,m[13]=p,m[14]=y,m[15]=v,this}copy(e){return this.val.set(e.val),this}fromMat2d(e){let t=e.val;return this.setTransform(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1)}multiply(e){let t=this.val,i=e.val,r=t[0],n=t[1],o=t[2],l=t[3],u=t[4],h=t[5],d=t[6],a=t[7],f=t[8],c=t[9],p=t[10],y=t[11],v=t[12],m=t[13],_=t[14],x=t[15],b=i[0],E=i[1],S=i[2],I=i[3];return t[0]=b*r+E*u+S*f+I*v,t[1]=b*n+E*h+S*c+I*m,t[2]=b*o+E*d+S*p+I*_,t[3]=b*l+E*a+S*y+I*x,b=i[4],E=i[5],S=i[6],I=i[7],t[4]=b*r+E*u+S*f+I*v,t[5]=b*n+E*h+S*c+I*m,t[6]=b*o+E*d+S*p+I*_,t[7]=b*l+E*a+S*y+I*x,b=i[8],E=i[9],S=i[10],I=i[11],t[8]=b*r+E*u+S*f+I*v,t[9]=b*n+E*h+S*c+I*m,t[10]=b*o+E*d+S*p+I*_,t[11]=b*l+E*a+S*y+I*x,b=i[12],E=i[13],S=i[14],I=i[15],t[12]=b*r+E*u+S*f+I*v,t[13]=b*n+E*h+S*c+I*m,t[14]=b*o+E*d+S*p+I*_,t[15]=b*l+E*a+S*y+I*x,this}transpose(){let e=this.val,t=e[1],i=e[2],r=e[3],n=e[6],o=e[7],l=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=i,e[9]=n,e[11]=e[14],e[12]=r,e[13]=o,e[14]=l,this}invert(){let e=this.val,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],l=e[5],u=e[6],h=e[7],d=e[8],a=e[9],f=e[10],c=e[11],p=e[12],y=e[13],v=e[14],m=e[15],_=t*l-i*o,x=t*u-r*o,b=t*h-n*o,E=i*u-r*l,S=i*h-n*l,I=r*h-n*u,j=d*y-a*p,N=d*v-f*p,X=d*m-c*p,K=a*v-f*y,q=a*m-c*y,T=f*m-c*v,w=_*T-x*q+b*K+E*X-S*N+I*j;return w?(w=1/w,e[0]=(l*T-u*q+h*K)*w,e[1]=(r*q-i*T-n*K)*w,e[2]=(y*I-v*S+m*E)*w,e[3]=(f*S-a*I-c*E)*w,e[4]=(u*X-o*T-h*N)*w,e[5]=(t*T-r*X+n*N)*w,e[6]=(v*b-p*I-m*x)*w,e[7]=(d*I-f*b+c*x)*w,e[8]=(o*q-l*X+h*j)*w,e[9]=(i*X-t*q-n*j)*w,e[10]=(p*S-y*b+m*_)*w,e[11]=(a*b-d*S-c*_)*w,e[12]=(l*N-o*K-u*j)*w,e[13]=(t*K-i*N+r*j)*w,e[14]=(y*x-p*E-v*_)*w,e[15]=(d*E-a*x+f*_)*w,this):null}apply(e){let t=this.val,i=e.x,r=e.y,n=typeof e.z!="undefined"?e.z:1,o=t[3]*i+t[7]*r+t[11]*n+t[15]||1;return e.x=(t[0]*i+t[4]*r+t[8]*n+t[12])/o,e.y=(t[1]*i+t[5]*r+t[9]*n+t[13])/o,typeof e.z!="undefined"&&(e.z=(t[2]*i+t[6]*r+t[10]*n+t[14])/o),e}applyInverse(e){let t=g.pull("Matrix3d",this).invert();return t.apply(e),g.push(t),e}ortho(e,t,i,r,n,o){let l=this.val,u=1/(e-t),h=1/(i-r),d=1/(n-o);return l[0]=-2*u,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*h,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*d,l[11]=0,l[12]=(e+t)*u,l[13]=(r+i)*h,l[14]=(o+n)*d,l[15]=1,this}scale(e,t=e,i=0){let r=this.val;return r[0]=r[0]*e,r[1]=r[1]*e,r[2]=r[2]*e,r[3]=r[3]*e,r[4]=r[4]*t,r[5]=r[5]*t,r[6]=r[6]*t,r[7]=r[7]*t,r[8]=r[8]*i,r[9]=r[9]*i,r[10]=r[10]*i,r[11]=r[11]*i,this}scaleV(e){return this.scale(e.x,e.y,e.z)}scaleX(e){return this.scale(e,1)}scaleY(e){return this.scale(1,e)}rotate(e,t){if(e!==0){let i=this.val,r=t.x,n=t.y,o=t.z,l=Math.sqrt(r*r+n*n+o*o),u,h,d,a,f,c,p,y,v,m,_,x,b,E,S,I,j,N,X,K,q,T,w,C;if(l<Tp)return null;l=1/l,r*=l,n*=l,o*=l,u=Math.sin(e),h=Math.cos(e),d=1-h,a=i[0],f=i[1],c=i[2],p=i[3],y=i[4],v=i[5],m=i[6],_=i[7],x=i[8],b=i[9],E=i[10],S=i[11],I=r*r*d+h,j=n*r*d+o*u,N=o*r*d-n*u,X=r*n*d-o*u,K=n*n*d+h,q=o*n*d+r*u,T=r*o*d+n*u,w=n*o*d-r*u,C=o*o*d+h,i[0]=a*I+y*j+x*N,i[1]=f*I+v*j+b*N,i[2]=c*I+m*j+E*N,i[3]=p*I+_*j+S*N,i[4]=a*X+y*K+x*q,i[5]=f*X+v*K+b*q,i[6]=c*X+m*K+E*q,i[7]=p*X+_*K+S*q,i[8]=a*T+y*w+x*C,i[9]=f*T+v*w+b*C,i[10]=c*T+m*w+E*C,i[11]=p*T+_*w+S*C}return this}translate(){let e=this.val,t,i,r;return arguments.length>1?(t=arguments[0],i=arguments[1],r=typeof arguments[2]=="undefined"?0:arguments[2]):(t=arguments[0].x,i=arguments[0].y,r=typeof arguments[0].z=="undefined"?0:arguments[0].z),e[12]=e[0]*t+e[4]*i+e[8]*r+e[12],e[13]=e[1]*t+e[5]*i+e[9]*r+e[13],e[14]=e[2]*t+e[6]*i+e[10]*r+e[14],e[15]=e[3]*t+e[7]*i+e[11]*r+e[15],this}isIdentity(){let e=this.val;return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}equals(e){let t=e.val,i=this.val;return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]}clone(){return g.pull("Matrix3d",this)}toArray(){return this.val}toString(){let e=this.val;return"me.Matrix3d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}}var nn={exports:{}};nn.exports=os;nn.exports.default=os;function os(s,e,t){t=t||2;var i=e&&e.length,r=i?e[0]*t:s.length,n=Al(s,0,r,t,!0),o=[];if(!n||n.next===n.prev)return o;var l,u,h,d,a,f,c;if(i&&(n=Bp(s,e,n,t)),s.length>80*t){l=h=s[0],u=d=s[1];for(var p=t;p<r;p+=t)a=s[p],f=s[p+1],a<l&&(l=a),f<u&&(u=f),a>h&&(h=a),f>d&&(d=f);c=Math.max(h-l,d-u),c=c!==0?32767/c:0}return Jt(n,o,t,l,u,c,0),o}function Al(s,e,t,i,r){var n,o;if(r===yr(s,e,t,i)>0)for(n=e;n<t;n+=i)o=bo(n,s[n],s[n+1],o);else for(n=t-i;n>=e;n-=i)o=bo(n,s[n],s[n+1],o);return o&&as(o,o.next)&&(ti(o),o=o.next),o}function ut(s,e){if(!s)return s;e||(e=s);var t=s,i;do if(i=!1,!t.steiner&&(as(t,t.next)||Y(t.prev,t,t.next)===0)){if(ti(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Jt(s,e,t,i,r,n,o){if(s){!o&&n&&$p(s,i,r,n);for(var l=s,u,h;s.prev!==s.next;){if(u=s.prev,h=s.next,n?Op(s,i,r,n):Ip(s)){e.push(u.i/t|0),e.push(s.i/t|0),e.push(h.i/t|0),ti(s),s=h.next,l=h.next;continue}if(s=h,s===l){o?o===1?(s=Mp(ut(s),e,t),Jt(s,e,t,i,r,n,2)):o===2&&Lp(s,e,t,i,r,n):Jt(ut(s),e,t,i,r,n,1);break}}}}function Ip(s){var e=s.prev,t=s,i=s.next;if(Y(e,t,i)>=0)return!1;for(var r=e.x,n=t.x,o=i.x,l=e.y,u=t.y,h=i.y,d=r<n?r<o?r:o:n<o?n:o,a=l<u?l<h?l:h:u<h?u:h,f=r>n?r>o?r:o:n>o?n:o,c=l>u?l>h?l:h:u>h?u:h,p=i.next;p!==e;){if(p.x>=d&&p.x<=f&&p.y>=a&&p.y<=c&&It(r,l,n,u,o,h,p.x,p.y)&&Y(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Op(s,e,t,i){var r=s.prev,n=s,o=s.next;if(Y(r,n,o)>=0)return!1;for(var l=r.x,u=n.x,h=o.x,d=r.y,a=n.y,f=o.y,c=l<u?l<h?l:h:u<h?u:h,p=d<a?d<f?d:f:a<f?a:f,y=l>u?l>h?l:h:u>h?u:h,v=d>a?d>f?d:f:a>f?a:f,m=pr(c,p,e,t,i),_=pr(y,v,e,t,i),x=s.prevZ,b=s.nextZ;x&&x.z>=m&&b&&b.z<=_;){if(x.x>=c&&x.x<=y&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&It(l,d,u,a,h,f,x.x,x.y)&&Y(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=c&&b.x<=y&&b.y>=p&&b.y<=v&&b!==r&&b!==o&&It(l,d,u,a,h,f,b.x,b.y)&&Y(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=m;){if(x.x>=c&&x.x<=y&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&It(l,d,u,a,h,f,x.x,x.y)&&Y(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=_;){if(b.x>=c&&b.x<=y&&b.y>=p&&b.y<=v&&b!==r&&b!==o&&It(l,d,u,a,h,f,b.x,b.y)&&Y(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Mp(s,e,t){var i=s;do{var r=i.prev,n=i.next.next;!as(r,n)&&Sl(r,i,i.next,n)&&ei(r,n)&&ei(n,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(n.i/t|0),ti(i),ti(i.next),i=s=n),i=i.next}while(i!==s);return ut(i)}function Lp(s,e,t,i,r,n){var o=s;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&zp(o,l)){var u=Cl(o,l);o=ut(o,o.next),u=ut(u,u.next),Jt(o,e,t,i,r,n,0),Jt(u,e,t,i,r,n,0);return}l=l.next}o=o.next}while(o!==s)}function Bp(s,e,t,i){var r=[],n,o,l,u,h;for(n=0,o=e.length;n<o;n++)l=e[n]*i,u=n<o-1?e[n+1]*i:s.length,h=Al(s,l,u,i,!1),h===h.next&&(h.steiner=!0),r.push(Vp(h));for(r.sort(Dp),n=0;n<r.length;n++)t=Np(r[n],t);return t}function Dp(s,e){return s.x-e.x}function Np(s,e){var t=kp(s,e);if(!t)return e;var i=Cl(t,s);return ut(i,i.next),ut(t,t.next)}function kp(s,e){var t=e,i=s.x,r=s.y,n=-1/0,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){var l=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=i&&l>n&&(n=l,o=t.x<t.next.x?t:t.next,l===i))return o}t=t.next}while(t!==e);if(!o)return null;var u=o,h=o.x,d=o.y,a=1/0,f;t=o;do i>=t.x&&t.x>=h&&i!==t.x&&It(r<d?i:n,r,h,d,r<d?n:i,r,t.x,t.y)&&(f=Math.abs(r-t.y)/(i-t.x),ei(t,s)&&(f<a||f===a&&(t.x>o.x||t.x===o.x&&Fp(o,t)))&&(o=t,a=f)),t=t.next;while(t!==u);return o}function Fp(s,e){return Y(s.prev,s,e.prev)<0&&Y(e.next,s,s.next)<0}function $p(s,e,t,i){var r=s;do r.z===0&&(r.z=pr(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,Up(r)}function Up(s){var e,t,i,r,n,o,l,u,h=1;do{for(t=s,s=null,n=null,o=0;t;){for(o++,i=t,l=0,e=0;e<h&&(l++,i=i.nextZ,!!i);e++);for(u=h;l>0||u>0&&i;)l!==0&&(u===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,l--):(r=i,i=i.nextZ,u--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;t=i}n.nextZ=null,h*=2}while(o>1);return s}function pr(s,e,t,i,r){return s=(s-t)*r|0,e=(e-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function Vp(s){var e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function It(s,e,t,i,r,n,o,l){return(r-o)*(e-l)>=(s-o)*(n-l)&&(s-o)*(i-l)>=(t-o)*(e-l)&&(t-o)*(n-l)>=(r-o)*(i-l)}function zp(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!Gp(s,e)&&(ei(s,e)&&ei(e,s)&&jp(s,e)&&(Y(s.prev,s,e.prev)||Y(s,e.prev,e))||as(s,e)&&Y(s.prev,s,s.next)>0&&Y(e.prev,e,e.next)>0)}function Y(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function as(s,e){return s.x===e.x&&s.y===e.y}function Sl(s,e,t,i){var r=Ci(Y(s,e,t)),n=Ci(Y(s,e,i)),o=Ci(Y(t,i,s)),l=Ci(Y(t,i,e));return!!(r!==n&&o!==l||r===0&&Si(s,t,e)||n===0&&Si(s,i,e)||o===0&&Si(t,s,i)||l===0&&Si(t,e,i))}function Si(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Ci(s){return s>0?1:s<0?-1:0}function Gp(s,e){var t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&Sl(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function ei(s,e){return Y(s.prev,s,s.next)<0?Y(s,e,s.next)>=0&&Y(s,s.prev,e)>=0:Y(s,e,s.prev)<0||Y(s,s.next,e)<0}function jp(s,e){var t=s,i=!1,r=(s.x+e.x)/2,n=(s.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&r<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function Cl(s,e){var t=new gr(s.i,s.x,s.y),i=new gr(e.i,e.x,e.y),r=s.next,n=e.prev;return s.next=e,e.prev=s,t.next=r,r.prev=t,i.next=t,t.prev=i,n.next=i,i.prev=n,i}function bo(s,e,t,i){var r=new gr(s,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function ti(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function gr(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}os.deviation=function(s,e,t,i){var r=e&&e.length,n=r?e[0]*t:s.length,o=Math.abs(yr(s,0,n,t));if(r)for(var l=0,u=e.length;l<u;l++){var h=e[l]*t,d=l<u-1?e[l+1]*t:s.length;o-=Math.abs(yr(s,h,d,t))}var a=0;for(l=0;l<i.length;l+=3){var f=i[l]*t,c=i[l+1]*t,p=i[l+2]*t;a+=Math.abs((s[f]-s[p])*(s[c+1]-s[f+1])-(s[f]-s[c])*(s[p+1]-s[f+1]))}return o===0&&a===0?0:Math.abs((a-o)/o)};function yr(s,e,t,i){for(var r=0,n=e,o=t-i;n<t;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}os.flatten=function(s){for(var e=s[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var o=0;o<e;o++)t.vertices.push(s[r][n][o]);r>0&&(i+=s[r-1].length,t.holes.push(i))}return t};var Xp=nn.exports,Pl=Da(Xp);class Ke{constructor(e=0,t=0,i){this.pos=g.pull("Vector2d"),this.points=[],this.edges=[],this.indices=[],this.normals=[],this._bounds,this.type="Polygon",this.setShape(e,t,i)}onResetEvent(e,t,i){this.setShape(e,t,i)}setShape(e,t,i){return this.pos.set(e,t),this.setVertices(i),this}setVertices(e){if(!Array.isArray(e))return this;if(typeof e[0]=="object")typeof e[0].setV=="function"?this.points=e:(this.points.length=0,e.forEach(t=>{this.points.push(g.pull("Vector2d",t.x,t.y))}));else{let t=e.length;this.points.length=0;for(let i=0;i<t;i+=2)this.points.push(g.pull("Vector2d",e[i],e[i+1]))}return this.recalc(),this.updateBounds(),this}transform(e){let t=this.points,i=t.length;for(let r=0;r<i;r++)e.apply(t[r]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(e,t){if(e!==0){let i=this.points,r=i.length;for(let n=0;n<r;n++)i[n].rotate(e,t);this.recalc(),this.updateBounds()}return this}scale(e,t=e){let i=this.points,r=i.length;for(let n=0;n<r;n++)i[n].scale(e,t);return this.recalc(),this.updateBounds(),this}scaleV(e){return this.scale(e.x,e.y)}recalc(){let e=this.edges,t=this.normals,i=this.indices,r=this.points,n=r.length;if(n<3)throw new Error("Requires at least 3 points");for(let o=0;o<n;o++){let l=e[o];typeof l=="undefined"&&(l=e[o]=g.pull("Vector2d")),l.copy(r[(o+1)%n]).sub(r[o]);let u=t[o];typeof u=="undefined"&&(u=t[o]=g.pull("Vector2d")),u.copy(l).perp().normalize()}for(let o=n;o<e.length;o++)g.push(e[o]),g.push(t[o]);return e.length=n,t.length=n,i.length=0,this}getIndices(){return this.indices.length===0&&(this.indices=Pl(this.points.flatMap(e=>[e.x,e.y]))),this.indices}isConvex(){let e=0,t=this.points,i=t.length;if(i<3)return null;for(let r=0;r<i;r++){let n=(r+1)%i,o=(r+2)%i,l=(t[n].x-t[r].x)*(t[o].y-t[n].y);if(l-=(t[n].y-t[r].y)*(t[o].x-t[n].x),l<0?e|=1:l>0&&(e|=2),e===3)return!1}return e!==0?!0:null}translate(){let e,t;return arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}shift(){let e,t;arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x=e,this.pos.y=t,this.updateBounds()}contains(...e){let[t,i]=e.length===2?e:[e[0].x,e[0].y],r=!1,n=this.pos.x,o=this.pos.y,l=this.points,u=l.length;for(let h=0,d=u-1;h<u;d=h++){const a=l[h].y+o,f=l[h].x+n,c=l[d].y+o,p=l[d].x+n;a>i!=c>i&&t<(p-f)*(i-a)/(c-a)+f&&(r=!r)}return r}getBounds(){return typeof this._bounds=="undefined"&&(this._bounds=g.pull("Bounds")),this._bounds}updateBounds(){let e=this.getBounds();return e.update(this.points),e.translate(this.pos),e}clone(){let e=[];return this.points.forEach(t=>{e.push(t.clone())}),new Ke(this.pos.x,this.pos.y,e)}}class ji extends Ke{contains(){let e,t;arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),e-=this.pos.x,t-=this.pos.y;let i=this.points[0],r=this.points[1];return(t-i.y)*(r.x-i.x)===(r.y-i.y)*(e-i.x)}recalc(){let e=this.edges,t=this.normals,i=this.indices,r=this.points;if(r.length!==2)throw new Error("Requires exactly 2 points");return e[0]===void 0&&(e[0]=g.pull("Vector2d")),e[0].copy(r[1]).sub(r[0]),t[0]===void 0&&(t[0]=g.pull("Vector2d")),t[0].copy(e[0]).perp().normalize(),i.length=0,this}clone(){let e=[];return this.points.forEach(t=>{e.push(t.clone())}),new ji(this.pos.x,this.pos.y,e)}}class ii{constructor(e,t,i,r){this.pos=g.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=g.pull("Vector2d"),this.radiusSq=g.pull("Vector2d"),this.ratio=g.pull("Vector2d"),this.type="Ellipse",this.setShape(e,t,i,r)}onResetEvent(e,t,i,r){this.setShape(e,t,i,r)}setShape(e,t,i,r){const n=i/2,o=r/2,l=Math.max(n,o),u=l*l;this.pos.set(e,t),this.radius=l,this.ratio.set(n/l,o/l),this.radiusV.set(l,l).scaleV(this.ratio),this.radiusSq.set(u,u).scaleV(this.ratio);let h=this.getBounds();return h.setMinMax(e,t,e+i,e+r),h.translate(-this.radiusV.x,-this.radiusV.y),this}rotate(e,t){let i=this.getBounds();return this.pos.rotate(e,t),i.shift(this.pos),i.translate(-this.radiusV.x,-this.radiusV.y),this}scale(e,t=e){return this.setShape(this.pos.x,this.pos.y,this.radiusV.x*2*e,this.radiusV.y*2*t)}scaleV(e){return this.scale(e.x,e.y)}transform(e){return this}translate(){let e,t;return arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}contains(...e){let t,i;return e.length===2?[t,i]=e:[t,i]=[e[0].x,e[0].y],t-=this.pos.x,i-=this.pos.y,t*t/this.radiusSq.x+i*i/this.radiusSq.y<=1}getBounds(){return typeof this._bounds=="undefined"&&(this._bounds=g.pull("Bounds")),this._bounds}clone(){return new ii(this.pos.x,this.pos.y,this.radiusV.x*2,this.radiusV.y*2)}}class si{constructor(e=0,t=0){this.x=e,this.y=t,this.type="Point"}onResetEvent(e=0,t=0){this.set(e,t)}set(e=0,t=0){return this.x=e,this.y=t,this}equals(...e){let t,i;return e.length===2?[t,i]=e:[t,i]=[e[0].x,e[0].y],this.x===t&&this.y===i}clone(){return new si(this.x,this.y)}}class xe extends Ke{constructor(e,t,i,r){super(e,t,[g.pull("Vector2d",0,0),g.pull("Vector2d",i,0),g.pull("Vector2d",i,r),g.pull("Vector2d",0,r)]),this.type="Rectangle"}onResetEvent(e,t,i,r){this.setShape(e,t,i,r)}setShape(e,t,i,r){let n=i;return this.pos.set(e,t),arguments.length===4&&(n=this.points,n[0].set(0,0),n[1].set(i,0),n[2].set(i,r),n[3].set(0,r)),this.setVertices(n),this}get left(){return this.pos.x}get right(){let e=this.width;return this.left+e||e}get top(){return this.pos.y}get bottom(){let e=this.height;return this.top+e||e}get width(){return this.points[2].x}set width(e){this.points[1].x=this.points[2].x=e,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(e){this.points[2].y=this.points[3].y=e,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.left+this.width/2:this.width}set centerX(e){this.pos.x=e-this.width/2,this.recalc(),this.updateBounds()}get centerY(){return isFinite(this.height)?this.top+this.height/2:this.height}set centerY(e){this.pos.y=e-this.height/2,this.recalc(),this.updateBounds()}centerOn(e,t){return this.centerX=e,this.centerY=t,this}resize(e,t){return this.width=e,this.height=t,this}scale(e,t=e){return this.width*=e,this.height*=t,this}clone(){return new xe(this.left,this.top,this.width,this.height)}copy(e){return this.setShape(e.left,e.top,e.width,e.height)}union(e){let t=Math.min(this.left,e.left),i=Math.min(this.top,e.top);return this.resize(Math.max(this.right,e.right)-t,Math.max(this.bottom,e.bottom)-i),this.pos.set(t,i),this}overlaps(e){return this.left<e.right&&e.left<this.right&&this.top<e.bottom&&e.top<this.bottom}contains(){let e=arguments[0],t,i,r,n;return arguments.length===2?(t=i=e,r=n=arguments[1]):typeof e.bottom=="number"?(t=e.left,i=e.right,r=e.top,n=e.bottom):(t=i=e.x,r=n=e.y),t>=this.left&&i<=this.right&&r>=this.top&&n<=this.bottom}equals(e){return e.left===this.left&&e.right===this.right&&e.top===this.top&&e.bottom===this.bottom}isFinite(){return isFinite(this.left)&&isFinite(this.top)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return g.pull("Polygon",this.left,this.top,this.points)}}class Xi extends xe{constructor(e,t,i,r,n=20){super(e,t,i,r),this.type="RoundRect",this.radius=n}onResetEvent(e,t,i,r,n){super.setShape(e,t,i,r),this.radius=n}get radius(){return this._radius}set radius(e){this.width<2*e&&(e=this.width/2),this.height<2*e&&(e=this.height/2),this._radius=e}copy(e){return super.setShape(e.pos.x,e.pos.y,e.width,e.height),this.radius=e.radius,this}contains(){let e=arguments[0],t,i;if(arguments.length===2)t=e,i=arguments[1];else{if(typeof e.radius=="undefined"&&typeof e.bottom=="number")return super.contains(e);t=e.x,i=e.y}if(t<this.left||t>=this.right||i<this.top||i>=this.bottom)return!1;if(t>=this.left+this.radius&&t<=this.right-this.radius||i>=this.top+this.radius&&i<=this.bottom-this.radius)return!0;let r,n;const o=Math.max(0,Math.min(this.radius,this.width/2)),l=Math.max(0,Math.min(this.radius,this.height/2));if(t<this.left+o&&i<this.top+l)r=t-this.left-o,n=i-this.top-l;else if(t>this.right-o&&i<this.top+l)r=t-this.right+o,n=i-this.top-l;else if(t>this.right-o&&i>this.bottom-l)r=t-this.right+o,n=i-this.bottom+l;else if(t<this.left+o&&i>this.bottom-l)r=t-this.left-o,n=i-this.bottom+l;else return!1;return r*r+n*n<=o*l}equals(e){return super.equals(e)&&this.radius===e.radius}clone(){return new Xi(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}function Hi(s,e){let t=Array.prototype.indexOf.call(s,e);return t!==-1&&Array.prototype.splice.call(s,t,1),s}let mr=[];function Pi(s,e,t=4,i=4,r=0){if(mr.length>0){let n=mr.pop();return n.world=s,n.bounds=e,n.max_objects=t,n.max_levels=i,n.level=r,n}else return new Rl(s,e,t,i,r)}function Hp(s){mr.push(s)}let wo=new B;class Rl{constructor(e,t,i=4,r=4,n=0){this.world=e,this.bounds=t,this.max_objects=i,this.max_levels=r,this.level=n,this.objects=[],this.nodes=[]}split(){let e=this.level+1,t=this.bounds.width/2,i=this.bounds.height/2,r=this.bounds.left,n=this.bounds.top;this.nodes[0]=Pi(this.world,{left:r+t,top:n,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[1]=Pi(this.world,{left:r,top:n,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[2]=Pi(this.world,{left:r,top:n+i,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[3]=Pi(this.world,{left:r+t,top:n+i,width:t,height:i},this.max_objects,this.max_levels,e)}getIndex(e){let t,i=e.getBounds();e.isFloating===!0?t=this.world.app.viewport.localToWorld(i.left,i.top,wo):t=wo.set(e.left,e.top);let r=-1,n=t.x,o=t.y,l=i.width,u=i.height,h=this.bounds.left+this.bounds.width/2,d=this.bounds.top+this.bounds.height/2,a=o<d&&o+u<d,f=o>d;return n<h&&n+l<h?a?r=1:f&&(r=2):n>h&&(a?r=0:f&&(r=3)),r}insertContainer(e){const t=e.children,i=t.length;for(let r=i,n;r--,n=t[r];)n.isKinematic!==!0&&(typeof n.addChild=="function"?(n.name!=="rootContainer"&&this.insert(n),this.insertContainer(n)):typeof n.getBounds=="function"&&this.insert(n))}insert(e){let t=-1;if(this.nodes.length>0&&(t=this.getIndex(e),t!==-1)){this.nodes[t].insert(e);return}if(this.objects.push(e),this.objects.length>this.max_objects&&this.level<this.max_levels){this.nodes.length===0&&this.split();let i=0;for(;i<this.objects.length;)t=this.getIndex(this.objects[i]),t!==-1?this.nodes[t].insert(this.objects.splice(i,1)[0]):i=i+1}}retrieve(e,t){let i=this.objects;if(this.nodes.length>0){let r=this.getIndex(e);if(r!==-1)i=i.concat(this.nodes[r].retrieve(e));else for(let n=0;n<this.nodes.length;n=n+1)i=i.concat(this.nodes[n].retrieve(e))}return typeof t=="function"&&i.sort(t),i}remove(e){let t=!1;if(typeof e.getBounds=="undefined")return!1;if(this.nodes.length>0){let i=this.getIndex(e);i!==-1&&(t=Hi(this.nodes[i],e),t&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1))}return t===!1&&this.objects.indexOf(e)!==-1&&(Hi(this.objects,e),t=!0),t}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(let e=0;e<this.nodes.length;e=e+1){const t=this.nodes[e];if(t.length>0||t.objects.length>0)return!0}return!1}clear(e){this.objects.length=0;for(let t=0;t<this.nodes.length;t++)this.nodes[t].clear(),Hp(this.nodes[t]);this.nodes.length=0,typeof e!="undefined"&&this.bounds.setMinMax(e.min.x,e.min.y,e.max.x,e.max.y)}}class de{constructor(e){this._center=new B,this.onResetEvent(e),this.type="Bounds"}onResetEvent(e){typeof this.min=="undefined"?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),typeof e!="undefined"&&this.update(e)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(e,t,i,r){this.min.x=e,this.min.y=t,this.max.x=i,this.max.y=r}get x(){return this.min.x}set x(e){let t=this.max.x-this.min.x;this.min.x=e,this.max.x=e+t}get y(){return this.min.y}set y(e){let t=this.max.y-this.min.y;this.min.y=e,this.max.y=e+t}get width(){return this.max.x-this.min.x}set width(e){this.max.x=this.min.x+e}get height(){return this.max.y-this.min.y}set height(e){this.max.y=this.min.y+e}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}centerOn(e,t){return this.shift(e-this.width/2,t-this.height/2),this}update(e){this.add(e,!0)}add(e,t=!1){const i=e.length;t===!0&&this.clear();for(let r=0;r<i;r++){const n=e[r];n.x>this.max.x&&(this.max.x=n.x),n.x<this.min.x&&(this.min.x=n.x),n.y>this.max.y&&(this.max.y=n.y),n.y<this.min.y&&(this.min.y=n.y)}}addBounds(e,t=!1){t===!0?(this.max.x=e.max.x,this.min.x=e.min.x,this.max.y=e.max.y,this.min.y=e.min.y):(e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.y>this.max.y&&(this.max.y=e.max.y),e.min.y<this.min.y&&(this.min.y=e.min.y))}addPoint(e,t){typeof t!="undefined"&&(e=t.apply(e)),this.min.x=Math.min(this.min.x,e.x),this.max.x=Math.max(this.max.x,e.x),this.min.y=Math.min(this.min.y,e.y),this.max.y=Math.max(this.max.y,e.y)}addFrame(e,t,i,r,n){let o=g.pull("Point");this.addPoint(o.set(e,t),n),this.addPoint(o.set(i,t),n),this.addPoint(o.set(e,r),n),this.addPoint(o.set(i,r),n),g.push(o)}contains(){let e=arguments[0],t,i,r,n;return arguments.length===2?(t=i=e,r=n=arguments[1]):typeof e.max!="undefined"?(t=e.min.x,i=e.max.x,r=e.min.y,n=e.max.y):(t=i=e.x,r=n=e.y),t>=this.min.x&&i<=this.max.x&&r>=this.min.y&&n<=this.max.y}overlaps(e){return!(this.right<e.left||this.left>e.right||this.bottom<e.top||this.top>e.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){let e,t;arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.min.x+=e,this.max.x+=e,this.min.y+=t,this.max.y+=t}shift(){let e,t;arguments.length===2?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);let i=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=e,this.max.x=e+i,this.min.y=t,this.max.y=t+r}clone(){let e=new de;return e.addBounds(this),e}toPolygon(){return g.pull("Polygon",this.x,this.y,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])}}let Q={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295}};function ft(s,e,...t){return setTimeout(s.bind(e),.01,...t)}function vr(s,e,t){let i=globalThis.performance.now(),r;return typeof t!="boolean"&&(t=!1),function(){let n=globalThis.performance.now(),o=n-i,l=arguments;if(o<e)t===!1&&(clearTimeout(r),r=setTimeout(()=>(i=n,s.apply(null,l)),o));else return i=n,s.apply(null,l)}}var Il={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(u,h,d){this.fn=u,this.context=h,this.once=d||!1}function n(u,h,d,a,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var c=new r(d,a||u,f),p=t?t+h:h;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],c]:u._events[p].push(c):(u._events[p]=c,u._eventsCount++),u}function o(u,h){--u._eventsCount===0?u._events=new i:delete u._events[h]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var h=[],d,a;if(this._eventsCount===0)return h;for(a in d=this._events)e.call(d,a)&&h.push(t?a.slice(1):a);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(d)):h},l.prototype.listeners=function(h){var d=t?t+h:h,a=this._events[d];if(!a)return[];if(a.fn)return[a.fn];for(var f=0,c=a.length,p=new Array(c);f<c;f++)p[f]=a[f].fn;return p},l.prototype.listenerCount=function(h){var d=t?t+h:h,a=this._events[d];return a?a.fn?1:a.length:0},l.prototype.emit=function(h,d,a,f,c,p){var y=t?t+h:h;if(!this._events[y])return!1;var v=this._events[y],m=arguments.length,_,x;if(v.fn){switch(v.once&&this.removeListener(h,v.fn,void 0,!0),m){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,a),!0;case 4:return v.fn.call(v.context,d,a,f),!0;case 5:return v.fn.call(v.context,d,a,f,c),!0;case 6:return v.fn.call(v.context,d,a,f,c,p),!0}for(x=1,_=new Array(m-1);x<m;x++)_[x-1]=arguments[x];v.fn.apply(v.context,_)}else{var b=v.length,E;for(x=0;x<b;x++)switch(v[x].once&&this.removeListener(h,v[x].fn,void 0,!0),m){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,d);break;case 3:v[x].fn.call(v[x].context,d,a);break;case 4:v[x].fn.call(v[x].context,d,a,f);break;default:if(!_)for(E=1,_=new Array(m-1);E<m;E++)_[E-1]=arguments[E];v[x].fn.apply(v[x].context,_)}}return!0},l.prototype.on=function(h,d,a){return n(this,h,d,a,!1)},l.prototype.once=function(h,d,a){return n(this,h,d,a,!0)},l.prototype.removeListener=function(h,d,a,f){var c=t?t+h:h;if(!this._events[c])return this;if(!d)return o(this,c),this;var p=this._events[c];if(p.fn)p.fn===d&&(!f||p.once)&&(!a||p.context===a)&&o(this,c);else{for(var y=0,v=[],m=p.length;y<m;y++)(p[y].fn!==d||f&&!p[y].once||a&&p[y].context!==a)&&v.push(p[y]);v.length?this._events[c]=v.length===1?v[0]:v:o(this,c)}return this},l.prototype.removeAllListeners=function(h){var d;return h?(d=t?t+h:h,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,s.exports=l})(Il);var Yp=Il.exports,Wp=Da(Yp);let ls=new Wp;const Ol="dom_ready",hs="me.boot",Ml="me.tick",_r="me.blur",xr="me.focus",br="me.state.onPause",ri="me.state.onResume",Kp="me.state.onStop",on="me.state.onRestart",an="me.state.onChange",Ll="me.stage.onReset",ln="me.video.onInit",qp="me.game.onInit",pi="me.game.onReset",hn="me.game.beforeUpdate",Zp="me.game.afterUpdate",Qp="me.game.onUpdate",Jp="me.game.beforeDraw",eg="me.game.afterDraw",tg="me.world.step",Yi="me.game.onLevelLoaded",ig="me.loader.onload",wr="me.loader.onProgress",sg="me.loader.onError",rg="me.input.keydown",ng="me.input.keyup",og="gamepad.connected",ag="gamepad.disconnected",To="gamepad.update",lg="me.event.pointermove",hg="me.event.pointerlockChange",Bl="globalThis.onresize",us="canvas.onresize",ct="viewport.onresize",Ui="globalThis.orientationchange",ug="globalThis.onscroll",Tr="viewport.onchange",un="renderer.contextlost",Wi="renderer.contextrestored";function D(s,...e){return ls.emit(s,...e)}function U(s,e,t){return ls.on(s,e,t)}function kt(s,e,t){return ls.once(s,e,t)}function Fe(s,e){return ls.off(s,e)}var Er={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var e=function(){this.init()};e.prototype={init:function(){var a=this||t;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var f=this||t;if(a=parseFloat(a),f.ctx||d(),typeof a!="undefined"&&a>=0&&a<=1){if(f._volume=a,f._muted)return f;f.usingWebAudio&&f.masterGain.gain.setValueAtTime(a,t.ctx.currentTime);for(var c=0;c<f._howls.length;c++)if(!f._howls[c]._webAudio)for(var p=f._howls[c]._getSoundIds(),y=0;y<p.length;y++){var v=f._howls[c]._soundById(p[y]);v&&v._node&&(v._node.volume=v._volume*a)}return f}return f._volume},mute:function(a){var f=this||t;f.ctx||d(),f._muted=a,f.usingWebAudio&&f.masterGain.gain.setValueAtTime(a?0:f._volume,t.ctx.currentTime);for(var c=0;c<f._howls.length;c++)if(!f._howls[c]._webAudio)for(var p=f._howls[c]._getSoundIds(),y=0;y<p.length;y++){var v=f._howls[c]._soundById(p[y]);v&&v._node&&(v._node.muted=a?!0:v._muted)}return f},stop:function(){for(var a=this||t,f=0;f<a._howls.length;f++)a._howls[f].stop();return a},unload:function(){for(var a=this||t,f=a._howls.length-1;f>=0;f--)a._howls[f].unload();return a.usingWebAudio&&a.ctx&&typeof a.ctx.close!="undefined"&&(a.ctx.close(),a.ctx=null,d()),a},codecs:function(a){return(this||t)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||t;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if(typeof Audio!="undefined")try{var f=new Audio;typeof f.oncanplaythrough=="undefined"&&(a._canPlayEvent="canplay")}catch(c){a.noAudio=!0}else a.noAudio=!0;try{var f=new Audio;f.muted&&(a.noAudio=!0)}catch(c){}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||t,f=null;try{f=typeof Audio!="undefined"?new Audio:null}catch(b){return a}if(!f||typeof f.canPlayType!="function")return a;var c=f.canPlayType("audio/mpeg;").replace(/^no$/,""),p=a._navigator?a._navigator.userAgent:"",y=p.match(/OPR\/(\d+)/g),v=y&&parseInt(y[0].split("/")[1],10)<33,m=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,_=p.match(/Version\/(.*?) /),x=m&&_&&parseInt(_[1],10)<15;return a._codecs={mp3:!!(!v&&(c||f.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!c,opus:!!f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(f.canPlayType('audio/wav; codecs="1"')||f.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!f.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!f.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/m4a;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(f.canPlayType("audio/x-m4b;")||f.canPlayType("audio/m4b;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(f.canPlayType("audio/x-mp4;")||f.canPlayType("audio/mp4;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!f.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(f.canPlayType("audio/x-flac;")||f.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||t;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,!a._mobileUnloaded&&a.ctx.sampleRate!==44100&&(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var f=function(c){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,a._releaseHtml5Audio(p)}catch(b){a.noAudio=!0;break}for(var y=0;y<a._howls.length;y++)if(!a._howls[y]._webAudio)for(var v=a._howls[y]._getSoundIds(),m=0;m<v.length;m++){var _=a._howls[y]._soundById(v[m]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}a._autoResume();var x=a.ctx.createBufferSource();x.buffer=a._scratchBuffer,x.connect(a.ctx.destination),typeof x.start=="undefined"?x.noteOn(0):x.start(0),typeof a.ctx.resume=="function"&&a.ctx.resume(),x.onended=function(){x.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",f,!0),document.removeEventListener("touchend",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("keydown",f,!0);for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",f,!0),document.addEventListener("touchend",f,!0),document.addEventListener("click",f,!0),document.addEventListener("keydown",f,!0),a}},_obtainHtml5Audio:function(){var a=this||t;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var f=new Audio().play();return f&&typeof Promise!="undefined"&&(f instanceof Promise||typeof f.then=="function")&&f.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var f=this||t;return a._unlocked&&f._html5AudioPool.push(a),f},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx||typeof a.ctx.suspend=="undefined"||!t.usingWebAudio)){for(var f=0;f<a._howls.length;f++)if(a._howls[f]._webAudio){for(var c=0;c<a._howls[f]._sounds.length;c++)if(!a._howls[f]._sounds[c]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var p=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(p,p)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx||typeof a.ctx.resume=="undefined"||!t.usingWebAudio))return a.state==="running"&&a.ctx.state!=="interrupted"&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):a.state==="suspended"||a.state==="running"&&a.ctx.state==="interrupted"?(a.ctx.resume().then(function(){a.state="running";for(var f=0;f<a._howls.length;f++)a._howls[f]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):a.state==="suspending"&&(a._resumeAfterSuspend=!0),a}};var t=new e,i=function(a){var f=this;if(!a.src||a.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}f.init(a)};i.prototype={init:function(a){var f=this;return t.ctx||d(),f._autoplay=a.autoplay||!1,f._format=typeof a.format!="string"?a.format:[a.format],f._html5=a.html5||!1,f._muted=a.mute||!1,f._loop=a.loop||!1,f._pool=a.pool||5,f._preload=typeof a.preload=="boolean"||a.preload==="metadata"?a.preload:!0,f._rate=a.rate||1,f._sprite=a.sprite||{},f._src=typeof a.src!="string"?a.src:[a.src],f._volume=a.volume!==void 0?a.volume:1,f._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1},f._duration=0,f._state="unloaded",f._sounds=[],f._endTimers={},f._queue=[],f._playLock=!1,f._onend=a.onend?[{fn:a.onend}]:[],f._onfade=a.onfade?[{fn:a.onfade}]:[],f._onload=a.onload?[{fn:a.onload}]:[],f._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],f._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],f._onpause=a.onpause?[{fn:a.onpause}]:[],f._onplay=a.onplay?[{fn:a.onplay}]:[],f._onstop=a.onstop?[{fn:a.onstop}]:[],f._onmute=a.onmute?[{fn:a.onmute}]:[],f._onvolume=a.onvolume?[{fn:a.onvolume}]:[],f._onrate=a.onrate?[{fn:a.onrate}]:[],f._onseek=a.onseek?[{fn:a.onseek}]:[],f._onunlock=a.onunlock?[{fn:a.onunlock}]:[],f._onresume=[],f._webAudio=t.usingWebAudio&&!f._html5,typeof t.ctx!="undefined"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(f),f._autoplay&&f._queue.push({event:"play",action:function(){f.play()}}),f._preload&&f._preload!=="none"&&f.load(),f},load:function(){var a=this,f=null;if(t.noAudio){a._emit("loaderror",null,"No audio support.");return}typeof a._src=="string"&&(a._src=[a._src]);for(var c=0;c<a._src.length;c++){var p,y;if(a._format&&a._format[c])p=a._format[c];else{if(y=a._src[c],typeof y!="string"){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(y),p||(p=/\.([^.]+)$/.exec(y.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&t.codecs(p)){f=a._src[c];break}}if(!f){a._emit("loaderror",null,"No codec support for selected audio sources.");return}return a._src=f,a._state="loading",window.location.protocol==="https:"&&f.slice(0,5)==="http:"&&(a._html5=!0,a._webAudio=!1),new r(a),a._webAudio&&o(a),a},play:function(a,f){var c=this,p=null;if(typeof a=="number")p=a,a=null;else{if(typeof a=="string"&&c._state==="loaded"&&!c._sprite[a])return null;if(typeof a=="undefined"&&(a="__default",!c._playLock)){for(var y=0,v=0;v<c._sounds.length;v++)c._sounds[v]._paused&&!c._sounds[v]._ended&&(y++,p=c._sounds[v]._id);y===1?a=null:p=null}}var m=p?c._soundById(p):c._inactiveSound();if(!m)return null;if(p&&!a&&(a=m._sprite||"__default"),c._state!=="loaded"){m._sprite=a,m._ended=!1;var _=m._id;return c._queue.push({event:"play",action:function(){c.play(_)}}),_}if(p&&!m._paused)return f||c._loadQueue("play"),m._id;c._webAudio&&t._autoResume();var x=Math.max(0,m._seek>0?m._seek:c._sprite[a][0]/1e3),b=Math.max(0,(c._sprite[a][0]+c._sprite[a][1])/1e3-x),E=b*1e3/Math.abs(m._rate),S=c._sprite[a][0]/1e3,I=(c._sprite[a][0]+c._sprite[a][1])/1e3;m._sprite=a,m._ended=!1;var j=function(){m._paused=!1,m._seek=x,m._start=S,m._stop=I,m._loop=!!(m._loop||c._sprite[a][2])};if(x>=I){c._ended(m);return}var N=m._node;if(c._webAudio){var X=function(){c._playLock=!1,j(),c._refreshBuffer(m);var w=m._muted||c._muted?0:m._volume;N.gain.setValueAtTime(w,t.ctx.currentTime),m._playStart=t.ctx.currentTime,typeof N.bufferSource.start=="undefined"?m._loop?N.bufferSource.noteGrainOn(0,x,86400):N.bufferSource.noteGrainOn(0,x,b):m._loop?N.bufferSource.start(0,x,86400):N.bufferSource.start(0,x,b),E!==1/0&&(c._endTimers[m._id]=setTimeout(c._ended.bind(c,m),E)),f||setTimeout(function(){c._emit("play",m._id),c._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?X():(c._playLock=!0,c.once("resume",X),c._clearTimer(m._id))}else{var K=function(){N.currentTime=x,N.muted=m._muted||c._muted||t._muted||N.muted,N.volume=m._volume*t.volume(),N.playbackRate=m._rate;try{var w=N.play();if(w&&typeof Promise!="undefined"&&(w instanceof Promise||typeof w.then=="function")?(c._playLock=!0,j(),w.then(function(){c._playLock=!1,N._unlocked=!0,f?c._loadQueue():c._emit("play",m._id)}).catch(function(){c._playLock=!1,c._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):f||(c._playLock=!1,j(),c._emit("play",m._id)),N.playbackRate=m._rate,N.paused){c._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}a!=="__default"||m._loop?c._endTimers[m._id]=setTimeout(c._ended.bind(c,m),E):(c._endTimers[m._id]=function(){c._ended(m),N.removeEventListener("ended",c._endTimers[m._id],!1)},N.addEventListener("ended",c._endTimers[m._id],!1))}catch(C){c._emit("playerror",m._id,C)}};N.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(N.src=c._src,N.load());var q=window&&window.ejecta||!N.readyState&&t._navigator.isCocoonJS;if(N.readyState>=3||q)K();else{c._playLock=!0,c._state="loading";var T=function(){c._state="loaded",K(),N.removeEventListener(t._canPlayEvent,T,!1)};N.addEventListener(t._canPlayEvent,T,!1),c._clearTimer(m._id)}}return m._id},pause:function(a){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"pause",action:function(){f.pause(a)}}),f;for(var c=f._getSoundIds(a),p=0;p<c.length;p++){f._clearTimer(c[p]);var y=f._soundById(c[p]);if(y&&!y._paused&&(y._seek=f.seek(c[p]),y._rateSeek=0,y._paused=!0,f._stopFade(c[p]),y._node))if(f._webAudio){if(!y._node.bufferSource)continue;typeof y._node.bufferSource.stop=="undefined"?y._node.bufferSource.noteOff(0):y._node.bufferSource.stop(0),f._cleanBuffer(y._node)}else(!isNaN(y._node.duration)||y._node.duration===1/0)&&y._node.pause();arguments[1]||f._emit("pause",y?y._id:null)}return f},stop:function(a,f){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var p=c._getSoundIds(a),y=0;y<p.length;y++){c._clearTimer(p[y]);var v=c._soundById(p[y]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,c._stopFade(p[y]),v._node&&(c._webAudio?v._node.bufferSource&&(typeof v._node.bufferSource.stop=="undefined"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),c._cleanBuffer(v._node)):(!isNaN(v._node.duration)||v._node.duration===1/0)&&(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&c._clearSound(v._node))),f||c._emit("stop",v._id))}return c},mute:function(a,f){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"mute",action:function(){c.mute(a,f)}}),c;if(typeof f=="undefined")if(typeof a=="boolean")c._muted=a;else return c._muted;for(var p=c._getSoundIds(f),y=0;y<p.length;y++){var v=c._soundById(p[y]);v&&(v._muted=a,v._interval&&c._stopFade(v._id),c._webAudio&&v._node?v._node.gain.setValueAtTime(a?0:v._volume,t.ctx.currentTime):v._node&&(v._node.muted=t._muted?!0:a),c._emit("mute",v._id))}return c},volume:function(){var a=this,f=arguments,c,p;if(f.length===0)return a._volume;if(f.length===1||f.length===2&&typeof f[1]=="undefined"){var y=a._getSoundIds(),v=y.indexOf(f[0]);v>=0?p=parseInt(f[0],10):c=parseFloat(f[0])}else f.length>=2&&(c=parseFloat(f[0]),p=parseInt(f[1],10));var m;if(typeof c!="undefined"&&c>=0&&c<=1){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,f)}}),a;typeof p=="undefined"&&(a._volume=c),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)m=a._soundById(p[_]),m&&(m._volume=c,f[2]||a._stopFade(p[_]),a._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(c,t.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=c*t.volume()),a._emit("volume",m._id))}else return m=p?a._soundById(p):a._sounds[0],m?m._volume:0;return a},fade:function(a,f,c,p){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"fade",action:function(){y.fade(a,f,c,p)}}),y;a=Math.min(Math.max(0,parseFloat(a)),1),f=Math.min(Math.max(0,parseFloat(f)),1),c=parseFloat(c),y.volume(a,p);for(var v=y._getSoundIds(p),m=0;m<v.length;m++){var _=y._soundById(v[m]);if(_){if(p||y._stopFade(v[m]),y._webAudio&&!_._muted){var x=t.ctx.currentTime,b=x+c/1e3;_._volume=a,_._node.gain.setValueAtTime(a,x),_._node.gain.linearRampToValueAtTime(f,b)}y._startFadeInterval(_,a,f,c,v[m],typeof p=="undefined")}}return y},_startFadeInterval:function(a,f,c,p,y,v){var m=this,_=f,x=c-f,b=Math.abs(x/.01),E=Math.max(4,b>0?p/b:p),S=Date.now();a._fadeTo=c,a._interval=setInterval(function(){var I=(Date.now()-S)/p;S=Date.now(),_+=x*I,_=Math.round(_*100)/100,x<0?_=Math.max(c,_):_=Math.min(c,_),m._webAudio?a._volume=_:m.volume(_,a._id,!0),v&&(m._volume=_),(c<f&&_<=c||c>f&&_>=c)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,m.volume(c,a._id),m._emit("fade",a._id))},E)},_stopFade:function(a){var f=this,c=f._soundById(a);return c&&c._interval&&(f._webAudio&&c._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(c._interval),c._interval=null,f.volume(c._fadeTo,a),c._fadeTo=null,f._emit("fade",a)),f},loop:function(){var a=this,f=arguments,c,p,y;if(f.length===0)return a._loop;if(f.length===1)if(typeof f[0]=="boolean")c=f[0],a._loop=c;else return y=a._soundById(parseInt(f[0],10)),y?y._loop:!1;else f.length===2&&(c=f[0],p=parseInt(f[1],10));for(var v=a._getSoundIds(p),m=0;m<v.length;m++)y=a._soundById(v[m]),y&&(y._loop=c,a._webAudio&&y._node&&y._node.bufferSource&&(y._node.bufferSource.loop=c,c&&(y._node.bufferSource.loopStart=y._start||0,y._node.bufferSource.loopEnd=y._stop,a.playing(v[m])&&(a.pause(v[m],!0),a.play(v[m],!0)))));return a},rate:function(){var a=this,f=arguments,c,p;if(f.length===0)p=a._sounds[0]._id;else if(f.length===1){var y=a._getSoundIds(),v=y.indexOf(f[0]);v>=0?p=parseInt(f[0],10):c=parseFloat(f[0])}else f.length===2&&(c=parseFloat(f[0]),p=parseInt(f[1],10));var m;if(typeof c=="number"){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,f)}}),a;typeof p=="undefined"&&(a._rate=c),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)if(m=a._soundById(p[_]),m){a.playing(p[_])&&(m._rateSeek=a.seek(p[_]),m._playStart=a._webAudio?t.ctx.currentTime:m._playStart),m._rate=c,a._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(c,t.ctx.currentTime):m._node&&(m._node.playbackRate=c);var x=a.seek(p[_]),b=(a._sprite[m._sprite][0]+a._sprite[m._sprite][1])/1e3-x,E=b*1e3/Math.abs(m._rate);(a._endTimers[p[_]]||!m._paused)&&(a._clearTimer(p[_]),a._endTimers[p[_]]=setTimeout(a._ended.bind(a,m),E)),a._emit("rate",m._id)}}else return m=a._soundById(p),m?m._rate:a._rate;return a},seek:function(){var a=this,f=arguments,c,p;if(f.length===0)a._sounds.length&&(p=a._sounds[0]._id);else if(f.length===1){var y=a._getSoundIds(),v=y.indexOf(f[0]);v>=0?p=parseInt(f[0],10):a._sounds.length&&(p=a._sounds[0]._id,c=parseFloat(f[0]))}else f.length===2&&(c=parseFloat(f[0]),p=parseInt(f[1],10));if(typeof p=="undefined")return 0;if(typeof c=="number"&&(a._state!=="loaded"||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,f)}}),a;var m=a._soundById(p);if(m)if(typeof c=="number"&&c>=0){var _=a.playing(p);_&&a.pause(p,!0),m._seek=c,m._ended=!1,a._clearTimer(p),!a._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=c);var x=function(){_&&a.play(p,!0),a._emit("seek",p)};if(_&&!a._webAudio){var b=function(){a._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else if(a._webAudio){var E=a.playing(p)?t.ctx.currentTime-m._playStart:0,S=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(S+E*Math.abs(m._rate))}else return m._node.currentTime;return a},playing:function(a){var f=this;if(typeof a=="number"){var c=f._soundById(a);return c?!c._paused:!1}for(var p=0;p<f._sounds.length;p++)if(!f._sounds[p]._paused)return!0;return!1},duration:function(a){var f=this,c=f._duration,p=f._soundById(a);return p&&(c=f._sprite[p._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,f=a._sounds,c=0;c<f.length;c++)f[c]._paused||a.stop(f[c]._id),a._webAudio||(a._clearSound(f[c]._node),f[c]._node.removeEventListener("error",f[c]._errorFn,!1),f[c]._node.removeEventListener(t._canPlayEvent,f[c]._loadFn,!1),f[c]._node.removeEventListener("ended",f[c]._endFn,!1),t._releaseHtml5Audio(f[c]._node)),delete f[c]._node,a._clearTimer(f[c]._id);var p=t._howls.indexOf(a);p>=0&&t._howls.splice(p,1);var y=!0;for(c=0;c<t._howls.length;c++)if(t._howls[c]._src===a._src||a._src.indexOf(t._howls[c]._src)>=0){y=!1;break}return n&&y&&delete n[a._src],t.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,f,c,p){var y=this,v=y["_on"+a];return typeof f=="function"&&v.push(p?{id:c,fn:f,once:p}:{id:c,fn:f}),y},off:function(a,f,c){var p=this,y=p["_on"+a],v=0;if(typeof f=="number"&&(c=f,f=null),f||c)for(v=0;v<y.length;v++){var m=c===y[v].id;if(f===y[v].fn&&m||!f&&m){y.splice(v,1);break}}else if(a)p["_on"+a]=[];else{var _=Object.keys(p);for(v=0;v<_.length;v++)_[v].indexOf("_on")===0&&Array.isArray(p[_[v]])&&(p[_[v]]=[])}return p},once:function(a,f,c){var p=this;return p.on(a,f,c,1),p},_emit:function(a,f,c){for(var p=this,y=p["_on"+a],v=y.length-1;v>=0;v--)(!y[v].id||y[v].id===f||a==="load")&&(setTimeout(function(m){m.call(this,f,c)}.bind(p,y[v].fn),0),y[v].once&&p.off(a,y[v].fn,y[v].id));return p._loadQueue(a),p},_loadQueue:function(a){var f=this;if(f._queue.length>0){var c=f._queue[0];c.event===a&&(f._queue.shift(),f._loadQueue()),a||c.action()}return f},_ended:function(a){var f=this,c=a._sprite;if(!f._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(f._ended.bind(f,a),100),f;var p=!!(a._loop||f._sprite[c][2]);if(f._emit("end",a._id),!f._webAudio&&p&&f.stop(a._id,!0).play(a._id),f._webAudio&&p){f._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=t.ctx.currentTime;var y=(a._stop-a._start)*1e3/Math.abs(a._rate);f._endTimers[a._id]=setTimeout(f._ended.bind(f,a),y)}return f._webAudio&&!p&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,f._clearTimer(a._id),f._cleanBuffer(a._node),t._autoSuspend()),!f._webAudio&&!p&&f.stop(a._id,!0),f},_clearTimer:function(a){var f=this;if(f._endTimers[a]){if(typeof f._endTimers[a]!="function")clearTimeout(f._endTimers[a]);else{var c=f._soundById(a);c&&c._node&&c._node.removeEventListener("ended",f._endTimers[a],!1)}delete f._endTimers[a]}return f},_soundById:function(a){for(var f=this,c=0;c<f._sounds.length;c++)if(a===f._sounds[c]._id)return f._sounds[c];return null},_inactiveSound:function(){var a=this;a._drain();for(var f=0;f<a._sounds.length;f++)if(a._sounds[f]._ended)return a._sounds[f].reset();return new r(a)},_drain:function(){var a=this,f=a._pool,c=0,p=0;if(!(a._sounds.length<f)){for(p=0;p<a._sounds.length;p++)a._sounds[p]._ended&&c++;for(p=a._sounds.length-1;p>=0;p--){if(c<=f)return;a._sounds[p]._ended&&(a._webAudio&&a._sounds[p]._node&&a._sounds[p]._node.disconnect(0),a._sounds.splice(p,1),c--)}}},_getSoundIds:function(a){var f=this;if(typeof a=="undefined"){for(var c=[],p=0;p<f._sounds.length;p++)c.push(f._sounds[p]._id);return c}else return[a]},_refreshBuffer:function(a){var f=this;return a._node.bufferSource=t.ctx.createBufferSource(),a._node.bufferSource.buffer=n[f._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,t.ctx.currentTime),f},_cleanBuffer:function(a){var f=this,c=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!a.bufferSource)return f;if(t._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),c))try{a.bufferSource.buffer=t._scratchBuffer}catch(p){}return a.bufferSource=null,f},_clearSound:function(a){var f=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);f||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(a){this._parent=a,this.init()};r.prototype={init:function(){var a=this,f=a._parent;return a._muted=f._muted,a._loop=f._loop,a._volume=f._volume,a._rate=f._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++t._counter,f._sounds.push(a),a.create(),a},create:function(){var a=this,f=a._parent,c=t._muted||a._muted||a._parent._muted?0:a._volume;return f._webAudio?(a._node=typeof t.ctx.createGain=="undefined"?t.ctx.createGainNode():t.ctx.createGain(),a._node.gain.setValueAtTime(c,t.ctx.currentTime),a._node.paused=!0,a._node.connect(t.masterGain)):t.noAudio||(a._node=t._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(t._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=f._src,a._node.preload=f._preload===!0?"auto":f._preload,a._node.volume=c*t.volume(),a._node.load()),a},reset:function(){var a=this,f=a._parent;return a._muted=f._muted,a._loop=f._loop,a._volume=f._volume,a._rate=f._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++t._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,f=a._parent;f._duration=Math.ceil(a._node.duration*10)/10,Object.keys(f._sprite).length===0&&(f._sprite={__default:[0,f._duration*1e3]}),f._state!=="loaded"&&(f._state="loaded",f._emit("load"),f._loadQueue()),a._node.removeEventListener(t._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,f=a._parent;f._duration===1/0&&(f._duration=Math.ceil(a._node.duration*10)/10,f._sprite.__default[1]===1/0&&(f._sprite.__default[1]=f._duration*1e3),f._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}};var n={},o=function(a){var f=a._src;if(n[f]){a._duration=n[f].duration,h(a);return}if(/^data:[^;]+;base64,/.test(f)){for(var c=atob(f.split(",")[1]),p=new Uint8Array(c.length),y=0;y<c.length;++y)p[y]=c.charCodeAt(y);u(p.buffer,a)}else{var v=new XMLHttpRequest;v.open(a._xhr.method,f,!0),v.withCredentials=a._xhr.withCredentials,v.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(m){v.setRequestHeader(m,a._xhr.headers[m])}),v.onload=function(){var m=(v.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){a._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");return}u(v.response,a)},v.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete n[f],a.load())},l(v)}},l=function(a){try{a.send()}catch(f){a.onerror()}},u=function(a,f){var c=function(){f._emit("loaderror",null,"Decoding audio data failed.")},p=function(y){y&&f._sounds.length>0?(n[f._src]=y,h(f,y)):c()};typeof Promise!="undefined"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(a).then(p).catch(c):t.ctx.decodeAudioData(a,p,c)},h=function(a,f){f&&!a._duration&&(a._duration=f.duration),Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue())},d=function(){if(t.usingWebAudio){try{typeof AudioContext!="undefined"?t.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(y){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),f=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=f?parseInt(f[1],10):null;if(a&&c&&c<9){var p=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!p&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain=="undefined"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};s.Howler=t,s.Howl=i,typeof Be!="undefined"?(Be.HowlerGlobal=e,Be.Howler=t,Be.Howl=i,Be.Sound=r):typeof window!="undefined"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=i,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(t);return i},HowlerGlobal.prototype.pos=function(t,i,r){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,r=typeof r!="number"?n._pos[2]:r,typeof t=="number")n._pos=[t,i,r],typeof n.ctx.listener.positionX!="undefined"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(t,i,r,n,o,l){var u=this;if(!u.ctx||!u.ctx.listener)return u;var h=u._orientation;if(i=typeof i!="number"?h[1]:i,r=typeof r!="number"?h[2]:r,n=typeof n!="number"?h[3]:n,o=typeof o!="number"?h[4]:o,l=typeof l!="number"?h[5]:l,typeof t=="number")u._orientation=[t,i,r,n,o,l],typeof u.ctx.listener.forwardX!="undefined"?(u.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(l,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(t,i,r,n,o,l);else return h;return u},Howl.prototype.init=function(t){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle!="undefined"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle!="undefined"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain!="undefined"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel!="undefined"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance!="undefined"?i.maxDistance:1e4,panningModel:typeof i.panningModel!="undefined"?i.panningModel:"HRTF",refDistance:typeof i.refDistance!="undefined"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor!="undefined"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],t.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(t,i)}}),r;var n=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof i=="undefined")if(typeof t=="number")r._stereo=t,r._pos=[t,0,0];else return r._stereo;for(var o=r._getSoundIds(i),l=0;l<o.length;l++){var u=r._soundById(o[l]);if(u)if(typeof t=="number")u._stereo=t,u._pos=[t,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&e(u,n),n==="spatial"?typeof u._panner.positionX!="undefined"?(u._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(t,0,0):u._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",u._id);else return u._stereo}return r},Howl.prototype.pos=function(t,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(t,i,r,n)}}),o;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof n=="undefined")if(typeof t=="number")o._pos=[t,i,r];else return o._pos;for(var l=o._getSoundIds(n),u=0;u<l.length;u++){var h=o._soundById(l[u]);if(h)if(typeof t=="number")h._pos=[t,i,r],h._node&&((!h._panner||h._panner.pan)&&e(h,"spatial"),typeof h._panner.positionX!="undefined"?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):h._panner.setPosition(t,i,r)),o._emit("pos",h._id);else return h._pos}return o},Howl.prototype.orientation=function(t,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(t,i,r,n)}}),o;if(i=typeof i!="number"?o._orientation[1]:i,r=typeof r!="number"?o._orientation[2]:r,typeof n=="undefined")if(typeof t=="number")o._orientation=[t,i,r];else return o._orientation;for(var l=o._getSoundIds(n),u=0;u<l.length;u++){var h=o._soundById(l[u]);if(h)if(typeof t=="number")h._orientation=[t,i,r],h._node&&(h._panner||(h._pos||(h._pos=o._pos||[0,0,-.5]),e(h,"spatial")),typeof h._panner.orientationX!="undefined"?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,r)),o._emit("orientation",h._id);else return h._orientation}return o},Howl.prototype.pannerAttr=function(){var t=this,i=arguments,r,n,o;if(!t._webAudio)return t;if(i.length===0)return t._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof n=="undefined"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),t._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle!="undefined"?r.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle!="undefined"?r.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain!="undefined"?r.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel!="undefined"?r.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance!="undefined"?r.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof r.pannerAttr.refDistance!="undefined"?r.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor!="undefined"?r.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel!="undefined"?r.pannerAttr.panningModel:t._panningModel});else return o=t._soundById(parseInt(i[0],10)),o?o._pannerAttr:t._pannerAttr;else i.length===2&&(r=i[0],n=parseInt(i[1],10));for(var l=t._getSoundIds(n),u=0;u<l.length;u++)if(o=t._soundById(l[u]),o){var h=o._pannerAttr;h={coneInnerAngle:typeof r.coneInnerAngle!="undefined"?r.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle!="undefined"?r.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain!="undefined"?r.coneOuterGain:h.coneOuterGain,distanceModel:typeof r.distanceModel!="undefined"?r.distanceModel:h.distanceModel,maxDistance:typeof r.maxDistance!="undefined"?r.maxDistance:h.maxDistance,refDistance:typeof r.refDistance!="undefined"?r.refDistance:h.refDistance,rolloffFactor:typeof r.rolloffFactor!="undefined"?r.rolloffFactor:h.rolloffFactor,panningModel:typeof r.panningModel!="undefined"?r.panningModel:h.panningModel};var d=o._panner;d||(o._pos||(o._pos=t._pos||[0,0,-.5]),e(o,"spatial"),d=o._panner),d.coneInnerAngle=h.coneInnerAngle,d.coneOuterAngle=h.coneOuterAngle,d.coneOuterGain=h.coneOuterGain,d.distanceModel=h.distanceModel,d.maxDistance=h.maxDistance,d.refDistance=h.refDistance,d.rolloffFactor=h.rolloffFactor,d.panningModel=h.panningModel}return t},Sound.prototype.init=function(t){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,t.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),t.call(this)}}(Sound.prototype.reset);var e=function(t,i){i=i||"spatial",i==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX!="undefined"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX!="undefined"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(Er);function Dl(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Nl(s){return typeof s=="string"&&(s=s.trim()),!isNaN(s)&&/^[+-]?(\d+(\.\d+)?|\.\d+)$/.test(s)}function fg(s){const e=s.trim();return e==="true"||e==="false"}function cg(s){let e="",t=0;for(;t<s.length;)e+=s.charCodeAt(t++).toString(16);return e}function Ki(s){return/^data:(.+);base64,(.+)$/.test(s)}let ot={},kl=0,Xs=[],dg=function(s,e){if(kl++>3){let t="melonJS: failed loading "+s;throw new Error(t)}else ot[s].load()};function pg(s,e,t,i={}){let r=[];if(Xs.length===0)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(Ki(s.src)===!0)r.push(s.src);else for(let n=0;n<Xs.length;n++)r.push(s.src+s.name+"."+Xs[n]+i.nocache);return ot[s.name]=new Er.Howl({src:r,volume:Er.Howler.volume(),autoplay:s.autoplay===!0,loop:s.loop=!0,html5:s.stream===!0||s.html5===!0,xhrWithCredentials:i.withCredentials,onloaderror(){dg.call(this,s.name,t)},onload(){kl=0,typeof e=="function"&&e()}}),1}function Fl(s){return s in ot?(ot[s].unload(),delete ot[s],!0):!1}function gg(){for(let s in ot)ot.hasOwnProperty(s)&&Fl(s)}let Ge={},Bt=!1;try{Bt=typeof globalThis!="undefined"&&typeof globalThis.localStorage!="undefined"}catch(s){Bt=!1}function Eo(s){return s==="add"||s==="remove"}kt(hs,()=>{if(Bt===!0){let s=globalThis.localStorage.getItem("me.save");typeof s=="string"&&s.length>0&&(JSON.parse(s)||[]).forEach(t=>{Ge[t]=JSON.parse(globalThis.localStorage.getItem("me.save."+t))})}});let $l={add(s){let e=$l;Object.keys(s).forEach(t=>{Eo(t)||(function(i){Object.defineProperty(e,i,{configurable:!0,enumerable:!0,get(){return Ge[i]},set(r){Ge[i]=r,Bt===!0&&globalThis.localStorage.setItem("me.save."+i,JSON.stringify(r))}})}(t),t in Ge||(e[t]=s[t]))}),Bt===!0&&globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Ge)))},remove(s){Eo(s)||typeof Ge[s]!="undefined"&&(delete Ge[s],Bt===!0&&(globalThis.localStorage.removeItem("me.save."+s),globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Ge)))))}};const Ul=["ms","MS","moz","webkit","o"];function qe(s,e){if(e=e||globalThis,s in e)return e[s];let t=Dl(s),i;return Ul.some(r=>{let n=r+t;return i=n in e?e[n]:void 0}),i}function yg(s,e,t){if(t=t||globalThis,s in t){t[s]=e;return}let i=Dl(s);return Ul.some(r=>{let n=r+i;return n in t?(t[n]=e,!0):!1}),!1}const Te=typeof globalThis.navigator!="undefined"?globalThis.navigator.userAgent:"",Vl=/iPhone|iPad|iPod/i.test(Te),zl=/Android/i.test(Te),mg=/Android 2/i.test(Te),vg=/Linux/i.test(Te),_g=/CrOS/.test(Te),Gl=/Windows Phone/i.test(Te),jl=/BlackBerry/i.test(Te),Xl=/Kindle|Silk.*Mobile Safari/i.test(Te),xg=typeof globalThis.ejecta!="undefined",bg=/MicroMessenger/i.test(Te),Hl=typeof globalThis.process!="undefined"&&typeof globalThis.process.release!="undefined"&&globalThis.process.release.name==="node",Yl=/Mobi/i.test(Te)||Vl||zl||Gl||jl||Xl||!1,wg=typeof globalThis.navigator!="undefined"&&globalThis.navigator.standalone===!0||typeof globalThis.matchMedia!="undefined"&&globalThis.matchMedia("(display-mode: standalone)").matches;var Tg={__proto__:null,BlackBerry:jl,Kindle:Xl,android:zl,android2:mg,chromeOS:_g,ejecta:xg,iOS:Vl,isMobile:Yl,isWeixin:bg,linux:vg,nodeJS:Hl,ua:Te,webApp:wg,wp:Gl};let Ao=!1,Ar=!1;function Dt(){if(!Ar){if(typeof globalThis.document!="undefined"&&!globalThis.document.body)return setTimeout(Dt,13);typeof globalThis.document!="undefined"&&typeof globalThis.document.removeEventListener=="function"&&globalThis.document.removeEventListener("DOMContentLoaded",Dt,!1),typeof globalThis.removeEventListener=="function"&&globalThis.removeEventListener("load",Dt,!1),D(Ol),Ar=!0}}function Eg(s){Ar?s.call(globalThis,[]):(kt(Ol,s,globalThis),Ao||(Hl===!0||typeof globalThis.document!="undefined"&&globalThis.document.readyState==="complete"?globalThis.setTimeout(Dt,0):(typeof globalThis.document!="undefined"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("DOMContentLoaded",Dt,!1),globalThis.addEventListener("load",Dt,!1)),Ao=!0))}let Ot=!1,Mt=!1,Ri=!0,Yt={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0},Hs,Ii=-1;function So(s){return s.preventDefault(),typeof globalThis.scroll=="function"&&globalThis.scroll(0,0),!1}function Ag(){try{return!!globalThis.localStorage}catch(s){return!1}}function Sg(){try{return typeof globalThis.OffscreenCanvas!="undefined"&&new globalThis.OffscreenCanvas(0,0).getContext("2d")!==null}catch(s){return!1}}function Sr(s){th=s.accelerationIncludingGravity.x,ih=s.accelerationIncludingGravity.y,sh=s.accelerationIncludingGravity.z}function qi(s){rh=s.gamma,nh=s.beta,oh=s.alpha}let ni=Tg;const fs="ontouchstart"in globalThis,Ft=!!globalThis.PointerEvent,fn=fs||Ft&&globalThis.navigator.maxTouchPoints>0,Wl=fn?Ft?globalThis.navigator.maxTouchPoints||1:10:1,Cg=typeof globalThis.document!="undefined"&&"onwheel"in globalThis.document.createElement("div"),cs=typeof globalThis.document!="undefined"&&typeof globalThis.document.pointerLockElement!="undefined",Kl=!!globalThis.DeviceOrientationEvent,cn=typeof screen!="undefined"&&typeof screen.orientation!="undefined",ql=!!globalThis.DeviceMotionEvent,gi=typeof globalThis.document!="undefined"&&(qe("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);gi===!0&&(globalThis.document.exitFullscreen=qe("cancelFullScreen",globalThis.document)||qe("exitFullscreen",globalThis.document));const dn=!!(globalThis.AudioContext||globalThis.webkitAudioContext),Zl=typeof globalThis.Audio!="undefined",Pg=dn||Zl,Ql=typeof globalThis.document!="undefined"&&!!globalThis.document.createElement("video").canPlayType,Rg=Ag(),Jl=Sg(),Ig=typeof globalThis.atob=="function",eh=typeof globalThis.navigator!="undefined"&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",pn=globalThis.devicePixelRatio||1,Og=ni.isMobile;let th=0,ih=0,sh=0,rh=0,nh=0,oh=0,Mg=!0,Lg=!0,Bg=!1,Dg=!0;function ah(s){typeof globalThis.addEventListener=="function"&&(globalThis.addEventListener("blur",()=>{D(_r)},!1),globalThis.addEventListener("focus",()=>{D(xr),oi()},!1)),typeof globalThis.document!="undefined"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("visibilitychange",()=>{globalThis.document.visibilityState==="visible"?(D(xr),oi()):D(_r)},!1),Eg(s)}function lh(s){let e=Ft?"pointermove":fs?"touchmove":"mousemove";s!==!1?Ri===!1&&(globalThis.document.removeEventListener(e,So),Ri=!0):Ri===!0&&(globalThis.document.addEventListener(e,So,{passive:!1}),Ri=!1)}function gn(){return gi?!!(qe("fullscreenElement",globalThis.document)||globalThis.document.mozFullScreenElement):!1}function Ng(s){gi&&!gn()&&(s=s||yh(),s.requestFullscreen=qe("requestFullscreen",s)||s.mozRequestFullScreen,s.requestFullscreen())}function kg(){gi&&gn()&&globalThis.document.exitFullscreen()}function ds(){const s="portrait",e="landscape";let t=globalThis.screen;if(cn===!0){let i=qe("orientation",t);if(typeof i!="undefined"&&typeof i.type=="string")return i.type;if(typeof i=="string")return i}return typeof globalThis.orientation=="number"?Math.abs(globalThis.orientation)===90?e:s:globalThis.outerWidth>globalThis.outerHeight?e:s}function Fg(s){let e=globalThis.screen;if(typeof e!="undefined"){let t=qe("lockOrientation",e);if(typeof t!="undefined")return t(s)}return!1}function $g(){let s=globalThis.screen;if(typeof s!="undefined"){let e=qe("unlockOrientation",s);if(typeof e!="undefined")return e()}return!1}function Ug(){return ds().includes("portrait")}function Vg(){return ds().includes("landscape")}function zg(s="local"){switch(s){case"local":return $l;default:throw new Error("storage type "+s+" not supported")}}function hh(s){let e=Zi(s);return e.parentNode!==null&&(e=e.parentNode),e}function Zi(s){let e=null;return s!=="undefined"&&(typeof s=="string"?e=globalThis.document.getElementById(s):typeof s=="object"&&s.nodeType===Node.ELEMENT_NODE&&(e=s)),e||(e=globalThis.document.body),e}function ps(s){return typeof s=="object"&&s!==globalThis.document.body&&typeof s.getBoundingClientRect!="undefined"?s.getBoundingClientRect():(Yt.width=Yt.right=globalThis.innerWidth,Yt.height=Yt.bottom=globalThis.innerHeight,Yt)}function uh(s){return ps(hh(s))}function fh(s){if(Ii===-1){let e=!1;try{let t=globalThis.document.createElement("canvas"),i={stencil:!0,failIfMajorPerformanceCaveat:s.failIfMajorPerformanceCaveat};e=!!(globalThis.WebGLRenderingContext&&(t.getContext("webgl",i)||t.getContext("experimental-webgl",i))),Ii=e?1:0}catch(t){Ii=0}}return Ii===1}function oi(){typeof globalThis.focus=="function"&&globalThis.focus()}function Gg(){return ql&&!Ot&&(DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&(globalThis.addEventListener("devicemotion",Sr,!1),Ot=!0)}).catch(console.error):(globalThis.addEventListener("devicemotion",Sr,!1),Ot=!0)),Ot}function jg(){Ot&&(globalThis.removeEventListener("devicemotion",Sr,!1),Ot=!1)}function Xg(){return Kl&&!Mt&&(typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&(globalThis.addEventListener("deviceorientation",qi,!1),Mt=!0)}).catch(console.error):(globalThis.addEventListener("deviceorientation",qi,!1),Mt=!0)),Mt}function Hg(){Mt&&(globalThis.removeEventListener("deviceorientation",qi,!1),Mt=!1)}function Yg(s){typeof globalThis.navigator!="undefined"&&typeof globalThis.navigator.vibrate=="function"&&globalThis.navigator.vibrate(s)}function ch(s){let e=!1;if(Ql===!0){if(typeof Hs=="undefined"){const t=globalThis.document.createElement("video");Hs={h264:t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),h265:t.canPlayType('video/mp4; codecs="hev1"').replace(/^no$/,""),ogg:t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),mp4:t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),m4v:t.canPlayType("video/x-m4v").replace(/^no$/,""),webm:t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),vp9:t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),hls:t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")}}e=!!Hs[s]}return e}var Wg={__proto__:null,get accelerationX(){return th},get accelerationY(){return ih},get accelerationZ(){return sh},get alpha(){return oh},autoFocus:Dg,get beta(){return nh},devicePixelRatio:pn,enableSwipe:lh,exitFullscreen:kg,focus:oi,get gamma(){return rh},getElement:Zi,getElementBounds:ps,getParentBounds:uh,getParentElement:hh,getScreenOrientation:ds,getStorage:zg,hasAccelerometer:ql,hasDeviceOrientation:Kl,hasFullscreenSupport:gi,hasHTML5Audio:Zl,hasPointerLockSupport:cs,hasVideo:Ql,hasVideoFormat:ch,hasWebAudio:dn,isFullscreen:gn,isLandscape:Vg,isMobile:Og,isPortrait:Ug,isWebGLSupported:fh,language:eh,localStorage:Rg,lockOrientation:Fg,maxTouchPoints:Wl,nativeBase64:Ig,offscreenCanvas:Jl,onDeviceRotate:qi,onReady:ah,pauseOnBlur:Mg,platform:ni,pointerEvent:Ft,requestFullscreen:Ng,resumeOnFocus:Lg,screenOrientation:cn,sound:Pg,stopOnBlur:Bg,touch:fn,touchEvent:fs,unlockOrientation:$g,unwatchAccelerometer:jg,unwatchDeviceOrientation:Hg,vibrate:Yg,watchAccelerometer:Gg,watchDeviceOrientation:Xg,wheel:Cg};const dh={parent:void 0,canvas:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",scaleTarget:void 0,preferWebGL1:!1,depthTest:"sorting",powerPreference:"default",transparent:!1,antiAlias:!1,consoleHeader:!0,premultipliedAlpha:!0,blendMode:"normal",physic:"builtin",failIfMajorPerformanceCaveat:!0,subPixel:!1,verbose:!1,legacy:!1},ph=0,Cr=1,gh=2;let G=null;function Kg(s,e,t){if(!Hr)throw new Error("me.video.init() called before engine initialization.");try{M.init(s,e,Object.assign(dh,t||{}))}catch(i){return console.log(i.message),!1}return G=M.renderer,globalThis.addEventListener("resize",vr(i=>{D(Bl,i)},100),!1),globalThis.addEventListener("orientationchange",i=>{D(Ui,i)},!1),globalThis.addEventListener("onmozorientationchange",i=>{D(Ui,i)},!1),cn===!0&&(globalThis.screen.orientation.onchange=function(i){D(Ui,i)}),globalThis.addEventListener("scroll",vr(i=>{D(ug,i)},100),!1),D(ln,M.renderer),!0}function yn(s,e,t=!1){let i;if(s===0||e===0)throw new Error("width or height was zero, Canvas could not be initialized !");return Jl===!0&&t===!0?(i=new globalThis.OffscreenCanvas(0,0),typeof i.style=="undefined"&&(i.style={})):i=globalThis.document.createElement("canvas"),i.width=s,i.height=e,i}function yh(){return M.getParentElement()}var Co={__proto__:null,AUTO:gh,CANVAS:ph,WEBGL:Cr,createCanvas:yn,getParent:yh,init:Kg,get renderer(){return G}};let dt={},mn={},pt={},ai={},gs={},$t={},mh=function(s,e,t){e=e||s.keyCode||s.button;let i=$t[e];if(D(rg,i,e,i?!pt[i]:!0),i){if(!pt[i]){let r=typeof t!="undefined"?t:e;ai[i][r]||(dt[i]++,ai[i][r]=!0)}return gs[e]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},vh=function(s,e,t){e=e||s.keyCode||s.button;let i=$t[e];if(D(ng,i,e),i){let r=typeof t!="undefined"?t:e;return ai[i][r]=void 0,dt[i]>0&&dt[i]--,pt[i]=!1,gs[e]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},Ct=null;const qg={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function _h(){Ct===null&&Yl===!1&&(Ct=globalThis,typeof Ct.addEventListener=="function"&&(Ct.addEventListener("keydown",mh,!1),Ct.addEventListener("keyup",vh,!1)))}function Zg(s){return dt[s]&&!pt[s]?(mn[s]&&(pt[s]=!0),!0):!1}function Qg(s){return dt[s]>0}function nt(s,e,t){e===!0?mh({},s,t):vh({},s,t)}function Jg(s,e,t,i=_i){$t[s]=e,gs[s]=i,dt[e]=0,mn[e]=t||!1,pt[e]=!1,ai[e]={}}function vn(s){return $t[s]}function ey(s){pt[s]=!1}function ty(s){let e=$t[s];dt[e]=0,mn[e]=!1,ai[e]={},$t[s]=null,gs[s]=null}let Et=new B;class xh extends de{constructor(e=0,t=0,i=1,r=1){super(),this.setMinMax(e,t,e+i,t+r),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(e,t=0,i=0,r=0,n=0,o=1){this.event=e,this.pageX=t,this.pageY=i,this.clientX=r,this.clientY=n,Sh(this.pageX,this.pageY,Et),this.gameScreenX=this.x=Et.x,this.gameScreenY=this.y=Et.y,this.isNormalized=typeof globalThis.PointerEvent!="undefined"&&!(e instanceof globalThis.PointerEvent),this.locked=Ji,this.movementX=e.movementX||0,this.movementY=e.movementY||0,e.type==="wheel"?(this.deltaMode=e.deltaMode||0,this.deltaX=e.deltaX||0,this.deltaY=e.deltaY||0,this.deltaZ=e.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=typeof e.isPrimary!="undefined"?e.isPrimary:!0,this.button=e.button||0,this.type=e.type,typeof M.viewport!="undefined"&&M.viewport.localToWorld(this.gameScreenX,this.gameScreenY,Et),this.gameWorldX=Et.x,this.gameWorldY=Et.y,this.isNormalized===!1?(this.width=e.width||1,this.height=e.height||1):typeof e.radiusX=="number"?(this.width=e.radiusX*2||1,this.height=e.radiusY*2||1):this.width=this.height=1}}let Qi=[],$e=new Map,Pr,Po=!1,Ro=0,oe=[];const _n=["wheel"],ve=["pointermove","mousemove","touchmove"],yi=["pointerdown","mousedown","touchstart"],Ye=["pointerup","mouseup","touchend"],We=["pointercancel","mousecancel","touchcancel"],mi=["pointerenter","mouseenter","touchenter"],ys=["pointerover","mouseover","touchover"],vi=["pointerleave","mouseleave","touchleave"],li=[_n[0],ve[0],yi[0],Ye[0],We[0],mi[0],ys[0],vi[0]],iy=[_n[0],ve[1],yi[1],Ye[1],We[1],mi[1],ys[1],vi[1]],sy=[ve[2],yi[2],Ye[2],We[2],mi[2],ys[2],vi[2]],bh={wheel:_n,pointermove:ve,pointerdown:yi,pointerup:Ye,pointercancel:We,pointerenter:mi,pointerover:ys,pointerleave:vi};let Le=[];function ry(s,e){for(let t=0;t<s.length;t++)ve.indexOf(s[t])===-1&&je.addEventListener(s[t],e,{passive:_i===!1})}function wh(){if(!Po){Pr=new xe(0,0,1,1);for(let e=0;e<Wl;e++)Qi.push(new xh);je===null&&(je=G.getCanvas()),Ft?oe=li:oe=iy,fn&&!Ft&&(oe=oe.concat(sy)),ry(oe,ny),typeof Kt=="undefined"&&(Kt=~~(1e3/le.maxfps)),oi(),je.addEventListener(oe[2],()=>{oi()},{passive:_i===!1});let s=xn(oe,ve);if(Kt<17)for(let e=0;e<s.length;e++)oe.indexOf(s[e])!==-1&&je.addEventListener(s[e],Oo,{passive:!0});else for(let e=0;e<s.length;e++)oe.indexOf(s[e])!==-1&&je.addEventListener(s[e],vr(Oo,Kt,!1),{passive:!0});Ch(je),cs&&globalThis.document.addEventListener("pointerlockchange",()=>{Ji=globalThis.document.pointerLockElement===M.getParentElement(),D(hg,Ji)},!0),Po=!0}}function Io(s,e){for(let t=0;t<e.length;t++)if(s.indexOf(e[t])!==-1)return e[t]}function xn(s,e){let t=[];for(let i=0;i<e.length;i++)s.indexOf(e[i])!==-1&&t.push(e[i]);return t}function At(s,e,t,i){let r;if(s.callbacks[e]){s.pointerId=i;for(let n=s.callbacks[e].length-1;n>=0&&(r=s.callbacks[e][n]);n--)if(r(t)===!1)return!0}return!1}function Th(s){let e=!1;for(;s.length>0;){let t=s.pop();if(Qi.push(t),t.isNormalized===!0&&typeof t.event.timeStamp!="undefined"){if(t.event.timeStamp<Ro)continue;Ro=t.event.timeStamp}Pr.setShape(t.gameWorldX,t.gameWorldY,t.width,t.height),ve.includes(t.type)&&(t.gameX=t.gameLocalX=t.gameScreenX,t.gameY=t.gameLocalY=t.gameScreenY,D(lg,t));let i=M.world.broadphase.retrieve(Pr,M.world._sortReverseZ);i=i.concat([M.viewport]);for(let r=i.length,n;r--,n=i[r];){if($e.has(n)&&n.isKinematic!==!0){const o=$e.get(n),l=o.region,u=l.ancestor,h=l.getBounds();let d=!1;if(l.isFloating===!0?(t.gameX=t.gameLocalX=t.gameScreenX,t.gameY=t.gameLocalY=t.gameScreenY):(t.gameX=t.gameLocalX=t.gameWorldX,t.gameY=t.gameLocalY=t.gameWorldY),typeof u!="undefined"){let a=u.getBounds();t.gameLocalX=t.gameX-a.x,t.gameLocalY=t.gameY-a.y}switch(d=h.contains(t.gameX,t.gameY),t.type){case ve[0]:case ve[1]:case ve[2]:case ve[3]:if(o.pointerId===t.pointerId&&!d){if(At(o,Io(oe,vi),t,null)){e=!0;break}}else if(o.pointerId===null&&d&&At(o,Io(oe,mi),t,t.pointerId)){e=!0;break}if(d&&At(o,t.type,t,t.pointerId)){e=!0;break}break;case Ye[0]:case Ye[1]:case Ye[2]:case Ye[3]:if(o.pointerId===t.pointerId&&d&&At(o,t.type,t,null)){e=!0;break}break;case We[0]:case We[1]:case We[2]:case We[3]:if(o.pointerId===t.pointerId&&At(o,t.type,t,null)){e=!0;break}break;default:if(d&&At(o,t.type,t,t.pointerId)){e=!0;break}break}}if(e===!0)break}}return e}function Eh(s){let e;if(fs&&s.changedTouches)for(let t=0,i=s.changedTouches.length;t<i;t++){const r=s.changedTouches[t];e=Qi.pop(),e.setEvent(s,r.pageX,r.pageY,r.clientX,r.clientY,r.identifier),Le.push(e)}else e=Qi.pop(),e.setEvent(s,s.pageX,s.pageY,s.clientX,s.clientY,s.pointerId),Le.push(e);return s.isPrimary===!1||(Le[0].isPrimary=!0,Object.assign(gt,Le[0])),Le}function Oo(s){Th(Eh(s))}function ny(s){Eh(s);let e=Le[0].button;(Th(Le)||s.type==="wheel")&&_i===!0&&s.preventDefault();let t=gt.bind[e];t&&nt(t,yi.includes(s.type),e+1)}let je=null,gt=new xh(0,0,1,1),Ji=!1,Kt;function oy(){return Le.length>0}function Ah(){return $e.size>0}function Sh(s,e,t){t=t||g.pull("Vector2d");let i=ps(G.getCanvas()),r=globalThis.devicePixelRatio||1;s-=i.left+(globalThis.pageXOffset||0),e-=i.top+(globalThis.pageYOffset||0);let n=G.scaleRatio;return(n.x!==1||n.y!==1)&&(s/=n.x,e/=n.y),t.set(s*r,e*r)}function Ch(s,e){s.style["touch-action"]=e||"none"}function ay(){let s=arguments.length<2?gt.LEFT:arguments[0],e=arguments.length<2?arguments[0]:arguments[1];if(wh(),!vn(e))throw new Error("no action defined for keycode "+e);gt.bind[s]=e}function ly(s){gt.bind[typeof s=="undefined"?gt.LEFT:s]=null}function hy(s,e,t){if(wh(),li.indexOf(s)===-1)throw new Error("invalid event type : "+s);if(typeof e=="undefined")throw new Error("registerPointerEvent: region for "+toString(e)+" event is undefined ");let i=xn(oe,bh[s]);$e.has(e)||$e.set(e,{region:e,callbacks:{},pointerId:null});let r=$e.get(e);for(let n=0;n<i.length;n++){const o=i[n];r.callbacks[o]?r.callbacks[o].push(t):r.callbacks[o]=[t]}}function Ph(s,e,t){if(li.indexOf(s)===-1)throw new Error("invalid event type : "+s);let i=xn(oe,bh[s]),r=$e.get(e);if(typeof r!="undefined"){for(let n=0;n<i.length;n++){const o=i[n];if(r.callbacks[o]){if(typeof t!="undefined")Hi(r.callbacks[o],t);else for(;r.callbacks[o].length>0;)r.callbacks[o].pop();r.callbacks[o].length===0&&delete r.callbacks[o]}}Object.keys(r.callbacks).length===0&&$e.delete(e)}}function Rh(s){if($e.has(s))for(let e=0;e<li.length;e++)Ph(li[e],s)}function uy(){return cs?(M.getParentElement().requestPointerLock(),!0):!1}function fy(){return cs?(globalThis.document.exitPointerLock(),!0):!1}let Rr=.1;function cy(s,e,t){return t===this.GAMEPAD.BUTTONS.L2||t===this.GAMEPAD.BUTTONS.R2?(s+1)/2:s}function Mo(s,e,t){return s>0?t===this.GAMEPAD.BUTTONS.L2?s=Math.max(0,s-2e4)/111070:s=(s-1)/131070:s=(65536+s)/131070+.5,s}const Lo=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,Bo=/^0+/;function Ih(s,e){const t=s.replace(Lo,(r,n,o)=>"000".slice(n.length-1)+n+"-"+"000".slice(o.length-1)+o+"-"),i=s.replace(Lo,(r,n,o)=>n.replace(Bo,"")+"-"+o.replace(Bo,"")+"-");e.analog=e.analog||e.buttons.map(()=>-1),e.normalize_fn=e.normalize_fn||function(r){return r},Ir.set(t,e),Ir.set(i,e)}let at={},Ir=new Map,Do;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:cy}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Mo}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Mo}]].forEach(s=>{Ih(s[0],s[1])});let dy=function(){let s=navigator.getGamepads();Object.keys(at).forEach(e=>{let t=s[e];if(!t)return;let i=null;t.mapping!=="standard"&&(i=Ir.get(t.id));let r=at[e];Object.keys(r.buttons).forEach(n=>{let o=r.buttons[n],l=n,u=-1;if(i&&(l=i.buttons[n],u=i.analog[n],l<0&&u<0))return;let h=t.buttons[l]||{};if(i&&u>=0){let d=i.normalize_fn(t.axes[u],-1,+n);h={value:d,pressed:h.pressed||Math.abs(d)>=Rr}}D(To,e,"buttons",+n,h),!o.pressed&&h.pressed?nt(o.keyCode,!0,l+256):o.pressed&&!h.pressed&&nt(o.keyCode,!1,l+256),o.value=h.value,o.pressed=h.pressed}),Object.keys(r.axes).forEach(n=>{let o=r.axes[n],l=n;if(i&&(l=i.axes[n],l<0))return;let u=t.axes[l];if(typeof u=="undefined")return;i&&(u=i.normalize_fn(u,+n,-1));let h=Math.sign(u)||1;if(o[h].keyCode===0)return;let d=Math.abs(u)>=Rr+Math.abs(o[h].threshold);D(To,e,"axes",+n,u),!o[h].pressed&&d?(o[-h].pressed&&(nt(o[-h].keyCode,!1,l+256),o[-h].value=0,o[-h].pressed=!1),nt(o[h].keyCode,!0,l+256)):(o[h].pressed||o[-h].pressed)&&!d&&(h=o[h].pressed?h:-h,nt(o[h].keyCode,!1,l+256)),o[h].value=u,o[h].pressed=d})})};globalThis.navigator&&typeof globalThis.navigator.getGamepads=="function"&&(globalThis.addEventListener("gamepadconnected",s=>{D(og,s.gamepad)},!1),globalThis.addEventListener("gamepaddisconnected",s=>{D(ag,s.gamepad)},!1));let py={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function gy(s,e,t){if(!vn(t))throw new Error("no action defined for keycode "+t);typeof Do=="undefined"&&typeof navigator.getGamepads=="function"&&(Do=U(hn,dy)),at[s]||(at[s]={axes:{},buttons:{}});let i={keyCode:t,value:0,pressed:!1,threshold:e.threshold},r=at[s][e.type];if(e.type==="buttons")r[e.code]=i;else if(e.type==="axes"){let n=Math.sign(e.threshold)||1;r[e.code]||(r[e.code]={});let o=r[e.code];o[n]=i,o[-n]||(o[-n]={keyCode:0,value:0,pressed:!1,threshold:-n})}}function yy(s,e){if(!at[s])throw new Error("no bindings for gamepad "+s);at[s].buttons[e]={}}function my(s){Rr=s}let vy=Ih,_i=!0;var A={__proto__:null,GAMEPAD:py,KEY:qg,bindGamepad:gy,bindKey:Jg,bindPointer:ay,exitPointerLock:fy,getBindingKey:vn,globalToLocal:Sh,hasActiveEvents:oy,hasRegisteredEvents:Ah,initKeyboardEvent:_h,isKeyPressed:Zg,get keyBoardEventTarget(){return Ct},keyStatus:Qg,get locked(){return Ji},pointer:gt,get pointerEventTarget(){return je},preventDefault:_i,registerPointerEvent:hy,releaseAllPointerEvents:Rh,releasePointerEvent:Ph,requestPointerLock:uy,setGamepadDeadzone:my,setGamepadMapping:vy,setTouchAction:Ch,get throttlingInterval(){return Kt},triggerKeyEvent:nt,unbindGamepad:yy,unbindKey:ty,unbindPointer:ly,unlockKey:ey};const _y={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function xy(s,e){let t={},i=/uniform\s+(\w+)\s+(\w+)/g,r={},n={},o={},l;return[e.vertex,e.fragment].forEach(u=>{for(;l=i.exec(u);)r[l[2]]=l[1]}),Object.keys(r).forEach(u=>{let h=r[u];o[u]=s.getUniformLocation(e.program,u),n[u]={get:function(d){return function(){return o[d]}}(u),set:function(d,a,f){return a.indexOf("mat")===0?function(c){s[f](o[d],!1,c)}:function(c){let p=f;c.length&&f.slice(-1)!=="v"&&(p+="v"),s[p](o[d],c)}}(u,h,"uniform"+_y[h])}}),Object.defineProperties(t,n),t}function by(s,e){let t={},i=/attribute\s+\w+\s+(\w+)/g,r,n=0;for(;r=i.exec(e.vertex);)t[r[1]]=n++;return t}function No(s,e,t){let i=s.createShader(e);if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(i));return i}function wy(s,e,t,i){let r=No(s,s.VERTEX_SHADER,e),n=No(s,s.FRAGMENT_SHADER,t),o=s.createProgram();s.attachShader(o,r),s.attachShader(o,n);for(let l in i)s.bindAttribLocation(o,i[l],l);if(s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS)){let l="Error initializing Shader "+this+`
gl.VALIDATE_STATUS: `+s.getProgramParameter(o,s.VALIDATE_STATUS)+`
gl.getError()`+s.getError()+`
gl.getProgramInfoLog()`+s.getProgramInfoLog(o);throw s.deleteProgram(o),o=null,new Error(l)}return s.useProgram(o),s.deleteShader(r),s.deleteShader(n),o}function ko(s,e){return s.substring(0,9)!=="precision"?"precision "+e+" float;"+s:s}function Fo(s){return s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0?"highp":s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function $o(s){return s=s.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"),s=s.replace(/(\\n\s+)|(\s+\\n)/g,""),s=s.replace(/(\\r|\\n)+/g,""),s=s.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1"),s}class Oh{constructor(e,t,i,r){this.gl=e,this.vertex=ko($o(t),r||Fo(this.gl)),this.fragment=ko($o(i),r||Fo(this.gl)),this.attributes=by(this.gl,this),this.program=wy(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=xy(this.gl,this),U(un,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(e){let t=this.attributes[e];return typeof t!="undefined"?t:-1}setUniform(e,t){let i=this.uniforms;if(typeof i[e]!="undefined")typeof t=="object"&&typeof t.toArray=="function"?i[e]=t.toArray():i[e]=t;else throw new Error("undefined ("+e+") uniform for shader "+this)}setVertexAttributes(e,t,i){for(let r=0;r<t.length;++r){let n=t[r],o=this.getAttribLocation(n.name);o!==-1?(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.size,n.type,n.normalized,i,n.offset)):e.disableVertexAttribArray(r)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class W extends xe{constructor(e,t,i,r){super(e,t,i,r),this.pos instanceof ke?this.pos.setMuted(e,t,0).setCallback(this.updateBoundsPos,this):this.pos=g.pull("ObservableVector3d",e,t,0,{onUpdate:this.updateBoundsPos,scope:this}),this.anchorPoint instanceof Ne?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=g.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),typeof this.currentTransform=="undefined"&&(this.currentTransform=g.pull("Matrix2d")),this.currentTransform.identity(),this.body=void 0,this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.shader=void 0,this.blendMode="normal",this.name="",this.isRenderable=!0,this.isKinematic=!0,this.isDirty=!0,this._flip={x:!1,y:!1},this._inViewport=!1,this._parentApp=void 0,this._tint=g.pull("Color",255,255,255,1),this.setOpacity(1)}get parentApp(){return typeof this._parentApp=="undefined"&&typeof this.ancestor!="undefined"&&typeof this.ancestor.getRootAncestor=="function"&&(this._parentApp=this.ancestor.getRootAncestor().app),this._parentApp}get isFloating(){return this.floating===!0||typeof this.ancestor!="undefined"&&this.ancestor.isFloating===!0}get tint(){return this._tint}set tint(e){this._tint.copy(e),this.isDirty=!0}get depth(){return this.pos.z}set depth(e){this.pos.z=e,this.isDirty=!0}get inViewport(){return this._inViewport}set inViewport(e){this._inViewport!==e&&(this._inViewport=e,typeof this.onVisibilityChange=="function"&&this.onVisibilityChange.call(this,e))}get isFlippedX(){return this._flip.x===!0}get isFlippedY(){return this._flip.y===!0}getBounds(){return typeof this._bounds=="undefined"&&(super.getBounds(),this.isFinite()?this.updateBounds():this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(e){typeof e=="number"&&(this.alpha=P(e,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(e=!0){return this._flip.x=!!e,this.isDirty=!0,this}flipY(e=!0){return this._flip.y=!!e,this.isDirty=!0,this}transform(e){return this.currentTransform.multiply(e),this.updateBounds(),this.isDirty=!0,this}angleTo(e){let t=this.getBounds(),i,r;if(e instanceof W){let n=e.getBounds();i=n.centerX-t.centerX,r=n.centerY-t.centerY}else i=e.x-t.centerX,r=e.y-t.centerY;return Math.atan2(r,i)}distanceTo(e){let t=this.getBounds(),i,r;if(e instanceof W){let n=e.getBounds();i=t.centerX-n.centerX,r=t.centerY-n.centerY}else i=t.centerX-e.x,r=t.centerY-e.y;return Math.sqrt(i*i+r*r)}lookAt(e){let t;e instanceof W?t=e.pos:t=e;let i=this.angleTo(t);return this.rotate(i),this}rotate(e,t){return e!==0&&(this.currentTransform.rotate(e,t),this.updateBounds(),this.isDirty=!0),this}scale(e,t=e){return this.currentTransform.scale(e,t),this.updateBounds(),this.isDirty=!0,this}scaleV(e){return this.scale(e.x,e.y),this}update(e){return this.isDirty}updateBounds(e=!0){if(this.isRenderable){let t=this.getBounds();if(t.clear(),this.autoTransform===!0&&!this.currentTransform.isIdentity()?(this.currentTransform.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y),t.addFrame(0,0,this.width,this.height,this.currentTransform),this.currentTransform.translate(this.width*this.anchorPoint.x,this.height*this.anchorPoint.y)):(t.addFrame(0,0,this.width,this.height),t.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y)),e===!0){let i=this.getAbsolutePosition();t.centerOn(i.x+t.x+t.width/2,i.y+t.y+t.height/2)}return t}else return super.updateBounds(e)}updateBoundsPos(e=this.pos.x,t=this.pos.y){this.getBounds().translate(e-this.pos.x,t-this.pos.y)}getAbsolutePosition(){return typeof this._absPos=="undefined"&&(this._absPos=g.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),typeof this.ancestor!="undefined"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(e,t){this.anchorPoint.setMuted(e,t),this.updateBounds(),this.isDirty=!0}preDraw(e){let t=this.width*this.anchorPoint.x,i=this.height*this.anchorPoint.y;if(e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var r=this._flip.x?this.centerX-t:0,n=this._flip.y?this.centerY-i:0;e.translate(r,n),e.scale(this._flip.x?-1:1,this._flip.y?-1:1),e.translate(-r,-n)}typeof this.mask!="undefined"&&(e.translate(this.pos.x,this.pos.y),e.setMask(this.mask),e.translate(-this.pos.x,-this.pos.y)),typeof this.shader=="object"&&typeof e.gl!="undefined"&&(e.customShader=this.shader),this.autoTransform===!0&&!this.currentTransform.isIdentity()&&(e.translate(this.pos.x,this.pos.y),e.transform(this.currentTransform),e.translate(-this.pos.x,-this.pos.y)),e.translate(-t,-i),e.setTint(this.tint,this.getOpacity()),this.blendMode!==e.getBlendMode()&&e.setBlendMode(this.blendMode)}draw(e,t){}postDraw(e){e.clearTint(),typeof this.mask!="undefined"&&e.clearMask(),typeof this.shader=="object"&&typeof e.gl!="undefined"&&(e.customShader=void 0),e.restore(),this.isDirty=!1}onCollision(e,t){return!1}destroy(){g.push(this.currentTransform),this.currentTransform=void 0,g.push(this.anchorPoint),this.anchorPoint=void 0,g.push(this.pos),this.pos=void 0,typeof this._absPos!="undefined"&&(g.push(this._absPos),this._absPos=void 0),this._bounds instanceof de&&(g.push(this._bounds),this._bounds=void 0),this.onVisibilityChange=void 0,typeof this.mask!="undefined"&&(g.push(this.mask),this.mask=void 0),this._tint instanceof ue&&(g.push(this._tint),this._tint=void 0),this.ancestor=void 0,this._parentApp=void 0,this.body instanceof he&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),Rh(this),this.onDestroyEvent.apply(this,arguments),this.shader instanceof Oh&&(this.shader.destroy(),this.shader=void 0)}onDestroyEvent(){}}const Uo=Math.min,Vo=Math.max;let ge=new B;class Ty extends W{constructor(e,t,i,r){super(e,t,i-e,r-t),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=g.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new Gi,this.invCurrentTransform=new Qt,this.offset=new B,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(e,t,i,r),this._updateProjectionMatrix(),U(pi,this.reset,this),U(us,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(e){let t=this.pos.x;return e.x-this.pos.x>this.deadzone.right?t=Uo(e.x-this.deadzone.right,this.bounds.width-this.width):e.x-this.pos.x<this.deadzone.pos.x&&(t=Vo(e.x-this.deadzone.pos.x,this.bounds.left)),t}_followV(e){let t=this.pos.y;return e.y-this.pos.y>this.deadzone.bottom?t=Uo(e.y-this.deadzone.bottom,this.bounds.height-this.height):e.y-this.pos.y<this.deadzone.pos.y&&(t=Vo(e.y-this.deadzone.pos.y,this.bounds.top)),t}reset(e=0,t=0){this.pos.x=e,this.pos.y=t,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(e,t){typeof this.deadzone=="undefined"&&(this.deadzone=new xe(0,0,0,0)),this.deadzone.pos.set(~~((this.width-e)/2),~~((this.height-t)/2-t*.25)),this.deadzone.resize(e,t),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(e,t){return super.resize(e,t),this.smoothFollow=!1,this.setBounds(0,0,e,t),this.setDeadzone(e/6,t/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),D(ct,this.width,this.height,this),this}setBounds(e,t,i,r){this.smoothFollow=!1,this.bounds.setMinMax(e,t,i+e,r+t),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(e,t,i){if(e instanceof W)this.target=e.pos;else if(e instanceof B||e instanceof De||e instanceof Ne||e instanceof ke)this.target=e;else throw new Error("invalid target for me.Camera2d.follow");this.follow_axis=typeof t=="undefined"?this.AXIS.BOTH:t,this.smoothFollow=!1,typeof i!="number"?this.damping=1:this.damping=P(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(e,t){this.moveTo(this.pos.x+e,this.pos.y+t)}moveTo(e,t){let i=this.pos.x,r=this.pos.y;this.pos.x=P(e,this.bounds.left,this.bounds.width),this.pos.y=P(t,this.bounds.top,this.bounds.height),(i!==this.pos.x||r!==this.pos.y)&&(this.isDirty=!0)}updateTarget(){if(this.target){switch(ge.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:ge.x=this._followH(this.target);break;case this.AXIS.VERTICAL:ge.y=this._followV(this.target);break;case this.AXIS.BOTH:ge.x=this._followH(this.target),ge.y=this._followV(this.target);break}if(!this.pos.equals(ge)){if(this.smoothFollow===!0&&this.damping<1)if(_o(ge.x,this.pos.x,2)&&_o(ge.y,this.pos.y,2)){this.pos.setV(ge);return}else this.pos.lerp(ge,this.damping);else this.pos.setV(ge);this.isDirty=!0}}}update(e){return this.updateTarget(e),this._shake.duration>0&&(this._shake.duration-=e,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),typeof this._shake.onComplete=="function"&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),this.isDirty===!0&&D(Tr,this.pos),(this._fadeIn.tween!=null||this._fadeOut.tween!=null)&&(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(e)}shake(e,t,i,r,n){(this._shake.duration===0||n===!0)&&(this._shake.intensity=e,this._shake.duration=t,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete=typeof r=="function"?r:void 0)}fadeOut(e,t=1e3,i){this._fadeOut.color=g.pull("Color").copy(e),this._fadeOut.tween=g.pull("Tween",this._fadeOut.color).to({alpha:0},t).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(e,t=1e3,i){this._fadeIn.color=g.pull("Color").copy(e);let r=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=g.pull("Tween",this._fadeIn.color).to({alpha:r},t).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(e){let t=e.getBounds();this.moveTo(e.pos.x+t.left+t.width/2,e.pos.y+t.top+t.height/2)}isVisible(e,t=e.floating){return t===!0||e.floating===!0?G.overlaps(e.getBounds()):e.getBounds().overlaps(this)}localToWorld(e,t,i){return i=i||g.pull("Vector2d"),i.set(e,t).add(this.pos).sub(M.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(e,t,i){return i=i||g.pull("Vector2d"),i.set(e,t),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(M.world.pos)}drawFX(e){this._fadeIn.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeIn.color),e.fillRect(0,0,this.width,this.height),e.restore(),this._fadeIn.color.alpha===1&&(this._fadeIn.tween=null,g.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeOut.color),e.fillRect(0,0,this.width,this.height),e.restore(),this._fadeOut.color.alpha===0&&(this._fadeOut.tween=null,g.push(this._fadeOut.color),this._fadeOut.color=null))}draw(e,t){let i=this.pos.x+this.offset.x,r=this.pos.y+this.offset.y;t.currentTransform.translate(-i,-r),e.setProjection(this.projectionMatrix),e.clipRect(0,0,this.width,this.height),this.preDraw(e),t.preDraw(e,this),t.draw(e,this),this.drawFX(e),t.postDraw(e,this),this.postDraw(e),t.currentTransform.translate(i,r)}}let Ys,Ey={cameras:[]};class xi{constructor(e){this.cameras=new Map,this.lights=new Map,this.ambientLight=new ue(0,0,0,0),this.settings=Object.assign(Ey,e||{})}reset(){if(this.settings.cameras.forEach(e=>{this.cameras.set(e.name,e)}),this.cameras.has("default")===!1){if(typeof Ys=="undefined"){let e=G.width,t=G.height;Ys=new Ty(0,0,e,t)}this.cameras.set("default",Ys)}D(Ll,this),this.onResetEvent.apply(this,arguments)}update(e){let t=!1;return this.cameras.forEach(i=>{i.update(e)===!0&&(t=!0)}),this.lights.forEach(i=>{i.update(e)===!0&&(t=!0)}),t}draw(e,t){this.cameras.forEach(i=>{i.draw(e,t),this.ambientLight.alpha!==0&&(e.save(),this.lights.forEach(r=>{e.setMask(r.getVisibleArea(),!0)}),e.setColor(this.ambientLight),e.fillRect(0,0,i.width,i.height),e.clearMask(),e.restore()),this.lights.forEach(r=>{r.preDraw(e,t),r.draw(e,t),r.postDraw(e,t)})})}destroy(){this.cameras.clear(),this.lights.forEach(e=>{e.destroy()}),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){typeof this.settings.onResetEvent=="function"&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){typeof this.settings.onDestroyEvent=="function"&&this.settings.onDestroyEvent.apply(this,arguments)}}const Ay=/^.*(\\|\/|\:)/,Sy=/\.[^\.]*$/;function bn(s){return s.replace(Ay,"").replace(Sy,"")}function Ut(s){return s.substring(s.lastIndexOf(".")+1,s.length)}let Ie={},Ze={},yt={},Qe={},Je={},mt={};function lt(s,e,t={}){return new Promise((i,r)=>{fetch(s,{method:"GET",cache:t.nocache===""?"no-cache":"reload",credentials:t.withCredentials===!0?"include":"omit",mode:t.crossOrigin==="anonymous"?"cors":"no-cors"}).then(n=>{switch(n.ok||n.status!==0&&typeof onerror=="function"&&r(new Error("`Network response was not ok ${response.statusText}`")),e){case"json":return n.json();case"text":return n.text();case"blob":return n.blob();case"arrayBuffer":return n.arrayBuffer();default:r(new Error("Invalid response type"))}}).then(n=>i(n)).catch(n=>r(n))})}function Cy(){throw new Error("unsupported format")}function Py(){throw new Error("unsupported format")}function Ry(){throw new Error("unsupported format")}function Iy(){throw new Error("unsupported format")}function Oy(){throw new Error("unsupported format")}let Or;kt(ln,s=>{Or=s});function My(s,e){let t;if(Or.type.includes("WebGL"))switch(e){case"dds":t=Cy();break;case"pvr":t=Iy();break;case"pkm":t=Oy();break;case"ktx":t=Py();break;case"ktx2":t=Ry();break}if(typeof t!="undefined"&&Or.hasSupportedCompressedFormats(t.format))return console.log("Compressed texture format supported: "+t.format),t;throw"unsupported texture format:"+e+t?" ("+t.format+")":""}function Ly(s,e,t,i){if(typeof Ie[s.name]!="undefined")return 0;let r=Array.isArray(s.src)?s.src:[s.src],n=!1;for(const o of r){const l=Ut(o);switch(l){case"dds":case"pvr":case"pkm":case"ktx":case"ktx2":lt(o,"arrayBuffer",i).then(u=>{try{Ie[s.name]=My(u,l),n=!0,typeof e=="function"&&e()}catch(h){}}).catch(u=>{typeof t=="function"&&t(u)});break;case"svg":lt(o,"text",i).then(u=>{const h=new Image;h.onload=function(){Ie[s.name]=h,typeof e=="function"&&e()},h.onerror=function(d){typeof t=="function"&&t(d)},h.src="data:image/svg+xml;charset=utf8,"+encodeURIComponent(u)}).catch(u=>{typeof t=="function"&&t(u)}),n=!0;break;default:lt(o,"blob",i).then(u=>{globalThis.createImageBitmap(u).then(h=>{Ie[s.name]=h,typeof e=="function"&&e()})}).catch(u=>{typeof t=="function"&&t(u)}),n=!0;break}if(n===!0)return 1}throw new Error("No supported Image file format found for "+s.name)}function By(s,e,t){const i=typeof globalThis.document!="undefined"?globalThis.document.fonts:void 0;if(Ki(s.src)===!0&&(s.src.startsWith("url(")||(s.src="url("+s.src+")")),typeof i!="undefined"){let r=new FontFace(s.name,s.src);r.load().then(()=>{mt[s.name]=r,i.add(r),typeof e=="function"&&e()},()=>{typeof t=="function"&&t(s.name)})}else typeof t=="function"&&t(error);return 1}var Mr={exports:{}};const Dy="2.0.0",Mh=256,Ny=Number.MAX_SAFE_INTEGER||9007199254740991,ky=16,Fy=Mh-6,$y=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var ms={MAX_LENGTH:Mh,MAX_SAFE_COMPONENT_LENGTH:ky,MAX_SAFE_BUILD_LENGTH:Fy,MAX_SAFE_INTEGER:Ny,RELEASE_TYPES:$y,SEMVER_SPEC_VERSION:Dy,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const Uy=typeof process=="object"&&As&&As.NODE_DEBUG&&/\bsemver\b/i.test(As.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{};var vs=Uy;(function(s,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=ms,n=vs;e=s.exports={};const o=e.re=[],l=e.safeRe=[],u=e.src=[],h=e.t={};let d=0;const a="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",r],[a,i]],c=y=>{for(const[v,m]of f)y=y.split(`${v}*`).join(`${v}{0,${m}}`).split(`${v}+`).join(`${v}{1,${m}}`);return y},p=(y,v,m)=>{const _=c(v),x=d++;n(y,x,v),h[y]=x,u[x]=v,o[x]=new RegExp(v,m?"g":void 0),l[x]=new RegExp(_,m?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${a}*`),p("MAINVERSION",`(${u[h.NUMERICIDENTIFIER]})\\.(${u[h.NUMERICIDENTIFIER]})\\.(${u[h.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[h.NUMERICIDENTIFIERLOOSE]})\\.(${u[h.NUMERICIDENTIFIERLOOSE]})\\.(${u[h.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[h.NUMERICIDENTIFIER]}|${u[h.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[h.NUMERICIDENTIFIERLOOSE]}|${u[h.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[h.PRERELEASEIDENTIFIER]}(?:\\.${u[h.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[h.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${a}+`),p("BUILD",`(?:\\+(${u[h.BUILDIDENTIFIER]}(?:\\.${u[h.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[h.MAINVERSION]}${u[h.PRERELEASE]}?${u[h.BUILD]}?`),p("FULL",`^${u[h.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[h.MAINVERSIONLOOSE]}${u[h.PRERELEASELOOSE]}?${u[h.BUILD]}?`),p("LOOSE",`^${u[h.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[h.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[h.XRANGEIDENTIFIER]})(?:\\.(${u[h.XRANGEIDENTIFIER]})(?:\\.(${u[h.XRANGEIDENTIFIER]})(?:${u[h.PRERELEASE]})?${u[h.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[h.XRANGEIDENTIFIERLOOSE]})(?:${u[h.PRERELEASELOOSE]})?${u[h.BUILD]}?)?)?`),p("XRANGE",`^${u[h.GTLT]}\\s*${u[h.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[h.GTLT]}\\s*${u[h.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),p("COERCE",`${u[h.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",u[h.COERCEPLAIN]+`(?:${u[h.PRERELEASE]})?(?:${u[h.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",u[h.COERCE],!0),p("COERCERTLFULL",u[h.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[h.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",p("TILDE",`^${u[h.LONETILDE]}${u[h.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[h.LONETILDE]}${u[h.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[h.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",p("CARET",`^${u[h.LONECARET]}${u[h.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[h.LONECARET]}${u[h.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[h.GTLT]}\\s*(${u[h.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[h.GTLT]}\\s*(${u[h.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[h.GTLT]}\\s*(${u[h.LOOSEPLAIN]}|${u[h.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[h.XRANGEPLAIN]})\\s+-\\s+(${u[h.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[h.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Mr,Mr.exports);var bi=Mr.exports;const Vy=Object.freeze({loose:!0}),zy=Object.freeze({}),Gy=s=>s?typeof s!="object"?Vy:s:zy;var wn=Gy;const zo=/^[0-9]+$/,Lh=(s,e)=>{const t=zo.test(s),i=zo.test(e);return t&&i&&(s=+s,e=+e),s===e?0:t&&!i?-1:i&&!t?1:s<e?-1:1},jy=(s,e)=>Lh(e,s);var Bh={compareIdentifiers:Lh,rcompareIdentifiers:jy};const Oi=vs,{MAX_LENGTH:Go,MAX_SAFE_INTEGER:Mi}=ms,{safeRe:jo,t:Xo}=bi,Xy=wn,{compareIdentifiers:St}=Bh;let Hy=class Ce{constructor(e,t){if(t=Xy(t),e instanceof Ce){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Go)throw new TypeError(`version is longer than ${Go} characters`);Oi("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const i=e.trim().match(t.loose?jo[Xo.LOOSE]:jo[Xo.FULL]);if(!i)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Mi||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Mi||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Mi||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const n=+r;if(n>=0&&n<Mi)return n}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Oi("SemVer.compare",this.version,this.options,e),!(e instanceof Ce)){if(typeof e=="string"&&e===this.version)return 0;e=new Ce(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ce||(e=new Ce(e,this.options)),St(this.major,e.major)||St(this.minor,e.minor)||St(this.patch,e.patch)}comparePre(e){if(e instanceof Ce||(e=new Ce(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const i=this.prerelease[t],r=e.prerelease[t];if(Oi("prerelease compare",t,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return St(i,r)}while(++t)}compareBuild(e){e instanceof Ce||(e=new Ce(e,this.options));let t=0;do{const i=this.build[t],r=e.build[t];if(Oi("build compare",t,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return St(i,r)}while(++t)}inc(e,t,i){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const r=Number(i)?1:0;if(!t&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);if(n===-1){if(t===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(t){let n=[t,r];i===!1&&(n=[t]),St(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var se=Hy;const Ho=se,Yy=(s,e,t=!1)=>{if(s instanceof Ho)return s;try{return new Ho(s,e)}catch(i){if(!t)return null;throw i}};var Gt=Yy;const Wy=Gt,Ky=(s,e)=>{const t=Wy(s,e);return t?t.version:null};var qy=Ky;const Zy=Gt,Qy=(s,e)=>{const t=Zy(s.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var Jy=Qy;const Yo=se,em=(s,e,t,i,r)=>{typeof t=="string"&&(r=i,i=t,t=void 0);try{return new Yo(s instanceof Yo?s.version:s,t).inc(e,i,r).version}catch(n){return null}};var tm=em;const Wo=Gt,im=(s,e)=>{const t=Wo(s,null,!0),i=Wo(e,null,!0),r=t.compare(i);if(r===0)return null;const n=r>0,o=n?t:i,l=n?i:t,u=!!o.prerelease.length;if(!!l.prerelease.length&&!u)return!l.patch&&!l.minor?"major":o.patch?"patch":o.minor?"minor":"major";const d=u?"pre":"";return t.major!==i.major?d+"major":t.minor!==i.minor?d+"minor":t.patch!==i.patch?d+"patch":"prerelease"};var sm=im;const rm=se,nm=(s,e)=>new rm(s,e).major;var om=nm;const am=se,lm=(s,e)=>new am(s,e).minor;var hm=lm;const um=se,fm=(s,e)=>new um(s,e).patch;var cm=fm;const dm=Gt,pm=(s,e)=>{const t=dm(s,e);return t&&t.prerelease.length?t.prerelease:null};var gm=pm;const Ko=se,ym=(s,e,t)=>new Ko(s,t).compare(new Ko(e,t));var Ee=ym;const mm=Ee,vm=(s,e,t)=>mm(e,s,t);var _m=vm;const xm=Ee,bm=(s,e)=>xm(s,e,!0);var wm=bm;const qo=se,Tm=(s,e,t)=>{const i=new qo(s,t),r=new qo(e,t);return i.compare(r)||i.compareBuild(r)};var Tn=Tm;const Em=Tn,Am=(s,e)=>s.sort((t,i)=>Em(t,i,e));var Sm=Am;const Cm=Tn,Pm=(s,e)=>s.sort((t,i)=>Cm(i,t,e));var Rm=Pm;const Im=Ee,Om=(s,e,t)=>Im(s,e,t)>0;var _s=Om;const Mm=Ee,Lm=(s,e,t)=>Mm(s,e,t)<0;var En=Lm;const Bm=Ee,Dm=(s,e,t)=>Bm(s,e,t)===0;var Dh=Dm;const Nm=Ee,km=(s,e,t)=>Nm(s,e,t)!==0;var Nh=km;const Fm=Ee,$m=(s,e,t)=>Fm(s,e,t)>=0;var An=$m;const Um=Ee,Vm=(s,e,t)=>Um(s,e,t)<=0;var Sn=Vm;const zm=Dh,Gm=Nh,jm=_s,Xm=An,Hm=En,Ym=Sn,Wm=(s,e,t,i)=>{switch(e){case"===":return typeof s=="object"&&(s=s.version),typeof t=="object"&&(t=t.version),s===t;case"!==":return typeof s=="object"&&(s=s.version),typeof t=="object"&&(t=t.version),s!==t;case"":case"=":case"==":return zm(s,t,i);case"!=":return Gm(s,t,i);case">":return jm(s,t,i);case">=":return Xm(s,t,i);case"<":return Hm(s,t,i);case"<=":return Ym(s,t,i);default:throw new TypeError(`Invalid operator: ${e}`)}};var kh=Wm;const Km=se,qm=Gt,{safeRe:Li,t:Bi}=bi,Zm=(s,e)=>{if(s instanceof Km)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;e=e||{};let t=null;if(!e.rtl)t=s.match(e.includePrerelease?Li[Bi.COERCEFULL]:Li[Bi.COERCE]);else{const u=e.includePrerelease?Li[Bi.COERCERTLFULL]:Li[Bi.COERCERTL];let h;for(;(h=u.exec(s))&&(!t||t.index+t[0].length!==s.length);)(!t||h.index+h[0].length!==t.index+t[0].length)&&(t=h),u.lastIndex=h.index+h[1].length+h[2].length;u.lastIndex=-1}if(t===null)return null;const i=t[2],r=t[3]||"0",n=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",l=e.includePrerelease&&t[6]?`+${t[6]}`:"";return qm(`${i}.${r}.${n}${o}${l}`,e)};var Qm=Zm;class Jm{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const r=this.map.keys().next().value;this.delete(r)}this.map.set(e,t)}return this}}var e0=Jm,Ws,Zo;function Ae(){if(Zo)return Ws;Zo=1;class s{constructor(w,C){if(C=i(C),w instanceof s)return w.loose===!!C.loose&&w.includePrerelease===!!C.includePrerelease?w:new s(w.raw,C);if(w instanceof r)return this.raw=w.value,this.set=[[w]],this.format(),this;if(this.options=C,this.loose=!!C.loose,this.includePrerelease=!!C.includePrerelease,this.raw=w.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(O=>this.parseRange(O.trim())).filter(O=>O.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const O=this.set[0];if(this.set=this.set.filter(L=>!p(L[0])),this.set.length===0)this.set=[O];else if(this.set.length>1){for(const L of this.set)if(L.length===1&&y(L[0])){this.set=[L];break}}}this.format()}format(){return this.range=this.set.map(w=>w.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(w){const O=((this.options.includePrerelease&&f)|(this.options.loose&&c))+":"+w,L=t.get(O);if(L)return L;const R=this.options.loose,k=R?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];w=w.replace(k,K(this.options.includePrerelease)),n("hyphen replace",w),w=w.replace(l[u.COMPARATORTRIM],h),n("comparator trim",w),w=w.replace(l[u.TILDETRIM],d),n("tilde trim",w),w=w.replace(l[u.CARETTRIM],a),n("caret trim",w);let z=w.split(" ").map(Z=>m(Z,this.options)).join(" ").split(/\s+/).map(Z=>X(Z,this.options));R&&(z=z.filter(Z=>(n("loose invalid filter",Z,this.options),!!Z.match(l[u.COMPARATORLOOSE])))),n("range list",z);const $=new Map,H=z.map(Z=>new r(Z,this.options));for(const Z of H){if(p(Z))return[Z];$.set(Z.value,Z)}$.size>1&&$.has("")&&$.delete("");const ne=[...$.values()];return t.set(O,ne),ne}intersects(w,C){if(!(w instanceof s))throw new TypeError("a Range is required");return this.set.some(O=>v(O,C)&&w.set.some(L=>v(L,C)&&O.every(R=>L.every(k=>R.intersects(k,C)))))}test(w){if(!w)return!1;if(typeof w=="string")try{w=new o(w,this.options)}catch(C){return!1}for(let C=0;C<this.set.length;C++)if(q(this.set[C],w,this.options))return!0;return!1}}Ws=s;const e=e0,t=new e,i=wn,r=xs(),n=vs,o=se,{safeRe:l,t:u,comparatorTrimReplace:h,tildeTrimReplace:d,caretTrimReplace:a}=bi,{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:c}=ms,p=T=>T.value==="<0.0.0-0",y=T=>T.value==="",v=(T,w)=>{let C=!0;const O=T.slice();let L=O.pop();for(;C&&O.length;)C=O.every(R=>L.intersects(R,w)),L=O.pop();return C},m=(T,w)=>(n("comp",T,w),T=E(T,w),n("caret",T),T=x(T,w),n("tildes",T),T=I(T,w),n("xrange",T),T=N(T,w),n("stars",T),T),_=T=>!T||T.toLowerCase()==="x"||T==="*",x=(T,w)=>T.trim().split(/\s+/).map(C=>b(C,w)).join(" "),b=(T,w)=>{const C=w.loose?l[u.TILDELOOSE]:l[u.TILDE];return T.replace(C,(O,L,R,k,z)=>{n("tilde",T,O,L,R,k,z);let $;return _(L)?$="":_(R)?$=`>=${L}.0.0 <${+L+1}.0.0-0`:_(k)?$=`>=${L}.${R}.0 <${L}.${+R+1}.0-0`:z?(n("replaceTilde pr",z),$=`>=${L}.${R}.${k}-${z} <${L}.${+R+1}.0-0`):$=`>=${L}.${R}.${k} <${L}.${+R+1}.0-0`,n("tilde return",$),$})},E=(T,w)=>T.trim().split(/\s+/).map(C=>S(C,w)).join(" "),S=(T,w)=>{n("caret",T,w);const C=w.loose?l[u.CARETLOOSE]:l[u.CARET],O=w.includePrerelease?"-0":"";return T.replace(C,(L,R,k,z,$)=>{n("caret",T,L,R,k,z,$);let H;return _(R)?H="":_(k)?H=`>=${R}.0.0${O} <${+R+1}.0.0-0`:_(z)?R==="0"?H=`>=${R}.${k}.0${O} <${R}.${+k+1}.0-0`:H=`>=${R}.${k}.0${O} <${+R+1}.0.0-0`:$?(n("replaceCaret pr",$),R==="0"?k==="0"?H=`>=${R}.${k}.${z}-${$} <${R}.${k}.${+z+1}-0`:H=`>=${R}.${k}.${z}-${$} <${R}.${+k+1}.0-0`:H=`>=${R}.${k}.${z}-${$} <${+R+1}.0.0-0`):(n("no pr"),R==="0"?k==="0"?H=`>=${R}.${k}.${z}${O} <${R}.${k}.${+z+1}-0`:H=`>=${R}.${k}.${z}${O} <${R}.${+k+1}.0-0`:H=`>=${R}.${k}.${z} <${+R+1}.0.0-0`),n("caret return",H),H})},I=(T,w)=>(n("replaceXRanges",T,w),T.split(/\s+/).map(C=>j(C,w)).join(" ")),j=(T,w)=>{T=T.trim();const C=w.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return T.replace(C,(O,L,R,k,z,$)=>{n("xRange",T,O,L,R,k,z,$);const H=_(R),ne=H||_(k),Z=ne||_(z),Xt=Z;return L==="="&&Xt&&(L=""),$=w.includePrerelease?"-0":"",H?L===">"||L==="<"?O="<0.0.0-0":O="*":L&&Xt?(ne&&(k=0),z=0,L===">"?(L=">=",ne?(R=+R+1,k=0,z=0):(k=+k+1,z=0)):L==="<="&&(L="<",ne?R=+R+1:k=+k+1),L==="<"&&($="-0"),O=`${L+R}.${k}.${z}${$}`):ne?O=`>=${R}.0.0${$} <${+R+1}.0.0-0`:Z&&(O=`>=${R}.${k}.0${$} <${R}.${+k+1}.0-0`),n("xRange return",O),O})},N=(T,w)=>(n("replaceStars",T,w),T.trim().replace(l[u.STAR],"")),X=(T,w)=>(n("replaceGTE0",T,w),T.trim().replace(l[w.includePrerelease?u.GTE0PRE:u.GTE0],"")),K=T=>(w,C,O,L,R,k,z,$,H,ne,Z,Xt)=>(_(O)?C="":_(L)?C=`>=${O}.0.0${T?"-0":""}`:_(R)?C=`>=${O}.${L}.0${T?"-0":""}`:k?C=`>=${C}`:C=`>=${C}${T?"-0":""}`,_(H)?$="":_(ne)?$=`<${+H+1}.0.0-0`:_(Z)?$=`<${H}.${+ne+1}.0-0`:Xt?$=`<=${H}.${ne}.${Z}-${Xt}`:T?$=`<${H}.${ne}.${+Z+1}-0`:$=`<=${$}`,`${C} ${$}`.trim()),q=(T,w,C)=>{for(let O=0;O<T.length;O++)if(!T[O].test(w))return!1;if(w.prerelease.length&&!C.includePrerelease){for(let O=0;O<T.length;O++)if(n(T[O].semver),T[O].semver!==r.ANY&&T[O].semver.prerelease.length>0){const L=T[O].semver;if(L.major===w.major&&L.minor===w.minor&&L.patch===w.patch)return!0}return!1}return!0};return Ws}var Ks,Qo;function xs(){if(Qo)return Ks;Qo=1;const s=Symbol("SemVer ANY");class e{static get ANY(){return s}constructor(d,a){if(a=t(a),d instanceof e){if(d.loose===!!a.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),o("comparator",d,a),this.options=a,this.loose=!!a.loose,this.parse(d),this.semver===s?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(d){const a=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],f=d.match(a);if(!f)throw new TypeError(`Invalid comparator: ${d}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new l(f[2],this.options.loose):this.semver=s}toString(){return this.value}test(d){if(o("Comparator.test",d,this.options.loose),this.semver===s||d===s)return!0;if(typeof d=="string")try{d=new l(d,this.options)}catch(a){return!1}return n(d,this.operator,this.semver,this.options)}intersects(d,a){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(d.value,a).test(this.value):d.operator===""?d.value===""?!0:new u(this.value,a).test(d.semver):(a=t(a),a.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!a.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||n(this.semver,"<",d.semver,a)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||n(this.semver,">",d.semver,a)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}Ks=e;const t=wn,{safeRe:i,t:r}=bi,n=kh,o=vs,l=se,u=Ae();return Ks}const t0=Ae(),i0=(s,e,t)=>{try{e=new t0(e,t)}catch(i){return!1}return e.test(s)};var bs=i0;const s0=Ae(),r0=(s,e)=>new s0(s,e).set.map(t=>t.map(i=>i.value).join(" ").trim().split(" "));var n0=r0;const o0=se,a0=Ae(),l0=(s,e,t)=>{let i=null,r=null,n=null;try{n=new a0(e,t)}catch(o){return null}return s.forEach(o=>{n.test(o)&&(!i||r.compare(o)===-1)&&(i=o,r=new o0(i,t))}),i};var h0=l0;const u0=se,f0=Ae(),c0=(s,e,t)=>{let i=null,r=null,n=null;try{n=new f0(e,t)}catch(o){return null}return s.forEach(o=>{n.test(o)&&(!i||r.compare(o)===1)&&(i=o,r=new u0(i,t))}),i};var d0=c0;const qs=se,p0=Ae(),Jo=_s,g0=(s,e)=>{s=new p0(s,e);let t=new qs("0.0.0");if(s.test(t)||(t=new qs("0.0.0-0"),s.test(t)))return t;t=null;for(let i=0;i<s.set.length;++i){const r=s.set[i];let n=null;r.forEach(o=>{const l=new qs(o.semver.version);switch(o.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!n||Jo(l,n))&&(n=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),n&&(!t||Jo(t,n))&&(t=n)}return t&&s.test(t)?t:null};var y0=g0;const m0=Ae(),v0=(s,e)=>{try{return new m0(s,e).range||"*"}catch(t){return null}};var _0=v0;const x0=se,Fh=xs(),{ANY:b0}=Fh,w0=Ae(),T0=bs,ea=_s,ta=En,E0=Sn,A0=An,S0=(s,e,t,i)=>{s=new x0(s,i),e=new w0(e,i);let r,n,o,l,u;switch(t){case">":r=ea,n=E0,o=ta,l=">",u=">=";break;case"<":r=ta,n=A0,o=ea,l="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(T0(s,e,i))return!1;for(let h=0;h<e.set.length;++h){const d=e.set[h];let a=null,f=null;if(d.forEach(c=>{c.semver===b0&&(c=new Fh(">=0.0.0")),a=a||c,f=f||c,r(c.semver,a.semver,i)?a=c:o(c.semver,f.semver,i)&&(f=c)}),a.operator===l||a.operator===u||(!f.operator||f.operator===l)&&n(s,f.semver))return!1;if(f.operator===u&&o(s,f.semver))return!1}return!0};var Cn=S0;const C0=Cn,P0=(s,e,t)=>C0(s,e,">",t);var R0=P0;const I0=Cn,O0=(s,e,t)=>I0(s,e,"<",t);var M0=O0;const ia=Ae(),L0=(s,e,t)=>(s=new ia(s,t),e=new ia(e,t),s.intersects(e,t));var B0=L0;const D0=bs,N0=Ee;var k0=(s,e,t)=>{const i=[];let r=null,n=null;const o=s.sort((d,a)=>N0(d,a,t));for(const d of o)D0(d,e,t)?(n=d,r||(r=d)):(n&&i.push([r,n]),n=null,r=null);r&&i.push([r,null]);const l=[];for(const[d,a]of i)d===a?l.push(d):!a&&d===o[0]?l.push("*"):a?d===o[0]?l.push(`<=${a}`):l.push(`${d} - ${a}`):l.push(`>=${d}`);const u=l.join(" || "),h=typeof e.raw=="string"?e.raw:String(e);return u.length<h.length?u:e};const sa=Ae(),Pn=xs(),{ANY:Zs}=Pn,Wt=bs,Rn=Ee,F0=(s,e,t={})=>{if(s===e)return!0;s=new sa(s,t),e=new sa(e,t);let i=!1;e:for(const r of s.set){for(const n of e.set){const o=U0(r,n,t);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},$0=[new Pn(">=0.0.0-0")],ra=[new Pn(">=0.0.0")],U0=(s,e,t)=>{if(s===e)return!0;if(s.length===1&&s[0].semver===Zs){if(e.length===1&&e[0].semver===Zs)return!0;t.includePrerelease?s=$0:s=ra}if(e.length===1&&e[0].semver===Zs){if(t.includePrerelease)return!0;e=ra}const i=new Set;let r,n;for(const c of s)c.operator===">"||c.operator===">="?r=na(r,c,t):c.operator==="<"||c.operator==="<="?n=oa(n,c,t):i.add(c.semver);if(i.size>1)return null;let o;if(r&&n){if(o=Rn(r.semver,n.semver,t),o>0)return null;if(o===0&&(r.operator!==">="||n.operator!=="<="))return null}for(const c of i){if(r&&!Wt(c,String(r),t)||n&&!Wt(c,String(n),t))return null;for(const p of e)if(!Wt(c,String(p),t))return!1;return!0}let l,u,h,d,a=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1,f=r&&!t.includePrerelease&&r.semver.prerelease.length?r.semver:!1;a&&a.prerelease.length===1&&n.operator==="<"&&a.prerelease[0]===0&&(a=!1);for(const c of e){if(d=d||c.operator===">"||c.operator===">=",h=h||c.operator==="<"||c.operator==="<=",r){if(f&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===f.major&&c.semver.minor===f.minor&&c.semver.patch===f.patch&&(f=!1),c.operator===">"||c.operator===">="){if(l=na(r,c,t),l===c&&l!==r)return!1}else if(r.operator===">="&&!Wt(r.semver,String(c),t))return!1}if(n){if(a&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===a.major&&c.semver.minor===a.minor&&c.semver.patch===a.patch&&(a=!1),c.operator==="<"||c.operator==="<="){if(u=oa(n,c,t),u===c&&u!==n)return!1}else if(n.operator==="<="&&!Wt(n.semver,String(c),t))return!1}if(!c.operator&&(n||r)&&o!==0)return!1}return!(r&&h&&!n&&o!==0||n&&d&&!r&&o!==0||f||a)},na=(s,e,t)=>{if(!s)return e;const i=Rn(s.semver,e.semver,t);return i>0?s:i<0||e.operator===">"&&s.operator===">="?e:s},oa=(s,e,t)=>{if(!s)return e;const i=Rn(s.semver,e.semver,t);return i<0?s:i>0||e.operator==="<"&&s.operator==="<="?e:s};var V0=F0;const Qs=bi,aa=ms,z0=se,la=Bh,G0=Gt,j0=qy,X0=Jy,H0=tm,Y0=sm,W0=om,K0=hm,q0=cm,Z0=gm,Q0=Ee,J0=_m,ev=wm,tv=Tn,iv=Sm,sv=Rm,rv=_s,nv=En,ov=Dh,av=Nh,lv=An,hv=Sn,uv=kh,fv=Qm,cv=xs(),dv=Ae(),pv=bs,gv=n0,yv=h0,mv=d0,vv=y0,_v=_0,xv=Cn,bv=R0,wv=M0,Tv=B0,Ev=k0,Av=V0;var Sv={parse:G0,valid:j0,clean:X0,inc:H0,diff:Y0,major:W0,minor:K0,patch:q0,prerelease:Z0,compare:Q0,rcompare:J0,compareLoose:ev,compareBuild:tv,sort:iv,rsort:sv,gt:rv,lt:nv,eq:ov,neq:av,gte:lv,lte:hv,cmp:uv,coerce:fv,Comparator:cv,Range:dv,satisfies:pv,toComparators:gv,maxSatisfying:yv,minSatisfying:mv,minVersion:vv,validRange:_v,outside:xv,gtr:bv,ltr:wv,intersects:Tv,simplifyRange:Ev,subset:Av,SemVer:z0,re:Qs.re,src:Qs.src,tokens:Qs.t,SEMVER_SPEC_VERSION:aa.SEMVER_SPEC_VERSION,RELEASE_TYPES:aa.RELEASE_TYPES,compareIdentifiers:la.compareIdentifiers,rcompareIdentifiers:la.rcompareIdentifiers};let $h="",Lr=0;function Cv(s,e){return/^\d+$/.test(s)?s+=".0.0":/^\d+\.\d+$/.test(s)&&(s+=".0"),/^\d+$/.test(e)?e+=".0.0":/^\d+\.\d+$/.test(e)&&(e+=".0"),Sv.compare(s,e)}function Uh(s){let e={};if(typeof s=="undefined")if(typeof globalThis.document!="undefined"){let t=globalThis.document.location;if(t&&t.hash)s=t.hash;else return e}else return e;else{let t=s.indexOf("#");if(t!==-1)s=s.slice(t,s.length);else return e}return s.slice(1).split("&").filter(t=>t!=="").forEach(t=>{let i=t.split("="),r=i.shift(),n=i.join("=");e[r]=n||!0}),e}function Pv(s,e=0){$h=cg(s.toString().toUpperCase()),Lr=e}function ha(s=1){return Lr+=s,$h+"-"+(s||Lr)}class Rv{constructor(e){if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+e.firstgid,typeof e.source!="undefined"){let n=e.source,o=Ut(n);if((o==="tsx"||o==="json")&&(e=$n(bn(n)),!e))throw new Error(n+" external TSX/JSON tileset not found")}this.name=e.name,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.spacing=+e.spacing||0,this.margin=+e.margin||0,this.tileoffset=new B,this.isAnimated=!1,this.isCollection=!1,this.class=e.class,this.animations=new Map,this._lastUpdate=0;let t=e.tiles;for(let n in t)if(t.hasOwnProperty(n)){if("animation"in t[n]&&(this.isAnimated=!0,this.animations.set(t[+n].animation[0].tileid,{dt:0,idx:0,frames:t[+n].animation,cur:t[+n].animation[0]})),"properties"in t[n])if(Array.isArray(t[n].properties)){let o={};for(let l in t[n].properties)o[t[n].properties[l].name]=t[n].properties[l].value;this.setTileProperty(+t[n].id+this.firstgid,o)}else this.setTileProperty(+n+this.firstgid,t[n].properties);if("image"in t[n]){let o=Re(t[n].image);if(!o)throw new Error("melonJS: '"+t[n].image+"' file for tile '"+(+n+this.firstgid)+"' not found!");this.imageCollection[+n+this.firstgid]=o}}this.isCollection=this.imageCollection.length>0;let i=e.tileoffset;i&&(this.tileoffset.x=+i.x,this.tileoffset.y=+i.y);let r=e.tileproperties;if(r)for(let n in r)r.hasOwnProperty(n)&&this.setTileProperty(+n+this.firstgid,r[n]);if(this.isCollection===!1){if(this.image=Re(e.image),!this.image)throw new Error("melonJS: '"+e.image+"' file for tileset '"+this.name+"' not found!");this.texture=G.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();let n=+e.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),o=Math.round(this.image.height/(this.tileheight+this.spacing));e.tilecount%n>0&&++o,this.lastgid=this.firstgid+(n*o-1||0),e.tilecount&&this.lastgid-this.firstgid+1!==+e.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+e.tilecount+")")}}getTileImage(e){return this.imageCollection[e]}setTileProperty(e,t){this.TileProperties[e]=t}contains(e){return e>=this.firstgid&&e<=this.lastgid}getViewTileId(e){let t=e-this.firstgid;return this.animations.has(t)?this.animations.get(t).cur.tileid:t}getTileProperties(e){return this.TileProperties[e]}update(e){let t=0,i=le.getTime(),r=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach(n=>{for(n.dt+=e,t=n.cur.duration;n.dt>=t;)n.dt-=t,n.idx=(n.idx+1)%n.frames.length,n.cur=n.frames[n.idx],t=n.cur.duration,r=!0})),r}drawTile(e,t,i,r){if(r.flipped&&(e.save(),e.translate(t,i),e.transform(r.currentTransform),t=i=0),this.isCollection===!0)e.drawImage(this.imageCollection[r.tileId],0,0,r.width,r.height,t,i,r.width,r.height);else{let n=this.atlas[this.getViewTileId(r.tileId)].offset;e.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,t,i,this.tilewidth+e.uvOffset,this.tileheight+e.uvOffset)}r.flipped&&e.restore()}}const Iv=2147483648,Ov=1073741824,Mv=536870912,Br=536870911,Lv="collision";class Bv{constructor(){this.tilesets=[],this.length=0}add(e){this.tilesets.push(e),this.length++}getTilesetByIndex(e){return this.tilesets[e]}getTilesetByGid(e){let t=-1;e&=Br;for(let i=0,r=this.tilesets.length;i<r;i++){if(this.tilesets[i].contains(e))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&e>=this.tilesets[i].firstgid&&(t=i)}if(t!==-1)return this.tilesets[t];throw new Error("no matching tileset found for gid "+e)}}function Vh(s,e,t){let i;if(typeof t!="string")return t;switch(e){case"int":case"float":t=Number(t);break;case"bool":t=t==="true";break;default:if(!t||fg(t))t=t?t==="true":!0;else if(Nl(t))t=Number(t);else if(t.search(/^json:/i)===0){i=t.split(/^json:/i)[1];try{t=JSON.parse(i)}catch(r){throw new Error("Unable to parse JSON: "+i)}}else if(t.search(/^eval:/i)===0){i=t.split(/^eval:/i)[1];try{t=Function("'use strict';return ("+i+")")()}catch(r){throw new Error("Unable to evaluate: "+i)}}else((i=t.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(i=t.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(t="#"+i[2]+i[1]);s.search(/^(ratio|anchorPoint)$/)===0&&typeof t=="number"&&(t={x:t,y:t})}return t}function Dv(s,e){if(e.attributes&&e.attributes.length>0)for(let t=0;t<e.attributes.length;t++){const i=e.attributes.item(t);typeof i.name!="undefined"?s[i.name]=i.value:s[i.nodeName]=i.nodeValue}}function Nv(s,e){let t=e.nodeName;switch(t){case"data":{let i=fe(e);i.encoding=i.encoding||"xml",typeof i.chunks!="undefined"&&(s.chunks=s.chunks||[],i.chunks.forEach(r=>{s.chunks.push({x:+r.x,y:+r.y,width:+r.width,height:+r.height,data:es(r.text,i.encoding,i.compression)})}),s.encoding="none"),typeof i.text!="undefined"&&typeof s.chunks=="undefined"&&(s.data=es(i.text,i.encoding,i.compression),s.encoding="none");break}case"chunk":s.chunks=s.chunks||[],s.chunks.push(fe(e));break;case"imagelayer":case"layer":case"objectgroup":case"group":{let i=fe(e);i.type=t==="layer"?"tilelayer":t,i.image&&(i.image=i.image.source),s.layers=s.layers||[],s.layers.push(i);break}case"animation":s.animation=fe(e).frames;break;case"frame":case"object":{const i=t+"s";s[i]=s[i]||[],s[i].push(fe(e));break}case"tile":{let i=fe(e);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),s.tiles=s.tiles||{},s.tiles[i.id]=i;break}case"tileset":{let i=fe(e);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),s.tilesets=s.tilesets||[],s.tilesets.push(i);break}case"polygon":case"polyline":{s[t]=[];let i=fe(e).points.split(" ");for(let r=0;r<i.length;r++){const n=i[r].split(",");s[t].push({x:+n[0],y:+n[1]})}break}case"properties":s.properties=fe(e);break;case"property":{const i=fe(e),r=typeof i.value!="undefined"?i.value:i.text;s[i.name]=Vh(i.name,i.type||"string",r);break}default:s[t]=fe(e);break}}function kv(s,e){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function Fv(s){let e=s.replace(`
`,"").trim().split(","),t=[];for(let i=0;i<e.length;i++)t.push(+e[i]);return t}function $v(s,e=1){let t=globalThis.atob(s.replace(/[^A-Za-z0-9\+\/\=]/g,"")),i=new Uint32Array(t.length/e);for(let r=0,n=t.length/e;r<n;r++){i[r]=0;for(let o=e-1;o>=0;--o)i[r]+=t.charCodeAt(r*e+o)<<(o<<3)}return i}function es(s,e,t){switch(t=t||"none",e=e||"none",e){case"csv":return Fv(s);case"base64":return t!=="none"?s=kv():s=$v(s,4),s;case"none":return s;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+e)}}function fe(s){let e={},t="";if(s.nodeType===1&&Dv(e,s),s.hasChildNodes()){let i=s.childNodes;for(const r of i)switch(r.nodeType){case 1:Nv(e,r);break;case 3:t+=r.nodeValue.trim();break}}return t&&(e.text=t),e}function Vt(s,e){let t=e.properties,i=e.propertytypes;if(typeof t!="undefined"){for(let r in t)if(t.hasOwnProperty(r)){let n="string",o=r,l=t[r];typeof t[r].name!="undefined"&&(o=t[r].name),typeof i!="undefined"?n=i[r]:typeof t[r].type!="undefined"&&(n=t[r].type),typeof t[r].value!="undefined"&&(l=t[r].value),s[o]=Vh(o,n,l)}}}class zh extends de{constructor(e,t,i,r){let n,o;if(super(),r.isCollection){let l=r.getTileImage(i&Br);n=l.width,o=l.height}else n=r.tilewidth,o=r.tileheight;this.setMinMax(0,0,n,o),this.tileset=r,this.currentTransform=null,this.col=e,this.row=t,this.tileId=i,this.flippedX=(this.tileId&Iv)!==0,this.flippedY=(this.tileId&Ov)!==0,this.flippedAD=(this.tileId&Mv)!==0,this.flipped=this.flippedX||this.flippedY||this.flippedAD,this.flipped===!0&&(this.currentTransform===null&&(this.currentTransform=new Qt),this.setTileTransform(this.currentTransform.identity())),this.tileId&=Br}setTileTransform(e){e.translate(this.width/2,this.height/2),this.flippedAD&&(e.rotate(-90*Math.PI/180),e.scale(-1,1)),this.flippedX&&e.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&e.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),e.translate(-this.width/2,-this.height/2)}getRenderable(e){let t,i=this.tileset;if(i.animations.has(this.tileId)){let r=[],n=[];i.animations.get(this.tileId).frames.forEach(o=>{n.push(o.tileid),r.push({name:""+o.tileid,delay:o.duration})}),t=i.texture.createAnimationFromName(n,e),t.addAnimation(this.tileId-i.firstgid,r),t.setCurrentAnimation(this.tileId-i.firstgid)}else if(i.isCollection===!0){let r=i.getTileImage(this.tileId);t=new Me(0,0,Object.assign({image:r})),t.anchorPoint.set(0,0),t.scale(e.width/this.width,e.height/this.height),typeof e.rotation!="undefined"&&(t.anchorPoint.set(.5,.5),t.currentTransform.rotate(e.rotation),t.currentTransform.translate(e.width/2,e.height/2),e.rotation=void 0)}else t=i.texture.createSpriteFromName(this.tileId-i.firstgid,e),t.anchorPoint.set(0,0);return this.setTileTransform(t.currentTransform),t}}class Uv{constructor(e,t,i){this.points=void 0,this.name=t.name,this.x=+t.x,this.y=+t.y,this.z=+i,this.width=+t.width||0,this.height=+t.height||0,this.gid=+t.gid||null,this.tintcolor=t.tintcolor,this.type=t.type,this.class=typeof t.class!="undefined"?t.class:t.type,this.text=void 0,this.rotation=rn(+t.rotation||0),this.id=+t.id||void 0,this.orientation=e.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,typeof this.gid=="number"?this.setTile(e.tilesets):typeof t.ellipse!="undefined"?this.isEllipse=!0:typeof t.point!="undefined"?this.isPoint=!0:typeof t.polygon!="undefined"?(this.points=t.polygon,this.isPolygon=!0):typeof t.polyline!="undefined"&&(this.points=t.polyline,this.isPolyLine=!0),typeof t.text!="undefined"?(this.text=t.text,this.text.font=t.text.fontfamily||"sans-serif",this.text.size=t.text.pixelsize||16,this.text.fillStyle=t.text.color||"#000000",this.text.textAlign=t.text.halign||"left",this.text.textBaseline=t.text.valign||"top",this.text.width=this.width,this.text.height=this.height,Vt(this.text,t)):(Vt(this,t),this.shapes||(this.shapes=this.parseTMXShapes())),e.isEditor||e.getRenderer().adjustPosition(this)}setTile(e){let t=e.getTilesetByGid(this.gid);t.isCollection===!1&&(this.width=this.framewidth=t.tilewidth,this.height=this.frameheight=t.tileheight),this.tile=new zh(this.x,this.y,this.gid,t)}parseTMXShapes(){let e=[];if(this.isEllipse===!0)e.push(g.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(this.isPoint===!0)e.push(g.pull("Point",this.x,this.y));else if(this.isPolygon===!0){let t=g.pull("Polygon",0,0,this.points),i=t.isConvex();if(i===!1)throw new Error("collision polygones in Tiled should be defined as Convex");if(i===null)throw new Error("invalid polygone");e.push(t.rotate(this.rotation))}else if(this.isPolyLine===!0){let t=this.points,i,r,n=t.length-1;for(let o=0;o<n;o++)i=g.pull("Vector2d",t[o].x,t[o].y),r=g.pull("Vector2d",t[o+1].x,t[o+1].y),this.rotation!==0&&(i=i.rotate(this.rotation),r=r.rotate(this.rotation)),e.push(g.pull("Line",0,0,[i,r]))}else e.push(g.pull("Polygon",0,0,[g.pull("Vector2d"),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)]).rotate(this.rotation));if(this.orientation==="isometric")for(let t=0;t<e.length;t++)typeof e[t].toIso=="function"&&e[t].toIso();return e}getObjectPropertyByName(e){return this[e]}}function Vv(s,e,t,i){const r=Math.abs(s),n=Math.abs(e),o=re(t)/re(r)+re(i)/re(n),l=o>1?Math.sqrt(o)*r:r,u=o>1?Math.sqrt(o)*n:n;return[l,u]}function ua([s,e,t,i],[r,n]){return[s*r+e*n,t*r+i*n]}function zv([s,e],[t,i]){return[s+t,e+i]}function Gv([s,e],t){return[s*t,e*t]}function jv([s,e],[t,i]){return s*t+e*i}function fa([s,e]){return Math.sqrt(Es(s,2)+Es(e,2))}function ca(s,e){const[t,i]=s,[r,n]=e;return(t*n-i*r>=0?1:-1)*Math.acos(jv(s,e)/(fa(s)*fa(e)))}function Xv(s,e,t,i,r,n,o,l,u){const h=rn(u),d=Math.cos(h),a=Math.sin(h),[f,c]=ua([d,a,-a,d],[(s-t)/2,(e-i)/2]),[p,y]=Vv(o,l,f,c),v=r!==n?1:-1,m=re(p)*re(y)-re(p)*re(c)-re(y)*re(f),_=re(p)*re(c)+re(y)*re(f),[x,b]=Gv([p*c/y,-y*f/p],v*Math.sqrt(Math.abs(m/_))),[E,S]=zv(ua([d,-a,a,d],[x,b]),[(s+t)/2,(e+i)/2]),I=[(f-x)/p,(c-b)/y],j=[(-f-x)/p,(-c-b)/y],N=ca([1,0],I),X=ca(I,j)%(2*Math.PI),K=!n&&X>0?X-2*Math.PI:n&&X<0?X+2*Math.PI:X,q=N+K;return{cx:E,cy:S,rx:p,ry:y,startAngle:N,endAngle:q,xAxisRotation:h,anticlockwise:K<0}}class Hv{constructor(e){this.points=[],this.arcResolution=5,this.vertices=[],this.startPoint=g.pull("Point"),this.isDirty=!1,typeof e=="string"&&this.parseSVGPath(e)}parseSVGPath(e){const t=e.match(/([a-df-z])[^a-df-z]*/gi),i=this.points,r=this.startPoint;let n=r;this.beginPath();for(let o=0;o<t.length;o++){const l=t[o],u=l[0].toUpperCase(),h=l.slice(1).trim().split(/[\s,]+/).map(parseFloat);switch(u){case"A":{const d=Xv(...h);this.arc(d.x,d.y,d.radiusX,d.radiusY,d.rotation,d.startAngle,d.endAngle,d.applyanticlockwise)}break;case"H":n=i.length===0?r:i[i.length-1],this.lineTo(n.x+h[0],n.y);break;case"V":n=i.length===0?r:i[i.length-1],this.lineTo(n.x,n.y+h[0]);break;case"M":this.moveTo(...h);break;case"L":this.lineTo(...h);break;case"Q":this.quadraticCurveTo(...h);break;case"C":this.bezierCurveTo(...h);break;case"Z":this.closePath();break;default:console.warn("Unsupported command:",u);break}}}beginPath(){this.points.forEach(e=>{g.push(e)}),this.isDirty=!0,this.points.length=0,this.startPoint.set(0,0)}closePath(){let e=this.points;if(e.length>0){let t=e[0];t.equals(e[e.length-1])||this.lineTo(t.x,t.y),this.isDirty=!0}}triangulatePath(){let e=this.vertices;if(this.isDirty){let t=this.points,i=Pl(t.flatMap(n=>[n.x,n.y])),r=i.length;for(;e.length<r;)e.push(g.pull("Point"));for(let n=0;n<r;n++){let o=t[i[n]];e[n].set(o.x,o.y)}for(;e.length>r;)g.push(e[e.length-1]),e.length-=1;this.isDirty=!1}return e}moveTo(e,t){this.startPoint.set(e,t),this.isDirty=!0}lineTo(e,t){let i=this.points,r=this.startPoint,n=i.length===0?r:i[i.length-1];r.equals(n)?i.push(g.pull("Point",n.x,n.y)):i.push(g.pull("Point",r.x,r.y)),i.push(g.pull("Point",e,t)),r.x=e,r.y=t,this.isDirty=!0}arc(e,t,i,r,n,o=!1){if(r===n)return;const l=o?Math.abs(r-n)>=ee:Math.abs(n-r)>=ee;r=r%ee,n=n%ee,r<0&&(r+=ee),n<0&&(n+=ee),r>=n&&(n+=ee);let u=n-r,h=1;o&&(h=-1,u=ee-u),l&&(u=ee);const a=u*i/this.arcResolution,c=u/a*h;this.moveTo(e+i*Math.cos(r),t+i*Math.sin(r));let p=r;for(let y=0;y<a;y++)this.lineTo(e+i*Math.cos(p),t+i*Math.sin(p)),p+=c;this.lineTo(e+i*Math.cos(n),t+i*Math.sin(n)),this.isDirty=!0}arcTo(e,t,i,r,n){let o=this.points,l=this.startPoint,u=o.length===0?l:o[o.length-1],h=u.x,d=u.y,a=h-e,f=d-t,c=i-e,p=r-t,y=Math.sqrt(Math.pow(a,2)+Math.pow(f,2)),v=Math.sqrt(Math.pow(c,2)+Math.pow(p,2));a/=y,f/=y,c/=v,p/=v;let m=Math.atan2(f,a)-Math.atan2(p,c),_=Math.tan(m/2),x=n/_,b=e+a*x,E=t+f*x,S=e+c*x,I=t+p*x;this.moveTo(b,E);let j=(a+c)/2,N=(f+p)/2,X=Math.sqrt(Math.pow(j,2)+Math.pow(N,2));j/=X,N/=X;let K=Math.sqrt(Math.pow(n,2)+Math.pow(x,2)),q=e+K*j,T=t+K*N,w=Math.atan2(E-T,b-q),C=Math.atan2(I-T,S-q);this.arc(q,T,n,w,C)}ellipse(e,t,i,r,n,o,l,u=!1){if(o===l)return;let h=u?Math.abs(o-l)>=ee:Math.abs(l-o)>=ee;o=o%ee,l=l%ee,o<0&&(o+=ee),l<0&&(l+=ee),o>=l&&(l+=ee);let d=l-o,a=1;u&&(a=-1,d=ee-d),h&&(d=ee);const c=(d*i+d*r)/2/this.arcResolution,y=d/c*a;let v=o;const m=Math.cos(n),_=Math.sin(n);this.moveTo(e+i*Math.cos(o),t+r*Math.sin(o));for(let x=0;x<c;x++){const b=i*Math.cos(v),E=r*Math.sin(v),S=e+b*m-E*_,I=t+b*_+E*m;this.lineTo(S,I),v+=y}this.lineTo(e+i*Math.cos(o),t+r*Math.sin(o)),this.isDirty=!0}quadraticCurveTo(e,t,i,r){const n=this.points,o=this.startPoint,l=n.length===0?o:n[n.length-1],u=g.pull("Point").set(i,r),h=g.pull("Point").set(e,t),d=this.arcResolution,a=1/d;for(let f=1;f<=d;f++)this.lineTo(l.x*Math.pow(1-a*f,2)+h.x*2*(1-a*f)*a*f+u.x*Math.pow(a*f,2),l.y*Math.pow(1-a*f,2)+h.y*2*(1-a*f)*a*f+u.y*Math.pow(a*f,2));g.push(u,h),this.isDirty=!0}bezierCurveTo(e,t,i,r,n,o){const l=this.points,u=this.startPoint,h=l.length===0?u:l[l.length-1],d=g.pull("Point").set(n,o),a=g.pull("Point").set(e,t),f=g.pull("Point").set(i,r),c=this.arcResolution,p=1/c;for(let y=1;y<=c;y++)this.lineTo(h.x*Math.pow(1-p*y,3)+a.x*3*Math.pow(1-p*y,2)*p*y+f.x*3*(1-p*y)*Math.pow(p*y,2)+d.x*Math.pow(p*y,3),h.y*Math.pow(1-p*y,3)+a.y*3*Math.pow(1-p*y,2)*p*y+f.y*3*(1-p*y)*Math.pow(p*y,2)+d.y*Math.pow(p*y,3));g.push(d,a,f),this.isDirty=!0}rect(e,t,i,r){this.moveTo(e,t),this.lineTo(e+i,t),this.moveTo(e+i,t),this.lineTo(e+i,t+r),this.moveTo(e+i,t+r),this.lineTo(e,t+r),this.moveTo(e,t+r),this.lineTo(e,t),this.isDirty=!0}roundRect(e,t,i,r,n){this.moveTo(e+n,t),this.lineTo(e+i-n,t),this.arcTo(e+i,t,e+i,t+n,n),this.moveTo(e+i,t+n),this.lineTo(e+i,t+r-n),this.arcTo(e+i,t+r,e+i-n,t+r,n),this.moveTo(e+i-n,t+r),this.lineTo(e+n,t+r),this.arcTo(e,t+r,e,t+r-n,n),this.moveTo(e,t+r-n),this.lineTo(e,t+n),this.arcTo(e,t,e+n,t,n),this.isDirty=!0}}let da={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d",transparent:!1,premultipliedAlpha:!0,stencil:!0,blendMode:"normal",failIfMajorPerformanceCaveat:!0,preferWebGL1:!1,powerPreference:"default"},Dr;function Yv(s,e){let t;if(e.context==="2d")t=s.getContext(e.context,{willReadFrequently:e.willReadFrequently});else if(e.context==="webgl"){let i={alpha:e.transparent,antialias:e.antiAlias,depth:e.depth,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:e.transparent?e.premultipliedAlpha:!1,powerPreference:e.powerPreference,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat};if(e.preferWebGL1!==!0&&(t=s.getContext("webgl2",i),t&&(Dr=2)),t||(Dr=1,t=s.getContext("webgl",i)||s.getContext("experimental-webgl",i)),!t)throw new Error("A WebGL context could not be created.")}else throw new Error("Invalid context type. Must be one of '2d' or 'webgl'");return t}class Nr{constructor(e,t,i=da){this.canvas,this.context,this.attributes=Object.assign({},da,i),typeof i.context=="undefined"&&(i.context="2d"),typeof i.canvas!="undefined"?this.canvas=i.canvas:this.canvas=yn(e,t,this.attributes.offscreenCanvas),this.context=Yv(this.canvas,this.attributes),this.WebGLVersion=Dr,this.setAntiAlias(this.attributes.antiAlias)}onResetEvent(e,t){this.clear(),this.resize(e,t)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(e=!1){let t=this.canvas;yg("imageSmoothingEnabled",e,this.context),typeof t.style!="undefined"&&(e!==!0?(t.style["image-rendering"]="optimizeSpeed",t.style["image-rendering"]="-moz-crisp-edges",t.style["image-rendering"]="-o-crisp-edges",t.style["image-rendering"]="-webkit-optimize-contrast",t.style["image-rendering"]="optimize-contrast",t.style["image-rendering"]="crisp-edges",t.style["image-rendering"]="pixelated",t.style.msInterpolationMode="nearest-neighbor"):t.style["image-rendering"]="auto")}resize(e,t){this.canvas.width=Math.round(e),this.canvas.height=Math.round(t)}getImageData(e,t,i,r){return e=P(Math.floor(e),0,this.canvas.width-1),t=P(Math.floor(t),0,this.canvas.height-1),i=P(i,1,this.canvas.width-e),r=P(r,1,this.canvas.height-t),this.context.getImageData(e,t,i,r)}toBlob(e="image/png",t){return typeof this.canvas.convertToBlob=="function"?this.canvas.convertToBlob(e,t):new Promise(function(i){this.canvas.toBlob(r=>{i(r)},e,t)})}toImageBitmap(e="image/png",t){return new Promise(i=>{if(typeof this.canvas.transferToImageBitmap=="function")i(this.canvas.transferToImageBitmap());else{let r=new Image;r.src=this.canvas.toDataURL(e,t),r.onload=()=>{globalThis.createImageBitmap(r).then(n=>i(n))}}})}toDataURL(e="image/png",t){return new Promise(i=>{i(this.canvas.toDataURL(e,t))})}invalidate(e){typeof e.gl!="undefined"&&(e.setCompositor("quad"),this.glTextureUnit=e.cache.getUnit(e.cache.get(this.canvas)),e.currentCompositor.unbindTexture2D(null,this.glTextureUnit))}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(e){this.canvas.width=Math.round(e)}get height(){return this.canvas.height}set height(e){this.canvas.height=Math.round(e)}}class bt{constructor(e){this.renderTarget=new Nr(e.width,e.height,typeof globalThis.canvas!="undefined"?Object.assign(e,{canvas:globalThis.canvas}):e),this.settings=e,this.designRatio=this.settings.width/this.settings.height,this.scaleRatio=new B(this.settings.scale,this.settings.scale),this.isContextValid=!0,this.depthTest="sorting",this.path2D=new Hv,this.type="Generic",this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",this.currentColor=new ue(0,0,0,1),this.currentTint=new ue(255,255,255,1),this.projectionMatrix=new Gi,this.uvOffset=0}get height(){return this.getCanvas().height}set height(e){this.resize(this.width,e)}get width(){return this.getCanvas().width}set width(e){this.resize(e,this.height)}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.width,this.currentScissor[3]=this.height,this.clearMask()}getCanvas(){return this.renderTarget.canvas}getContext(){return this.renderTarget.context}getBlendMode(){return this.currentBlendMode}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(e){return e.left<=this.width&&e.right>=0&&e.top<=this.height&&e.bottom>=0}resize(e,t){let i=this.getCanvas();(e!==i.width||t!==i.height)&&(i.width=e,i.height=t,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=e,this.currentScissor[3]=t,D(us,e,t))}setAntiAlias(e=!1){this.renderTarget.setAntiAlias(e)}setProjection(e){this.projectionMatrix.copy(e)}stroke(e,t){switch(e.type){case"RoundRect":this.strokeRoundRect(e.left,e.top,e.width,e.height,e.radius,t);break;case"Rectangle":case"Bounds":this.strokeRect(e.left,e.top,e.width,e.height,t);break;case"Polygon":case"Line":this.strokePolygon(e,t);break;case"Ellipse":this.strokeEllipse(e.pos.x,e.pos.y,e.radiusV.x,e.radiusV.y,t);break;case"Point":this.strokePoint(e.x,e.y);break;default:throw new Error("Invalid geometry for fill/stroke")}}fill(e){this.stroke(e,!0)}tint(e,t,i="multiply"){const r={context:"2d",offscreenCanvas:!0,transparent:!0,antiAlias:this.settings.antiAlias};let n=new Nr(e.width,e.height,r),o=n.context;return o.fillStyle=t instanceof ue?t.toRGB():t,o.fillRect(0,0,e.width,e.height),o.globalCompositeOperation=i,o.drawImage(e,0,0),o.globalCompositeOperation="destination-atop",o.drawImage(e,0,0),n.canvas}setMask(e,t=!1){}clearMask(){}setTint(e,t=e.alpha){this.currentTint.copy(e),this.currentTint.alpha*=t}clearTint(){this.currentTint.setFloat(1,1,1,1)}toBlob(e="image/png",t){return this.renderTarget.toBlob(e,t)}toImageBitmap(e="image/png",t){return this.renderTarget.toImageBitmap(e,t)}toDataURL(e="image/png",t){return this.renderTarget.toDataURL(e,t)}}function Js(s,e){let t={};return s.frames.forEach(i=>{if(i.hasOwnProperty("filename")){let r=i.frame,n=!!i.trimmed,o;n&&(o={x:i.spriteSourceSize.x,y:i.spriteSourceSize.y,w:i.spriteSourceSize.w,h:i.spriteSourceSize.h});let l,u,h=i.sourceSize&&i.pivot;h&&(l=i.sourceSize.w*i.pivot.x-(n?o.x:0),u=i.sourceSize.h*i.pivot.y-(n?o.y:0)),t[i.filename]={name:i.filename,texture:s.meta.image||"default",offset:new B(r.x,r.y),anchorPoint:h?new B(l/r.w,u/r.h):null,trimmed:n,trim:o,width:r.w,height:r.h,angle:i.rotated===!0?-El:0},e.addUVs(t,i.filename,s.meta.size.w,s.meta.size.h)}}),t}function Wv(s,e){let t={},i=s.image,r=s.spacing||0,n=s.margin||0,o=i.width,l=i.height,u=g.pull("Vector2d",~~((o-n+r)/(s.framewidth+r)),~~((l-n+r)/(s.frameheight+r)));if(o%(s.framewidth+r)!==0||l%(s.frameheight+r)!==0){let h=u.x*(s.framewidth+r),d=u.y*(s.frameheight+r);h-o!==r&&d-l!==r&&(o=h,l=d,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(s.framewidth+r)+"x"+(s.frameheight+r)+", truncating effective size to "+o+"x"+l))}for(let h=0,d=u.x*u.y;h<d;h++){let a=""+h;t[a]={name:a,texture:"default",offset:new B(n+(r+s.framewidth)*(h%u.x),n+(r+s.frameheight)*~~(h/u.x)),anchorPoint:s.anchorPoint||null,trimmed:!1,trim:void 0,width:s.framewidth,height:s.frameheight,angle:0},e.addUVs(t,a,o,l)}return g.push(u),t}function Kv(s,e){let t={};const i=s.frames;for(const n in i){let o=i[n].frame,l=!!o.trimmed,u;l&&(u={x:o.spriteSourceSize.x,y:o.spriteSourceSize.y,w:o.spriteSourceSize.w,h:o.spriteSourceSize.h});let h,d,a=o.sourceSize&&o.pivot;a&&(h=o.sourceSize.w*o.pivot.x-(l?u.x:0),d=o.sourceSize.h*o.pivot.y-(l?u.y:0)),t[n]={name:n,texture:s.meta.image||"default",offset:new B(o.x,o.y),anchorPoint:a?new B(h/o.w,d/o.h):null,trimmed:l,trim:u,width:o.w,height:o.h,angle:o.rotated===!0?-El:0},e.addUVs(t,n,s.meta.size.w,s.meta.size.h)}const r={};for(const n in s.meta.frameTags){const o=s.meta.frameTags[n],l=Array.from({length:o.to-o.from+1},(u,h)=>o.from+h);r[n]={name:o.name,index:l,speed:10*(l.length-1),direction:o.direction}}return t.anims=r,t}function Gh(s,e,t="default",i="no-repeat"){return{meta:{app:"melonJS",size:{w:s,h:e},repeat:i,image:"default"},frames:[{filename:t,frame:{x:0,y:0,w:s,h:e}}]}}function qv(s){if(s.includes("texturepacker")||s.includes("free-tex-packer"))return"texturepacker";if(s.includes("shoebox"))return"shoebox";if(s.includes("aseprite"))return"aseprite";if(s.includes("melonJS"))return"melonJS";throw new Error("Unknown texture atlas format: "+s)}class ws{constructor(e,t,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,this.activeAtlas=void 0,typeof e!="undefined"){e=Array.isArray(e)?e:[e];for(let r in e){let n=e[r];if(typeof n.meta!="undefined")switch(this.format=qv(n.meta.app),this.repeat=n.meta.repeat||"no-repeat",this.format){case"texturepacker":case"aseprite":if(typeof t=="undefined"){let o=Re(n.meta.image);if(!o)throw new Error("Atlas texture '"+o+"' not found");this.sources.set(n.meta.image,o)}else this.sources.set(n.meta.image||"default",typeof t=="string"?Re(t):t);this.format==="texturepacker"?this.atlases.set(n.meta.image||"default",Js(n,this)):this.atlases.set(n.meta.image||"default",Kv(n,this));break;case"shoebox":if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.sources.set("default",typeof t=="string"?Re(t):t),this.atlases.set(n.meta.image||"default",Js(n,this));break;case"melonJS":this.sources.set("default",typeof t=="string"?Re(t):t),this.atlases.set(n.meta.image||"default",Js(n,this));break;default:throw new Error("Unknown texture atlas format: "+n.meta.app)}else typeof n.framewidth!="undefined"&&typeof n.frameheight!="undefined"&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",typeof t!="undefined"&&(n.image=typeof t=="string"?Re(t):t),this.atlases.set("default",Wv(n,this)),this.sources.set("default",n.image))}this.activeAtlas=this.atlases.keys().next().value}if(this.atlases.length===0)throw new Error("texture atlas format not supported");i!==!1&&this.sources.forEach(r=>{G.cache.set(r,this)})}getAtlas(e){return typeof e=="string"?this.atlases.get(e):this.atlases.get(this.activeAtlas)}getFormat(){return this.format}getTexture(e){return typeof e=="object"&&typeof e.texture=="string"?this.sources.get(e.texture):this.sources.get(this.activeAtlas)}addRegion(e,t,i,r,n){G.settings.verbose===!0&&console.warn("Adding texture region",e,"for texture",this);let o=this.getTexture(),l=this.getAtlas(),u=o.width,h=o.height;return l[e]={name:e,offset:new B(t,i),width:r,height:n,angle:0},this.addUVs(l,e,u,h),l[e]}getRegion(e,t){let i;if(typeof t=="string")i=this.getAtlas(t)[e];else for(let r of this.atlases.values())if(typeof r[e]!="undefined"){i=r[e];break}return i}getUVs(e){let t=this.getRegion(e);if(typeof t=="undefined"){let i=e.split(","),r=+i[0],n=+i[1],o=+i[2],l=+i[3];t=this.addRegion(e,r,n,o,l)}return t.uvs}addUVs(e,t,i,r){if(typeof G.gl!="undefined"){let n=e[t].offset,o=e[t].width,l=e[t].height;e[t].uvs=new Float32Array([n.x/i,n.y/r,(n.x+o)/i,(n.y+l)/r]);let u=n.x+","+n.y+","+i+","+r;e[u]=e[t]}return e[t].uvs}createSpriteFromName(e,t,i=!1){return g.pull(i===!0?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:e},t||{}))}createAnimationFromName(e,t){let i=[],r={},n=0,o=0;const l=this.getAtlas();typeof e=="undefined"&&(e=l);for(const u in e){const h=Array.isArray(e)?e[u]:u,d=this.getRegion(h);if(d==null)throw new Error("Texture - region for "+h+" not found");i.push(d),r[h]=i.length-1,n=Math.max(d.width,n),o=Math.max(d.height,o)}return new Me(0,0,Object.assign({image:this,framewidth:n,frameheight:o,margin:0,spacing:0,atlas:i,anims:l.anims,atlasIndices:r},t||{}))}}class In{constructor(e,t){if(this.size_=0,this.map=new Map,this.operator=e,t)for(const[i,r]of t)this.put(i,r);return this}get size(){return this.size_}get(e){const t=this.map.get(e);return t?this.operator.clone(t):this.operator.create()}put(e,t){let i=this.map.get(e);return i||(i=this.operator.create()),this.operator.add(t,i)?(this.map.set(e,i),this.size_++,!0):!1}putAll(e,t){let i=0;if(t){const r=e,n=t;for(const o of n)this.put(r,o),i++}else if(e instanceof In)for(const[r,n]of e.entries())this.put(r,n),i++;else throw new TypeError("unexpected arguments");return i>0}has(e){return this.map.has(e)}hasEntry(e,t){return this.operator.has(t,this.get(e))}delete(e){return this.size_-=this.operator.size(this.get(e)),this.map.delete(e)}deleteEntry(e,t){const i=this.get(e);return this.operator.delete(t,i)?(this.map.set(e,i),this.size_--,!0):!1}clear(){this.map.clear(),this.size_=0}keys(){return this.map.keys()}entries(){const e=this;function*t(){for(const[i,r]of e.map.entries())for(const n of r)yield[i,n]}return t()}values(){const e=this;function*t(){for(const[,i]of e.entries())yield i}return t()}forEach(e,t){for(const[i,r]of this.entries())e.call(t===void 0?this:t,r,i,this)}[Symbol.iterator](){return this.entries()}asMap(){const e=new Map;for(const t of this.keys())e.set(t,this.operator.clone(this.get(t)));return e}}class Zv extends In{constructor(e){super(new Qv,e)}get[Symbol.toStringTag](){return"ArrayMultimap"}}class Qv{create(){return[]}clone(e){return e.slice()}add(e,t){return t.push(e),!0}size(e){return e.length}delete(e,t){const i=t.indexOf(e);return i>-1?(t.splice(i,1),!0):!1}has(e,t){return t.includes(e)}}class jh{constructor(e=1/0){this.cache=new Zv,this.tinted=new Map,this.units=new Map,this.usedUnits=new Set,this.max_size=e,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.usedUnits.clear()}allocateTextureUnit(){for(let e=0;e<this.max_size;e++)if(!this.usedUnits.has(e))return this.usedUnits.add(e),e;throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}freeTextureUnit(e){let t=e.sources.get(e.activeAtlas);typeof this.units.get(t)!="undefined"&&(this.usedUnits.delete(t),this.units.delete(t))}getUnit(e){let t=e.sources.get(e.activeAtlas);return this.units.has(t)||this.units.set(t,this.allocateTextureUnit()),this.units.get(t)}set(e,t){let i=e.width||e.videoWidth,r=e.height||e.videoHeight;if(G.WebGLVersion===1&&(!Nt(i)||!Nt(r))){let n=typeof e.src!="undefined"?e.src:e;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+r+")")}return this.cache.put(e,t)}get(e,t){let i=this.cache.get(e)[0];if(typeof i!="undefined"&&typeof t!="undefined"&&this.cache.forEach((r,n)=>{let o=r.getAtlas();n===e&&o.width===t.framewidth&&o.height===t.frameheight&&(i=r)}),typeof i=="undefined"&&(console.log("cache miss"),t||(t=Gh(e.width||e.videoWidth,e.height||e.videoHeight,e.src?bn(e.src):void 0)),i=new ws(t,e,!1),this.set(e,i)),typeof i.sources!="undefined"&&i.sources.size>1){console.log(i);for(const[r,n]of i.sources.entries())n===e&&(console.log("cache hit"),console.log(r),i.activeAtlas=r)}return i}delete(e){if(this.cache.has(e)){let t=this.cache.get(e)[0];typeof t!="undefined"&&this.freeTextureUnit(t),this.cache.delete(e)}}tint(e,t){let i=this.tinted.get(e);return i===void 0&&(i=this.tinted.set(e,new Map)),i.has(t)||i.set(t,G.tint(e,t,"multiply")),i.get(t)}}class Ts extends bt{constructor(e){super(e),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new jh,this.settings.textureSeamFix!==!1&&!this.settings.antiAlias&&(this.uvOffset=1),this.type="CANVAS",this.getCanvas().addEventListener("contextlost",t=>{t.preventDefault(),this.isContextValid=!1,D(un,this)},!1),this.getCanvas().addEventListener("contextrestored",()=>{this.isContextValid=!0,D(Wi,this)},!1),U(pi,()=>{this.reset()})}reset(){super.reset(),this.clearColor(this.currentColor,this.settings.transparent!==!0)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(e="normal",t){switch(t=t||this.getContext(),this.currentBlendMode=e,e){case"screen":t.globalCompositeOperation="screen";break;case"lighter":case"additive":t.globalCompositeOperation="lighter";break;case"multiply":t.globalCompositeOperation="multiply";break;default:t.globalCompositeOperation="source-over",this.currentBlendMode="normal";break}}clear(){if(this.settings.transparent===!1){let e=this.getCanvas();this.getContext().clearRect(0,0,e.width,e.height)}}clearColor(e="#000000",t=!1){let i=this.getCanvas(),r=this.getContext();this.save(),this.resetTransform(),r.globalAlpha=1,r.globalCompositeOperation=t===!0?"copy":"source-over",r.fillStyle=e instanceof ue?e.toRGBA():e,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(e,t,i,r){this.getContext().clearRect(e,t,i,r)}createPattern(e,t){return this.getContext().createPattern(e,t)}drawImage(e,t,i,r,n,o,l,u,h){if(this.getGlobalAlpha()<1/255)return;let d=this.getContext();typeof r=="undefined"?(r=u=e.width,n=h=e.height,o=t,l=i,t=0,i=0):typeof o=="undefined"&&(o=t,l=i,u=r,h=n,r=e.width,n=e.height,t=0,i=0),this.settings.subPixel===!1&&(o=~~o,l=~~l);let a=e,f=this.currentTint.toArray();(f[0]!==1||f[1]!==1||f[2]!==1)&&(a=this.cache.tint(e,this.currentTint.toRGB())),d.drawImage(a,t,i,r,n,o,l,u,h)}drawPattern(e,t,i,r,n){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),l=o.fillStyle;o.fillStyle=e,o.fillRect(t,i,r,n),o.fillStyle=l}beginPath(){this.getContext().beginPath()}moveTo(e,t){this.getContext().moveTo(e,t)}lineTo(e,t){this.getContext().lineTo(e,t)}rect(e,t,i,r){this.getContext().rect(e,t,i,r)}roundRect(e,t,i,r,n){this.getContext().roundRect(e,t,i,r,n)}stroke(e,t){typeof e=="undefined"?t===!0?this.getContext().fill():this.getContext().stroke():super.stroke(e,t)}fill(e){this.stroke(e,!0)}closePath(){this.getContext().closePath()}strokeArc(e,t,i,r,n,o,l=!1){if(this.getGlobalAlpha()<1/255)return;let u=this.getContext();u.translate(e,t),u.beginPath(),u.arc(0,0,i,r,n,o||!1),u[l===!0?"fill":"stroke"](),u.translate(-e,-t)}fillArc(e,t,i,r,n,o){this.strokeArc(e,t,i,r,n,o||!1,!0)}strokeEllipse(e,t,i,r,n=!1){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),l=i,u=r,h=e-l,d=e+l,a=t-u,f=t+u,c=l*.551784,p=u*.551784,y=e-c,v=e+c,m=t-p,_=t+p;o.beginPath(),o.moveTo(e,a),o.bezierCurveTo(v,a,d,m,d,t),o.bezierCurveTo(d,_,v,f,e,f),o.bezierCurveTo(y,f,h,_,h,t),o.bezierCurveTo(h,m,y,a,e,a),o[n===!0?"fill":"stroke"](),o.closePath()}fillEllipse(e,t,i,r){this.strokeEllipse(e,t,i,r,!0)}strokeLine(e,t,i,r){if(this.getGlobalAlpha()<1/255)return;let n=this.getContext();n.beginPath(),n.moveTo(e,t),n.lineTo(i,r),n.stroke()}fillLine(e,t,i,r){this.strokeLine(e,t,i,r)}strokePolygon(e,t=!1){if(this.getGlobalAlpha()<1/255)return;let i=this.getContext(),r=e.points,n=r.length,o=r[0];this.translate(e.pos.x,e.pos.y),i.beginPath(),i.moveTo(o.x,o.y);for(let l=1;l<n;l++){const u=r[l];i.lineTo(u.x,u.y)}i.lineTo(o.x,o.y),i[t===!0?"fill":"stroke"](),i.closePath(),this.translate(-e.pos.x,-e.pos.y)}fillPolygon(e){this.strokePolygon(e,!0)}strokeRect(e,t,i,r,n=!1){if(this.getGlobalAlpha()<1/255)return;this.getContext()[n===!0?"fillRect":"strokeRect"](e,t,i,r)}fillRect(e,t,i,r){this.strokeRect(e,t,i,r,!0)}strokeRoundRect(e,t,i,r,n,o=!1){if(this.getGlobalAlpha()<1/255)return;let l=this.getContext();l.beginPath(),l.roundRect(e,t,i,r,n),l[o===!0?"fill":"stroke"]()}fillRoundRect(e,t,i,r,n){this.strokeRoundRect(e,t,i,r,n,!0)}strokePoint(e,t){this.strokeLine(e,t,e+1,t+1)}fillPoint(e,t){this.strokePoint(e,t)}restore(){const e=this.getCanvas();this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=e.width,this.currentScissor[3]=e.height}save(){this.getContext().save()}rotate(e){this.getContext().rotate(e)}scale(e,t){this.getContext().scale(e,t)}setColor(e){let t=this.currentColor,i=this.getContext();t.copy(e),i.strokeStyle=i.fillStyle=t.toRGBA()}setGlobalAlpha(e){this.getContext().globalAlpha=e}getGlobalAlpha(){return this.getContext().globalAlpha}get lineWidth(){return this.getContext().lineWidth}set lineWidth(e){return this.getContext().lineWidth=e,e}get lineJoin(){return this.getContext().lineJoin}set lineJoin(e){let t=this.getContext();return t.lineJoin=e,t.lineJoin}setTransform(e,t,i,r,n,o){this.resetTransform(),this.transform(e,t,i,r,n,o)}transform(e,t,i,r,n,o){if(typeof e=="object"){let l=e.toArray();e=l[0],t=l[1],i=l[3],r=l[4],n=l[6],o=l[7]}this.settings.subPixel===!1&&(n|=0,o|=0),this.getContext().transform(e,t,i,r,n,o)}translate(e,t){this.settings.subPixel===!1?this.getContext().translate(~~e,~~t):this.getContext().translate(e,t)}clipRect(e,t,i,r){let n=this.getCanvas();if(e!==0||t!==0||i!==n.width||r!==n.height){let o=this.currentScissor;if(o[0]!==e||o[1]!==t||o[2]!==i||o[3]!==r){let l=this.getContext();l.beginPath(),l.rect(e,t,i,r),l.clip(),o[0]=e,o[1]=t,o[2]=i,o[3]=r}}}setMask(e,t=!1){let i=this.getContext();if(this.maskLevel===0&&(i.save(),typeof e!="undefined"&&i.beginPath()),typeof e!="undefined")switch(e.type){case"RoundRect":i.roundRect(e.top,e.left,e.width,e.height,e.radius);break;case"Rectangle":case"Bounds":i.rect(e.top,e.left,e.width,e.height);break;case"Polygon":{const r=e.pos.x,n=e.pos.y;i.moveTo(r+e.points[0].x,n+e.points[0].y);for(let o=1;o<e.points.length;o++){const l=e.points[o];i.lineTo(r+l.x,n+l.y)}}break;case"Ellipse":{const r=e.pos.x,n=e.pos.y,o=e.radiusV.x,l=e.radiusV.y,u=r-o,h=r+o,d=n-l,a=n+l;let f=o*.551784,c=l*.551784,p=r-f,y=r+f,v=n-c,m=n+c;i.moveTo(r,d),i.bezierCurveTo(y,d,h,v,h,n),i.bezierCurveTo(h,m,y,a,r,a),i.bezierCurveTo(p,a,u,m,u,n),i.bezierCurveTo(u,v,p,d,r,d)}break;default:throw new Error("Invalid geometry for setMask")}this.maskLevel++,t===!0?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}function Jv(s,e){let t=new Array(e);for(let i=0;i<e;i++){t[i]=new Array(s);for(let r=0;r<s;r++)t[i][r]=null}return t}function pa(s,e,t){let i=0,r,n;typeof e.rows=="undefined"?(r=e.width,n=e.height):(r=e.cols,n=e.rows);for(let o=0;o<n;o++)for(let l=0;l<r;l++){const u=t[i++];u!==0&&(s.layerData[l+e.x][o+e.y]=s.getTileById(u,l+e.x,o+e.y))}}class jt extends W{constructor(e,t,i,r,n,o,l){super(0,0,0,0),this.tilewidth=t.tilewidth||i,this.tileheight=t.tileheight||r,this.orientation=n,this.x=0,this.y=0,this.tilesets=o,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(let h=0;h<this.tilesets.length;h++){const d=this.tilesets.getTilesetByIndex(h);this.maxTileSize.width=Math.max(this.maxTileSize.width,d.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,d.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=t.renderorder||"right-down",this.class=t.class,this.pos.z=l,this.anchorPoint.set(0,0),this.name=t.name,this.cols=+t.width,this.rows=+t.height;let u=typeof t.visible!="undefined"?+t.visible:1;this.setOpacity(u?+t.opacity:0),typeof t.tintcolor=="string"&&this.tint.parseHex(t.tintcolor,!0),this.orientation==="isometric"?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),Vt(this,t),this.setRenderer(e.getRenderer()),this.layerData=Jv(this.rows,this.cols),e.infinite===0?pa(this,this,es(t.data,t.encoding,t.compression)):e.infinite===1&&t.chunks.forEach(h=>{pa(this,h,es(h.data,t.encoding,t.compression))})}onActivateEvent(){if(this.animatedTilesets===void 0&&(this.animatedTilesets=[]),this.tilesets){let e=this.tilesets.tilesets;for(let t=0;t<e.length;t++)e[t].isAnimated&&this.animatedTilesets.push(e[t])}this.isAnimated=this.animatedTilesets.length>0,typeof this.preRender=="undefined"&&this.isAnimated===!1?this.preRender=this.ancestor.getRootAncestor().preRender:this.preRender=!1,this.preRender===!0&&!this.canvasRenderer&&(this.canvasRenderer=new Ts({canvas:yn(this.width,this.height),width:this.width,heigth:this.height,transparent:!0}),this.getRenderer().drawTileLayer(this.canvasRenderer,this,this)),this.isDirty=!0}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(e){this.renderer=e,this.isDirty=!0}getRenderer(){return this.renderer}getTileId(e,t){let i=this.getTile(e,t);return i?i.tileId:null}getTile(e,t){let i=null;if(this.contains(e,t)){let r=this.getRenderer().pixelToTileCoords(e,t,g.pull("Vector2d"));i=this.cellAt(r.x,r.y),g.push(r)}return i}setTile(e,t,i){return this.layerData[t][i]=e,this.isDirty=!0,e}getTileById(e,t,i){return this.tileset.contains(e)||(this.tileset=this.tilesets.getTilesetByGid(e)),new zh(t,i,e,this.tileset)}cellAt(e,t,i){let r=~~e,n=~~t,o=this.getRenderer();return i===!1||r>=0&&r<o.cols&&n>=0&&n<o.rows?this.layerData[r][n]:null}clearTile(e,t){this.layerData[e][t]=null,this.preRender&&this.canvasRenderer.clearRect(e*this.tilewidth,t*this.tileheight,this.tilewidth,this.tileheight),this.isDirty=!0}update(e){let t=this.isDirty;if(this.isAnimated)for(let i=0;i<this.animatedTilesets.length;i++)t=this.animatedTilesets[i].update(e)||t;return t}draw(e,t){if(this.preRender){const i=Math.min(t.width,this.width),r=Math.min(t.height,this.height);e.drawImage(this.canvasRenderer.getCanvas(),t.pos.x,t.pos.y,i,r,t.pos.x,t.pos.y,i,r)}else this.getRenderer().drawTileLayer(e,this,t)}}class e_{constructor(e,t,i){this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.tintcolor=t.tintcolor,this.class=t.class,this.z=i,this.objects=[];let r=typeof t.visible!="undefined"?t.visible:!0;this.opacity=r===!0?P(+t.opacity||1,0,1):0,Vt(this,t),t.objects&&t.objects.forEach(n=>{n.tintcolor=this.tintcolor,this.objects.push(new Uv(e,n,i))}),t.layers&&t.layers.forEach(n=>{let o=new jt(e,n,e.tilewidth,e.tileheight,e.orientation,e.tilesets,i++);o.setRenderer(e.getRenderer()),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),this.objects.push(o)})}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(e){return this.objects[e]}}function t_(s,e){this.removeChildNow(s,e)}let Di=0;class ye extends W{constructor(e=0,t=0,i,r,n=!1){super(e,t,typeof i=="undefined"?typeof M.viewport!="undefined"?M.viewport.width:1/0:i,typeof r=="undefined"?typeof M.viewport!="undefined"?M.viewport.height:1/0:r),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn="z",this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(o){},this.enableChildBoundsUpdate=!1,this.backgroundColor=g.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),this.root===!0&&U(us,()=>{this.enableChildBoundsUpdate,this.updateBounds(),this.enableChildBoundsUpdate})}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);let e=this.getChildren();for(let t=e.length,i;t>=0;i=e[--t])i&&i.isPersistent!==!0&&this.removeChildNow(i);typeof this.currentTransform!="undefined"&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(e,t){if(e.ancestor instanceof ye?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=ha(e.id)),e.ancestor=this,this.getChildren().push(e),typeof e.updateBounds=="function"&&(this.isFloating===!0&&(e.floating=!1),e.updateBounds()),typeof e.pos!="undefined"&&(typeof t=="number"?e.pos.z=t:this.autoDepth===!0&&(e.pos.z=this.getChildren().length)),this.autoSort===!0&&this.sort(),typeof e.onActivateEvent=="function"&&this.isAttachedToRoot()&&e.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();e.body instanceof he&&i.addBody(e.body),e instanceof ye&&e.forEach(r=>{r.body instanceof he&&i.addBody(r.body)})}return this.isDirty=!0,this.onChildChange.call(this,this.getChildren().length-1),e}addChildAt(e,t){if(t>=0&&t<this.getChildren().length){if(e.ancestor instanceof ye?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=ha()),e.ancestor=this,this.getChildren().splice(t,0,e),typeof e.updateBounds=="function"&&(this.isFloating===!0&&(e.floating=!1),e.updateBounds()),typeof e.onActivateEvent=="function"&&this.isAttachedToRoot()&&e.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();e.body instanceof he&&i.addBody(e.body),e instanceof ye&&e.forEach(r=>{r.body instanceof he&&i.addBody(r.body)})}return this.isDirty=!0,this.onChildChange.call(this,t),e}else throw new Error("Index ("+t+") Out Of Bounds for addChildAt()")}forEach(e,t){let i=this,r=0,n=this.getChildren(),o=n.length;if(typeof e!="function")throw new Error(e+" is not a function");for(arguments.length>1&&(i=t);r<o;)e.call(i,n[r],r,n),r++}swapChildren(e,t){let i=this.getChildIndex(e),r=this.getChildIndex(t);if(i!==-1&&r!==-1){let n=e.pos.z;e.pos.z=t.pos.z,t.pos.z=n,this.getChildren()[i]=t,this.getChildren()[r]=e,this.isDirty=!0}else throw new Error(e+" Both the supplied childs must be a child of the caller "+this)}getChildAt(e){if(e>=0&&e<this.getChildren().length)return this.getChildren()[e];throw new Error("Index ("+e+") Out Of Bounds for getChildAt()")}getChildIndex(e){return this.getChildren().indexOf(e)}getNextChild(e){let t=this.getChildren().indexOf(e)-1;if(t>=0&&t<this.getChildren().length)return this.getChildAt(t)}hasChild(e){return this===e.ancestor}getChildByProp(e,t){let i=[];function r(n,o){let l=n[o];t instanceof RegExp&&typeof l=="string"?t.test(l)&&i.push(n):l===t&&i.push(n)}return this.forEach(n=>{r(n,e),n instanceof ye&&(i=i.concat(n.getChildByProp(e,t)))}),i}getChildByType(e){let t=[];return this.forEach(i=>{i instanceof e&&t.push(i),i instanceof ye&&(t=t.concat(i.getChildByType(e)))}),t}getChildByName(e){return this.getChildByProp("name",e)}getChildByGUID(e){let t=this.getChildByProp("GUID",e);return t.length>0?t[0]:null}getChildren(){return typeof this.children=="undefined"&&(this.children=[]),this.children}updateBounds(e=!0){let t=this.getBounds();return super.updateBounds(e),this.enableChildBoundsUpdate===!0&&this.forEach(i=>{if(i.isRenderable){let r=i.updateBounds(!0);r.isFinite()&&t.addBounds(r)}}),t}isAttachedToRoot(){if(this.root===!0)return!0;{let e=this.ancestor;for(;e;){if(e.root===!0)return!0;e=e.ancestor}return!1}}getRootAncestor(){if(this.root===!0)return this;{let e=this.ancestor;for(;e&&e.root!==!0;)e=e.ancestor;return e}}updateBoundsPos(e=this.pos.x,t=this.pos.y){super.updateBoundsPos(e,t),this.forEach(i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+e-this.pos.x,i.pos.y+t-this.pos.y)})}onActivateEvent(){this.forEach(e=>{typeof e.onActivateEvent=="function"&&e.onActivateEvent()})}removeChild(e,t){if(this.hasChild(e))ft(t_,this,e,t);else throw new Error("Child is not mine.")}removeChildNow(e,t){if(this.hasChild(e)&&this.getChildIndex(e)>=0){typeof e.onDeactivateEvent=="function"&&e.onDeactivateEvent(),e.body instanceof he&&this.getRootAncestor().removeBody(e.body),t||g.push(e,!1)===!1&&typeof e.destroy=="function"&&e.destroy();let i=this.getChildIndex(e);i>=0&&(this.getChildren().splice(i,1),e.ancestor=void 0),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isDirty=!0,this.onChildChange.call(this,i)}}setChildsProperty(e,t,i){this.forEach(r=>{i===!0&&r instanceof ye&&r.setChildsProperty(e,t,i),r[e]=t})}moveUp(e){let t=this.getChildIndex(e);t-1>=0&&(this.swapChildren(e,this.getChildAt(t-1)),this.isDirty=!0)}moveDown(e){let t=this.getChildIndex(e);t>=0&&t+1<this.getChildren().length&&(this.swapChildren(e,this.getChildAt(t+1)),this.isDirty=!0)}moveToTop(e){let t=this.getChildIndex(e);if(t>0){let i=this.getChildren();i.splice(0,0,i.splice(t,1)[0]),e.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(e){let t=this.getChildIndex(e),i=this.getChildren();t>=0&&t<i.length-1&&(i.splice(i.length-1,0,i.splice(t,1)[0]),e.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(e){this.pendingSort||(e===!0&&this.forEach(t=>{t instanceof ye&&t.sort(e)}),this.pendingSort=ft(function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,this.isDirty=!0},this))}onDeactivateEvent(){this.forEach(e=>{typeof e.onDeactivateEvent=="function"&&e.onDeactivateEvent()})}_sortZ(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z:e.pos?-1/0:1/0}_sortReverseZ(e,t){return e.pos&&t.pos?e.pos.z-t.pos.z:e.pos?1/0:-1/0}_sortX(e,t){if(!t.pos||!e.pos)return e.pos?-1/0:1/0;let i=t.pos.z-e.pos.z;return i||t.pos.x-e.pos.x}_sortY(e,t){if(!t.pos||!e.pos)return e.pos?-1/0:1/0;let i=t.pos.z-e.pos.z;return i||t.pos.y-e.pos.y}destroy(){this.reset(),super.destroy(arguments)}update(e){let t=!1,i=V.isPaused(),r=this.getChildren();const n=r.length;for(let o=n,l;o--,l=r[o];)i&&!l.updateWhenPaused||(l.isRenderable?(t=Di>0||l.floating,t&&Di++,l.inViewport=!1,V.current().cameras.forEach(u=>{u.isVisible(l,t)&&(l.inViewport=!0)}),this.isDirty|=(l.inViewport||l.alwaysUpdate)&&l.update(e),Di>0&&Di--):this.isDirty|=l.update(e));return super.update(e)}draw(e,t){let i=!1,r=this.getBounds();this.drawCount=0,this.root===!1&&this.clipping===!0&&r.isFinite()===!0&&e.clipRect(r.left,r.top,r.width,r.height),e.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&e.clearColor(this.backgroundColor);let n=this.getChildren();for(let o=n.length,l;o--,l=n[o];)l.isRenderable&&(i=l.floating===!0,(l.inViewport||i)&&(i&&(e.save(),e.resetTransform()),l.preDraw(e),l.draw(e,t),l.postDraw(e),i&&e.restore(),this.drawCount++))}}class On{constructor(e,t,i,r){this.cols=e,this.rows=t,this.tilewidth=i,this.tileheight=r,this.bounds=new de}canRender(e){return this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight}getBounds(e){let t=e instanceof jt?g.pull("Bounds"):this.bounds;return t.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),t}pixelToTileCoords(e,t,i){return i}tileToPixelCoords(e,t,i){return i}drawTile(e,t,i,r){}drawTileLayer(e,t,i){}}class i_ extends On{constructor(e){super(e.cols,e.rows,e.tilewidth,e.tileheight)}canRender(e){return e.orientation==="orthogonal"&&super.canRender(e)}pixelToTileCoords(e,t,i){return(i||new B).set(e/this.tilewidth,t/this.tileheight)}tileToPixelCoords(e,t,i){return(i||new B).set(e*this.tilewidth,t*this.tileheight)}adjustPosition(e){typeof e.gid=="number"&&(e.y-=e.height)}drawTile(e,t,i,r){let n=r.tileset;n.drawTile(e,n.tileoffset.x+t*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,r)}drawTileLayer(e,t,i){let r=1,n=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(t.maxTileSize.width-t.tilewidth),0),Math.max(i.pos.y-(t.maxTileSize.height-t.tileheight),0),g.pull("Vector2d")).floorSelf(),l=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,g.pull("Vector2d")).ceilSelf();switch(l.x=l.x>this.cols?this.cols:l.x,l.y=l.y>this.rows?this.rows:l.y,t.renderorder){case"right-up":l.y=o.y+(o.y=l.y)-l.y,n=-1;break;case"left-down":l.x=o.x+(o.x=l.x)-l.x,r=-1;break;case"left-up":l.x=o.x+(o.x=l.x)-l.x,l.y=o.y+(o.y=l.y)-l.y,r=-1,n=-1;break}for(let u=o.y;u!==l.y;u+=n)for(let h=o.x;h!==l.x;h+=r){let d=t.cellAt(h,u,!1);d&&this.drawTile(e,h,u,d)}g.push(o),g.push(l)}}class s_ extends On{constructor(e){super(e.cols,e.rows,e.tilewidth,e.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(e){return e.orientation==="isometric"&&super.canRender(e)}getBounds(e){let t=e instanceof jt?g.pull("Bounds"):this.bounds;return t.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),t}pixelToTileCoords(e,t,i){return(i||new B).set(t/this.tileheight+(e-this.originX)/this.tilewidth,t/this.tileheight-(e-this.originX)/this.tilewidth)}tileToPixelCoords(e,t,i){return(i||new B).set((e-t)*this.hTilewidth+this.originX,(e+t)*this.hTileheight)}adjustPosition(e){let t=e.x/this.hTilewidth,i=e.y/this.tileheight,r=g.pull("Vector2d");this.tileToPixelCoords(t,i,r),e.x=r.x,e.y=r.y,g.push(r)}drawTile(e,t,i,r){let n=r.tileset;n.drawTile(e,(this.cols-1)*n.tilewidth+(t-i)*n.tilewidth>>1,-n.tilewidth+(t+i)*n.tileheight>>2,r)}drawTileLayer(e,t,i){let r=t.tileset,n=this.pixelToTileCoords(i.pos.x-r.tilewidth,i.pos.y-r.tileheight,g.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+r.tilewidth,i.pos.y+i.height+r.tileheight,g.pull("Vector2d")).ceilSelf(),l=this.tileToPixelCoords(o.x,o.y,g.pull("Vector2d")),u=this.tileToPixelCoords(n.x,n.y,g.pull("Vector2d"));u.x-=this.hTilewidth,u.y+=this.tileheight;let h=u.y-i.pos.y>this.hTileheight,d=i.pos.x-u.x<this.hTilewidth;h&&(d?(n.x--,u.x-=this.hTilewidth):(n.y--,u.x+=this.hTilewidth),u.y-=this.hTileheight);let a=h^d,f=n.clone();for(let c=u.y*2;c-this.tileheight*2<l.y*2;c+=this.tileheight){f.setV(n);for(let p=u.x;p<l.x;p+=this.tilewidth){let y=t.cellAt(f.x,f.y);if(y){r=y.tileset;let v=r.tileoffset;r.drawTile(e,v.x+p,v.y+c/2-r.tileheight,y)}f.x++,f.y--}a?(n.y++,u.x-=this.hTilewidth,a=!1):(n.x++,u.x+=this.hTilewidth,a=!0)}g.push(f),g.push(n),g.push(o),g.push(l),g.push(u)}}const r_=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],n_=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class Xh extends On{constructor(e){super(e.cols,e.rows,e.tilewidth&-2,e.tileheight&-2),this.hexsidelength=e.hexsidelength||0,this.staggerX=e.staggeraxis==="x",this.staggerEven=e.staggerindex==="even",this.sidelengthx=0,this.sidelengthy=0,e.orientation==="hexagonal"&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new B,new B,new B,new B]}canRender(e){return e.orientation==="hexagonal"&&super.canRender(e)}getBounds(e){let t=e instanceof jt?g.pull("Bounds"):this.bounds;return this.staggerX?(t.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),t.width>1&&(t.height+=this.rowheight)):(t.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),t.height>1&&(t.width+=this.columnwidth)),t}doStaggerX(e){return this.staggerX&&e&1^this.staggerEven}doStaggerY(e){return!this.staggerX&&e&1^this.staggerEven}topLeft(e,t,i){let r=i||new B;return this.staggerX?e&1^this.staggerEven?r.set(e-1,t):r.set(e-1,t-1):t&1^this.staggerEven?r.set(e,t-1):r.set(e-1,t-1),r}topRight(e,t,i){let r=i||new B;return this.staggerX?e&1^this.staggerEven?r.set(e+1,t):r.set(e+1,t-1):t&1^this.staggerEven?r.set(e+1,t-1):r.set(e,t-1),r}bottomLeft(e,t,i){let r=i||new B;return this.staggerX?e&1^this.staggerEven?r.set(e-1,t+1):r.set(e-1,t):t&1^this.staggerEven?r.set(e,t+1):r.set(e-1,t+1),r}bottomRight(e,t,i){let r=i||new B;return this.staggerX?e&1^this.staggerEven?r.set(e+1,t+1):r.set(e+1,t):t&1^this.staggerEven?r.set(e+1,t+1):r.set(e,t+1),r}pixelToTileCoords(e,t,i){let r=i||new B;this.staggerX?e-=this.staggerEven?this.tilewidth:this.sideoffsetx:t-=this.staggerEven?this.tileheight:this.sideoffsety;let n=g.pull("Vector2d",Math.floor(e/(this.columnwidth*2)),Math.floor(t/(this.rowheight*2))),o=g.pull("Vector2d",e-n.x*(this.columnwidth*2),t-n.y*(this.rowheight*2));this.staggerX?(n.x=n.x*2,this.staggerEven&&++n.x):(n.y=n.y*2,this.staggerEven&&++n.y);let l,u,h,d;this.staggerX?(l=this.sidelengthx/2,h=l+this.columnwidth,d=this.tileheight/2,this.centers[0].set(l,d),this.centers[1].set(h,d-this.rowheight),this.centers[2].set(h,d+this.rowheight),this.centers[3].set(h+this.columnwidth,d)):(u=this.sidelengthy/2,h=this.tilewidth/2,d=u+this.rowheight,this.centers[0].set(h,u),this.centers[1].set(h-this.columnwidth,d),this.centers[2].set(h+this.columnwidth,d),this.centers[3].set(h,d+this.rowheight));let a=0,f=Number.MAX_VALUE;for(let p=0;p<4;++p){const y=this.centers[p].sub(o).length2();y<f&&(f=y,a=p)}let c=this.staggerX?r_:n_;return r.set(n.x+c[a].x,n.y+c[a].y),g.push(n),g.push(o),r}tileToPixelCoords(e,t,i){let r=Math.floor(e),n=Math.floor(t),o=i||new B;return this.staggerX?(o.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(r)&&(o.y+=this.rowheight),o.x=r*this.columnwidth):(o.x=r*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(o.x+=this.columnwidth),o.y=n*this.rowheight),o}adjustPosition(e){typeof e.gid=="number"&&(e.y-=e.height)}drawTile(e,t,i,r){let n=r.tileset,o=this.tileToPixelCoords(t,i,g.pull("Vector2d"));n.drawTile(e,n.tileoffset.x+o.x,n.tileoffset.y+o.y+(this.tileheight-n.tileheight),r),g.push(o)}drawTileLayer(e,t,i){let r,n=this.pixelToTileCoords(i.pos.x,i.pos.y,g.pull("Vector2d"));n.sub(t.pos);let o=this.tileToPixelCoords(n.x+t.pos.x,n.y+t.pos.y,g.pull("Vector2d")),l=n.clone(),u=o.clone(),h=i.pos.y-o.y<this.sideoffsety,d=i.pos.x-o.x<this.sideoffsetx;h&&n.y--,d&&n.x--;let a=t.cols,f=t.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+t.pos.x,n.y+t.pos.y,o);let c=this.doStaggerX(n.x+t.pos.x);for(;o.y<i.bottom&&n.y<f;){for(l.setV(n),u.setV(o);u.x<i.right&&l.x<a;l.x+=2)r=t.cellAt(l.x,l.y,!1),r&&r.tileset.drawTile(e,u.x,u.y,r),u.x+=this.tilewidth+this.sidelengthx;c?(n.x-=1,n.y+=1,o.x-=this.columnwidth,c=!1):(n.x+=1,o.x+=this.columnwidth,c=!0),o.y+=this.rowheight}g.push(l),g.push(u)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+t.pos.x,n.y+t.pos.y,o),this.doStaggerY(n.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&n.y<f;n.y++){for(l.setV(n),u.setV(o),this.doStaggerY(n.y)&&(u.x+=this.columnwidth);u.x<i.right&&l.x<a;l.x++)r=t.cellAt(l.x,l.y,!1),r&&r.tileset.drawTile(e,u.x,u.y,r),u.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}g.push(l),g.push(u)}g.push(n),g.push(o)}}class o_ extends Xh{canRender(e){return e.orientation==="staggered"&&super.canRender(e)}pixelToTileCoords(e,t,i){let r=i||new B,n=e,o=t;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;let l=g.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(l.x=l.x*2,this.staggerEven&&++l.x):(l.y=l.y*2,this.staggerEven&&++l.y);let u=g.pull("Vector2d",n-l.x*this.tilewidth,o-l.y*this.tileheight),h=u.x*(this.tileheight/this.tilewidth);return this.sideoffsety-h>u.y&&(l=this.topLeft(l.x,l.y,l)),-this.sideoffsety+h>u.y&&(l=this.topRight(l.x,l.y,l)),this.sideoffsety+h<u.y&&(l=this.bottomLeft(l.x,l.y,l)),this.sideoffsety*3-h<u.y&&(l=this.bottomRight(l.x,l.y,l)),r=this.tileToPixelCoords(l.x,l.y,r),r.set(e-r.x,t-r.y),r.set(r.x-this.tilewidth/2,r.y*(this.tilewidth/this.tileheight)),r.div(this.tilewidth/Math.sqrt(2)).rotate(rn(-45)).add(l),g.push(l),g.push(u),r}}function a_(s){switch(s.orientation){case"orthogonal":return new i_(s);case"isometric":return new s_(s);case"hexagonal":return new Xh(s);case"staggered":return new o_(s);default:throw new Error(s.orientation+" type TMX Tile Map not supported!")}}function Ve(s,e,t){const i="melonJS: %s is deprecated since version %s, please use %s";let r=new Error().stack;console.groupCollapsed?console.groupCollapsed("%c"+i,"font-weight:normal;color:yellow;",s,t,e):console.warn(i,s,t,e),typeof r!="undefined"&&console.warn(r),console.groupCollapsed&&console.groupEnd()}function l_(s,e,t){return new jt(s,e,s.tilewidth,s.tileheight,s.orientation,s.tilesets,t)}function h_(s,e,t){Vt(e.properties,e);let i=g.pull("ImageLayer",+e.offsetx||+e.x||0,+e.offsety||+e.y||0,Object.assign({name:e.name,image:e.image,ratio:g.pull("Vector2d",+e.parallaxx||1,+e.parallaxy||1),tint:typeof e.tintcolor!="undefined"?g.pull("Color").parseHex(e.tintcolor,!0):void 0,z:t},e.properties)),r=typeof e.visible!="undefined"?e.visible:!0;return i.setOpacity(r?+e.opacity:0),i}function u_(s){return new Rv(s)}function ga(s,e,t){return new e_(s,e,t)}class ya{constructor(e,t){this.data=t,this.name=e,this.cols=+t.width,this.rows=+t.height,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.infinite=+t.infinite||0,this.orientation=t.orientation,this.renderorder=t.renderorder||"right-down",this.version=""+t.version,this.tiledversion=""+t.tiledversion,this.class=t.class,this.tilesets=null,typeof this.layers=="undefined"&&(this.layers=[]),typeof this.objectGroups=="undefined"&&(this.objectGroups=[]),this.isEditor=t.editor==="melon-editor",this.nextobjectid=+t.nextobjectid||void 0,this.hexsidelength=+t.hexsidelength,this.staggeraxis=t.staggeraxis,this.staggerindex=t.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=t.backgroundcolor,this.version!=="undefined"&&this.version!==""&&Cv(this.version,"1.5")<0&&Ve("("+this.name+") Tiled Map format version 1.4 and below","format 1.5 or higher","10.4.4"),Vt(this,t),this.initialized=!1}getRenderer(){return(typeof this.renderer=="undefined"||!this.renderer.canRender(this))&&(this.renderer=a_(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(e){if(this.initialized===!0)return;let t=0;this.tilesets||(this.tilesets=new Bv),typeof e.tilesets!="undefined"&&e.tilesets.forEach(r=>{this.tilesets.add(u_(r))}),this.background_image&&this.layers.push(g.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:t++})),e.layers.forEach(i=>{switch(i.type){case"imagelayer":this.layers.push(h_(this,i,t++));break;case"tilelayer":this.layers.push(l_(this,i,t++));break;case"objectgroup":this.objectGroups.push(ga(this,i,t++));break;case"group":this.objectGroups.push(ga(this,i,t++));break}}),this.initialized=!0}addTo(e,t,i){let r=e.autoSort,n=e.autoDepth,o=this.getBounds();e.autoSort=!1,e.autoDepth=!1,this.backgroundcolor&&e.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach(u=>{e.addChild(u)}),this.getObjects(t).forEach(u=>{e.addChild(u)}),e.resize(this.bounds.width,this.bounds.height),e.sort(!0);function l(u,h){M.viewport.setBounds(0,0,Math.max(o.width,u),Math.max(o.height,h)),e.pos.set(Math.max(0,~~((u-o.width)/2)),Math.max(0,~~((h-o.height)/2)),e.pos.z)}i===!0&&(Fe(ct,l),l(M.viewport.width,M.viewport.height),U(ct,l,this)),e.autoSort=r,e.autoDepth=n}getObjects(e){let t=[],i=!1,r;this.readMapObjects(this.data);for(let n=0;n<this.objectGroups.length;n++){let o=this.objectGroups[n];i=o.name.toLowerCase().includes(Lv),e===!1&&(r=new ye(0,0,this.width,this.height),r.anchorPoint.set(0,0),r.name=o.name,r.pos.z=o.z,r.setOpacity(o.opacity),r.autoSort=!1,r.autoDepth=!1);for(let l=0;l<o.objects.length;l++){let u=o.objects[l],h,d;typeof u.anchorPoint=="undefined"&&(u.anchorPoint={x:0,y:0}),typeof u.tintcolor!="undefined"&&(u.tint=g.pull("Color"),u.tint.parseHex(u.tintcolor,!0)),u instanceof jt?h=u:typeof u.text=="object"?(typeof u.text.anchorPoint=="undefined"&&(u.text.anchorPoint=u.anchorPoint),u.text.bitmap===!0?h=g.pull("BitmapText",u.x,u.y,u.text):h=g.pull("Text",u.x,u.y,u.text),h.pos.z=u.z):typeof u.tile=="object"?(d=u.shapes,typeof d=="undefined"&&(d=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),h=u.tile.getRenderable(u),h.body=new he(h,d),h.body.setStatic(!0),h.pos.setMuted(u.x,u.y,u.z)):(typeof u.name!="undefined"&&u.name!==""?h=g.pull(u.name,u.x,u.y,u):(h=g.pull("Renderable",u.x,u.y,u.width,u.height),d=u.shapes,typeof d=="undefined"&&(d=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),h.anchorPoint.set(0,0),h.name=u.name,h.type=u.type,h.class=u.class||u.type,h.id=u.id,h.body=new he(h,d),h.body.setStatic(!0),h.resize(h.body.getBounds().width,h.body.getBounds().height)),h.pos.z=u.z),i&&!u.name&&h.body&&(h.body.collisionType=Q.types.WORLD_SHAPE,h.body.isStatic=!0),e!==!1?(h.isRenderable===!0&&(h.setOpacity(h.getOpacity()*o.opacity),typeof h.renderable!="undefined"&&h.renderable.isRenderable===!0&&h.renderable.setOpacity(h.renderable.getOpacity()*o.opacity)),t.push(h)):r.addChild(h)}e===!1&&r.children.length>0&&(r.autoSort=!0,r.autoDepth=!0,t.push(r))}return t}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}let He={},it=[],Pt=0;function ma(s,e,t){e.container.reset(),M.reset(),He[hi.getCurrentLevelId()]&&He[hi.getCurrentLevelId()].destroy(),Pt=it.indexOf(s),f_(s,e.container,e.flatten,e.setViewportBounds),D(Yi,s),e.onLoaded(s),t&&V.restart()}function f_(s,e,t,i){let r=He[s];Pv(s,r.nextobjectid),e.anchorPoint.set(0,0),r.addTo(e,t,i)}let hi={add(s,e,t){switch(s){case"tmx":if(He[e]==null)He[e]=new ya(e,$n(e)),it.push(e);else return!1;return t&&t(),!0;default:throw new Error("no level loader defined for format "+s)}},load(s,e){if(e=Object.assign({container:M.world,onLoaded:M.onLevelLoaded,flatten:M.mergeGroup,setViewportBounds:!0},e||{}),typeof He[s]=="undefined")throw new Error("level "+s+" not found");if(He[s]instanceof ya)V.isRunning()?(V.stop(),ft(ma,this,s,e,!0)):ma(s,e);else throw new Error("no level loader defined");return!0},getCurrentLevelId(){return it[Pt]},getCurrentLevel(){return He[this.getCurrentLevelId()]},reload(s){return this.load(this.getCurrentLevelId(),s)},next(s){return Pt+1<it.length?this.load(it[Pt+1],s):!1},previous(s){return Pt-1>=0?this.load(it[Pt-1],s):!1},levelCount(){return it.length}};function va(s,e,t,i){if(typeof Ze[s.name]!="undefined")return 0;function r(n){Ze[s.name]=n,s.type==="tmx"&&hi.add(s.type,s.name)}if(s.data){r(s.data),typeof e=="function"&&e();return}return lt(s.src,"text",i).then(n=>{if(typeof n!="string")throw new Error("Invalid response type");let o;switch(Ut(s.src)){case"xml":case"tmx":case"tsx":{const l=new DOMParser;if(typeof l.parseFromString=="undefined")throw new Error("XML file format loading supported, use the JSON file format instead");const u=l.parseFromString(n,"text/xml"),h=fe(u);o=h.map||h.tilesets[0]||h;break}case"json":case"tmj":case"tsj":o=JSON.parse(n);break;default:throw new Error(`TMX file format not supported: ${Ut(s.src)}`)}r(o),typeof e=="function"&&e()}).catch(n=>{typeof t=="function"&&t(n)}),1}function c_(s,e,t,i){return typeof Qe[s.name]!="undefined"?0:(lt(s.src,"json",i).then(r=>{Qe[s.name]=r,typeof e=="function"&&e()}).catch(r=>{typeof t=="function"&&t(r)}),1)}function d_(s,e,t,i){return lt(s.src,"arrayBuffer",i).then(r=>{const n=new TextDecoder;yt[s.name]=n.decode(r),typeof e=="function"&&e()}).catch(r=>{typeof t=="function"&&t(r)}),1}function p_(s,e,t,i){let r=globalThis.document.createElement("script");return r.src=s.src,r.type="text/javascript",typeof crossOrigin=="string"&&(r.crossOrigin=i.crossOrigin),r.defer=!0,typeof e=="function"&&(r.onload=()=>{e()}),typeof t=="function"&&(r.onerror=()=>{t(s.name)}),globalThis.document.getElementsByTagName("body")[0].appendChild(r),1}function g_(s,e,t,i){if(typeof Je[s.name]!="undefined")return 0;let r=Je[s.name]=globalThis.document.createElement("video");if(Ki(s.src)){const n=s.src.match(/[^:]\w+\/[\w-+\d.]+(?=;|,)/)[0];if(!n||r.canPlayType(n)==="")throw new Error(`Invalid dataURL or Video file format not supported: ${n}`)}else if(!ch(Ut(s.src)))throw new Error(`Video file format not supported: ${Ut(s.src)}`);return Ki(s.src)?lt(s.src,"blob",i).then(n=>{r.src=globalThis.URL.createObjectURL(n)}).catch(n=>{typeof t=="function"&&t(n)}):r.src=s.src,r.setAttribute("preload",s.stream===!0?"metadata":"auto"),r.setAttribute("playsinline","true"),r.setAttribute("disablePictureInPicture","true"),r.setAttribute("controls","false"),r.setAttribute("crossorigin",i.crossOrigin),s.autoplay===!0&&r.setAttribute("autoplay","true"),s.loop===!0&&r.setAttribute("loop","true"),typeof e=="function"&&(s.stream===!0||s.autoplay===!1?r.onloadedmetadata=()=>{typeof e=="function"&&e()}:r.oncanplay=()=>{typeof e=="function"&&e()}),typeof t=="function"&&(r.onerror=()=>{t()}),r.load(),1}let Mn="",ce={},Ln,Bn=!1;function Dn(s=!1){Mn=s?"?"+~~(Math.random()*1e7):""}function y_(s){s.crossOrigin!==void 0&&(Ln=s.crossOrigin),s.nocache!==void 0&&Dn(s.nocache),s.withCredentials!==void 0&&(Bn=s.withCredentials)}function m_(s,e){s!=="*"?ce[s]=e:(ce.audio=e,ce.video=e,ce.binary=e,ce.image=e,ce.json=e,ce.js=e,ce.tmx=e,ce.tsx=e)}let ui,v_,__,kr=new Map,Hh=!1,fi=0,Fr=0,_a=0;const Nn={};function x_(){Pe("binary",d_),Pe("image",Ly),Pe("json",c_),Pe("js",p_),Pe("tmx",va),Pe("tsx",va),Pe("audio",pg),Pe("fontface",By),Pe("video",g_),Hh=!0}function kn(s){if(Fr===fi)if(typeof s=="function"||ui){clearTimeout(_a);let e=s||ui;setTimeout(()=>{e(),D(ig)},300)}else throw new Error("no load callback defined");else _a=setTimeout(()=>{kn(s)},100)}function b_(s){delete Nn[s.src],Fr++;let e=Fr/fi;D(wr,e,s)}function w_(s){throw Nn[s.src]=s,this.onError&&this.onError(s),D(sg,s),new Error("Failed loading resource "+s.src)}function Pe(s,e){if(typeof e!="function")throw new Error("invalid parser function for "+s);typeof kr.get(s)!="undefined"&&Ve("overriding parser for "+s+" format"),kr.set(s,e)}function T_(s,e,t=!0){for(let i=0;i<s.length;i++)fi+=Fn(s[i],b_.bind(this,s[i]),w_.bind(this,s[i]));typeof e!="undefined"&&(ui=e),t===!0&&V.change(V.LOADING),kn(ui)}function E_(s){const e=Nn[s];this.unload(e),fi-=1,fi+=this.load(e,this.onResourceLoaded.bind(this,e),this.onLoadingError.bind(this,e)),kn(this.onload)}function Fn(s,e,t){Hh===!1&&x_(),typeof ce[s.type]!="undefined"&&(s.src=ce[s.type]+s.src);let i=kr.get(s.type);if(typeof i=="undefined")throw new Error("load : unknown or invalid resource type : "+s.type);return i.call(this,s,e,t,{nocache:Mn,crossOrigin:Ln,withCredentials:Bn})}function Xe(s){switch(s.type){case"binary":return s.name in yt?(delete yt[s.name],!0):!1;case"image":return s.name in Ie?(delete Ie[s.name],!0):!1;case"json":return s.name in Qe?(delete Qe[s.name],!0):!1;case"js":return!0;case"fontface":return typeof typeof globalThis.document!="undefined"&&typeof globalThis.document.fonts!="undefined"?(globalThis.document.fonts.delete(mt[s.name]),delete mt[s.name],!0):!1;case"tmx":case"tsx":return s.name in Ze?(delete Ze[s.name],!0):!1;case"audio":return Fl(s.name);case"video":return s.name in Je?(delete Je[s.name],!0):!1;default:throw new Error("unload : unknown or invalid resource type : "+s.type)}}function A_(){let s;for(s in yt)yt.hasOwnProperty(s)&&Xe({name:s,type:"binary"});for(s in Ie)Ie.hasOwnProperty(s)&&Xe({name:s,type:"image"});for(s in Ze)Ze.hasOwnProperty(s)&&Xe({name:s,type:"tmx"});for(s in Qe)Qe.hasOwnProperty(s)&&Xe({name:s,type:"json"});for(s in Je)Je.hasOwnProperty(s)&&Xe({name:s,type:"json"});for(s in mt)mt.hasOwnProperty(s)&&Xe({name:s,type:"font"});gg()}function $n(s){return s=""+s,s in Ze?Ze[s]:null}function $r(s){return s=""+s,s in yt?yt[s]:null}function Re(s){return s=bn(""+s),s in Ie?Ie[s]:null}function S_(s){return s=""+s,s in Qe?Qe[s]:null}function C_(s){return s=""+s,s in Je?Je[s]:null}function P_(s){return s=""+s,s in mt?mt[s]:null}var R_={__proto__:null,baseURL:ce,get crossOrigin(){return Ln},getBinary:$r,getFont:P_,getImage:Re,getJSON:S_,getTMX:$n,getVideo:C_,load:Fn,get nocache(){return Mn},onError:__,onProgress:v_,get onload(){return ui},preload:T_,reload:E_,setBaseURL:m_,setNocache:Dn,setOptions:y_,setParser:Pe,unload:Xe,unloadAll:A_,get withCredentials(){return Bn}};class Me extends W{constructor(e,t,i){if(super(e,t,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=g.pull("Vector2d",0,0),this.isVideo=!1,this.onended,this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:void 0,length:0,offset:g.pull("Vector2d",0,0),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof ws){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,typeof i.region!="undefined"){let r=this.source.getRegion(i.region);if(r)this.setRegion(r);else throw new Error("Texture - region for "+i.region+" not found")}}else{if(this.image=typeof i.image=="object"?i.image:Re(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.isVideo=HTMLVideoElement&&this.image instanceof HTMLVideoElement,this.isVideo?(this.width=this.current.width=i.framewidth=i.framewidth||this.image.videoWidth,this.height=this.current.height=i.frameheight=i.frameheight||this.image.videoHeight,this.animationpause=this.image.autoplay!==!0,this.animationpause&&this.image.pause(),this._onBlurFn=()=>{this.image.pause()},U(br,this._onBlurFn),this.image.onended=()=>{typeof this.onended=="function"&&(this.image.loop||(this.animationpause=!0),this.onended())}):(this.width=this.current.width=i.framewidth=i.framewidth||this.image.width,this.height=this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=G.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas())}if(typeof i.atlas!="undefined"&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),typeof i.flipX!="undefined"&&this.flipX(!!i.flipX),typeof i.flipY!="undefined"&&this.flipY(!!i.flipY),typeof i.rotation!="undefined"&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),typeof i.tint!="undefined"&&(i.tint instanceof ue?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),typeof i.name=="string"&&(this.name=i.name),typeof i.z!="undefined"&&(this.pos.z=i.z),typeof i.anims!="undefined")for(const r in i.anims)this.addAnimation(i.anims[r].name,i.anims[r].index,i.anims[r].speed);!this.isVideo&&this.addAnimation("default",null)!==0&&this.setCurrentAnimation("default")}isFlickering(){return this._flicker.isFlickering}play(){this.animationpause=!1}pause(){this.animationpause=!0}flicker(e,t){return this._flicker.duration=e,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=t,this._flicker.isFlickering=!0),this}addAnimation(e,t,i){this.anim[e]={name:e,frames:[],idx:0,length:0};let r=0;if(typeof this.textureAtlas!="object")return 0;t==null&&(t=[],Object.keys(this.textureAtlas).forEach((n,o)=>{t[o]=o}));for(let n=0,o=t.length;n<o;n++){let l=t[n],u;typeof l=="number"||typeof l=="string"?u={name:l,delay:i||this.animationspeed}:u=l;let h=u.name;if(typeof h=="number")typeof this.textureAtlas[h]!="undefined"&&(this.anim[e].frames[n]=Object.assign({},this.textureAtlas[h],u),r++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[e].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[h]],u),r++}}return this.anim[e].length=r,r}setCurrentAnimation(e,t,i=!1){if(typeof this.anim[e]!="undefined")this.isCurrentAnimation(e)||(this.current.name=e,this.current.length=this.anim[this.current.name].length,typeof t=="string"?this.resetAnim=this.setCurrentAnimation.bind(this,t,null,!0):typeof t=="function"?this.resetAnim=t:this.resetAnim=void 0,this.setAnimationFrame(0),i||(this.dt=0),this.isDirty=!0);else throw new Error("animation id '"+e+"' not defined");return this}reverseAnimation(e){return typeof e!="undefined"&&typeof this.anim[e]!="undefined"?this.anim[e].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(e){return this.current.name===e}setRegion(e){return this.image=this.source.getTexture(e),this.current.offset.setV(e.offset),this.current.angle=typeof e.angle=="number"?e.angle:0,this.width=this.current.width=e.width,this.height=this.current.height=e.height,e.anchorPoint&&this.anchorPoint.setMuted(this._flip.x&&e.trimmed===!0?1-e.anchorPoint.x:e.anchorPoint.x,this._flip.y&&e.trimmed===!0?1-e.anchorPoint.y:e.anchorPoint.y),this.updateBounds(),this.isDirty=!0,this}setAnimationFrame(e=0){return this.current.idx=e%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(e){return this.anim[this.current.name].frames[e]}update(e){if(this.isVideo)this.animationpause?this.image.pause():this.image.paused&&this.image.play(),this.isDirty=!this.image.paused;else if(!this.animationpause&&this.current.length>1){let t=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=e;this.dt>=t;){this.isDirty=!0,this.dt-=t;let i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),this.current.idx===0&&(typeof this.onended=="function"&&this.onended(),typeof this.resetAnim=="function"&&this.resetAnim()===!1)){this.setAnimationFrame(this.current.length-1),this.dt%=t;break}t=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=e,this._flicker.duration<0&&(typeof this._flicker.callback=="function"&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(e)}draw(e,t){if(this._flicker.isFlickering&&(this._flicker.state=!this._flicker.state,!this._flicker.state))return;let i=this.current,r=this.pos.x,n=this.pos.y,o=i.width,l=i.height,u=i.offset,h=this.offset;i.angle!==0&&(e.translate(-r,-n),e.rotate(i.angle),r-=l,o=i.height,l=i.width),e.drawImage(this.image,h.x+u.x,h.y+u.y,o,l,r,n,o,l)}destroy(){g.push(this.offset),this.offset=void 0,this.isVideo&&(Fe(br,this._onBlurFn),this._onBlurFn=void 0,this.image.onended=void 0,this.image.pause(),this.image.currentTime=0),this.image=void 0,super.destroy()}}var I_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII=";class O_ extends W{constructor(e,t,i,r){super(e,t,i,r),this.barHeight=r,this.anchorPoint.set(0,0),U(wr,this.onProgressUpdate,this),U(ct,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(e){this.progress=~~(e*this.width),this.isDirty=!0}draw(e,t){e.setColor("black"),e.fillRect(this.pos.x,t.centerY,e.width,this.barHeight/2),e.setColor("#55aa00"),e.fillRect(this.pos.x,t.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Fe(wr,this.onProgressUpdate),Fe(ct,this.resize)}}class M_ extends xi{onResetEvent(){M.world.backgroundColor.parseCSS("#202020"),M.world.addChild(new O_(0,G.height/2,G.width,8),1),Fn({name:"melonjs_logo",type:"image",src:I_},()=>{M.world.addChild(new Me(G.width/2,G.height/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)})}onDestroyEvent(){Xe({name:"melonjs_logo",type:"image"})}}let _e=-1,vt=-1,ts=!1,ae={},tt={color:"",duration:0},Ur=null,Vr=null,ze=0;function Yh(){vt===-1&&_e!==-1&&(vt=globalThis.requestAnimationFrame(Wh))}function L_(){ts&&_e!==-1&&(ts=!1)}function B_(){ts=!0}function Wh(s){D(Ml,s),vt!==-1&&(vt=globalThis.requestAnimationFrame(Wh))}function Kh(){globalThis.cancelAnimationFrame(vt),vt=-1}function er(s){Kh(),ae[_e]&&ae[_e].stage.destroy(),ae[s]&&(_e=s,ae[_e].stage.reset.apply(ae[_e].stage,Vr),Yh(),D(an),Ur&&Ur())}kt(hs,()=>{V.set(V.LOADING,new M_),V.set(V.DEFAULT,new xi),kt(ln,()=>{V.change(V.DEFAULT,!0)})});let V={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(s=!1){_e!==this.LOADING&&this.isRunning()&&(Kh(),s===!0&&s(),ze=globalThis.performance.now(),D(Kp))},pause(s=!1){_e!==this.LOADING&&!this.isPaused()&&(B_(),ze=globalThis.performance.now(),D(br))},restart(s=!1){this.isRunning()||(Yh(),ze=globalThis.performance.now()-ze,D(on,ze))},resume(s=!1){this.isPaused()&&(L_(),ze=globalThis.performance.now()-ze,D(ri,ze))},isRunning(){return vt!==-1},isPaused(){return ts},set(s,e,t=!1){if(!(e instanceof xi))throw new Error(e+" is not an instance of me.Stage");ae[s]={},ae[s].stage=e,ae[s].transition=!0,t===!0&&this.change(s)},get(s=_e){if(typeof ae[s]!="undefined")return ae[s].stage},current(){return this.get()},transition(s,e,t){s==="fade"&&(tt.color=e,tt.duration=t)},setTransition(s,e){ae[s].transition=e},change(s,e){if(typeof ae[s]=="undefined")throw new Error("Undefined Stage for state '"+s+"'");this.isCurrent(s)||(Vr=null,arguments.length>1&&(Vr=Array.prototype.slice.call(arguments,1)),tt.duration&&ae[s].transition?(Ur=()=>{M.viewport.fadeOut(tt.color,tt.duration)},M.viewport.fadeIn(tt.color,tt.duration,function(){ft(er,this,s)})):e===!0?er(s):ft(er,this,s))},isCurrent(s){return _e===s}};class D_{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,kt(hs,()=>{this.reset(),this.now=this.last=0,U(hn,e=>this.update(e))}),U(ri,()=>{this.reset()}),U(on,()=>{this.reset()}),U(an,()=>{this.reset()})}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(e,t,i,...r){return this.timers.push({fn:e,delay:t,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}setInterval(e,t,i,...r){return this.timers.push({fn:e,delay:t,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}clearTimeout(e){e>0&&ft(this.clearTimer.bind(this),this,e)}clearInterval(e){e>0&&ft(this.clearTimer.bind(this),this,e)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10===0&&(this.fps=P(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(e){this.last=this.now,this.now=e,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(e){for(let t=0,i=this.timers.length;t<i;t++)if(this.timers[t].timerId===e){this.timers.splice(t,1);break}}updateTimers(){for(let e=0,t=this.timers.length;e<t;e++){let i=this.timers[e];i.pauseable&&V.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),i.repeat===!0?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}}const le=new D_;class he{constructor(e,t,i){if(this.ancestor=e,typeof this.bounds=="undefined"&&(this.bounds=g.pull("Bounds")),typeof this.shapes=="undefined"&&(this.shapes=[]),this.collisionMask=Q.types.ALL_OBJECT,this.collisionType=Q.types.ENEMY_OBJECT,typeof this.vel=="undefined"&&(this.vel=g.pull("Vector2d")),this.vel.set(0,0),typeof this.force=="undefined"&&(this.force=g.pull("Vector2d")),this.force.set(0,0),typeof this.friction=="undefined"&&(this.friction=g.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,typeof this.maxVel=="undefined"&&(this.maxVel=g.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,typeof i=="function"&&(this.onBodyUpdate=i),this.bounds.clear(),typeof t!="undefined")if(Array.isArray(t))for(let r=0;r<t.length;r++)this.addShape(t[r]);else this.addShape(t);this.ancestor.isKinematic=!1}setStatic(e=!0){this.isStatic=e===!0}addShape(e){if(e instanceof xe||e instanceof de){let t=e.toPolygon();this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)}else e instanceof ii?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.addBounds(e.getBounds()),this.bounds.translate(e.getBounds().x,e.getBounds().y)):e instanceof Ke?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)):e instanceof si?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.addPoint(e)):this.fromJSON(e);return typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this),this.shapes.length}setVertices(e,t=0,i=!0){let r=this.getShape(t);r instanceof Ke?r.setShape(0,0,e):this.shapes[t]=g.pull("Polygon",0,0,e),this.bounds.add(this.shapes[t].points,i),typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this)}addVertices(e,t=0){this.setVertices(e,t,!1)}fromJSON(e,t){let i=e;if(typeof t!="undefined"&&(i=e[t]),typeof i=="undefined")throw new Error("Identifier ("+t+") undefined for the given JSON object)");if(i.length){for(let r=0;r<i.length;r++)this.addVertices(i[r].shape,r);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(e){return this.shapes[e||0]}getBounds(){return this.bounds}removeShape(e){this.bounds.clear(),Hi(this.shapes,e);for(let t=0;t<this.shapes.length;t++)this.addShape(this.shapes[t]);return this.shapes.length}removeShapeAt(e){return this.removeShape(this.getShape(e))}setCollisionMask(e=Q.types.ALL_OBJECT){this.collisionMask=e}setCollisionType(e){if(typeof e!="undefined")if(typeof Q.types[e]!="undefined")this.collisionType=Q.types[e];else throw new Error("Invalid value for the collisionType property")}respondToCollision(e){let t=e.overlapV;if(this.ancestor.pos.sub(t),t.x!==0&&(this.vel.x=~~(.5+this.vel.x-t.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),t.y!==0&&(this.vel.y=~~(.5+this.vel.y-t.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){let i=this.falling===!0?1:this.jumping===!0?-1:0;this.falling=t.y>=i,this.jumping=t.y<=-i}}forEach(e,t){let i=this,r=0,n=this.shapes,o=n.length;if(typeof e!="function")throw new Error(e+" is not a function");for(arguments.length>1&&(i=t);r<o;)e.call(i,n[r],r,n),r++}contains(...e){let t,i;if(e.length===2?[t,i]=e:[t,i]=[e[0].x,e[0].y],this.getBounds().contains(t,i)){for(let r=this.shapes.length,n;r--,n=this.shapes[r];)if(n.contains(t,i))return!0}return!1}rotate(e,t=this.getBounds().center){return e!==0&&(this.bounds.clear(),this.forEach(i=>{i.rotate(e,t),this.bounds.addBounds(i.getBounds())})),this}setMaxVelocity(e,t){this.maxVel.x=e,this.maxVel.y=t}setFriction(e=0,t=0){this.friction.x=e,this.friction.y=t}update(e){let t=le.tick;if(this.force.x!==0&&(this.vel.x+=this.force.x*t),this.force.y!==0&&(this.vel.y+=this.force.y*t),this.friction.x>0){let i=this.friction.x*t,r=this.vel.x+i,n=this.vel.x-i;this.vel.x=r<0?r:n>0?n:0}if(this.friction.y>0){let i=this.friction.y*t,r=this.vel.y+i,n=this.vel.y-i;this.vel.y=r<0?r:n>0?n:0}return this.vel.y!==0&&(this.vel.y=P(this.vel.y,-this.maxVel.y,this.maxVel.y)),this.vel.x!==0&&(this.vel.x=P(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=this.falling?!1:this.jumping,this.ancestor.pos.add(this.vel),this.vel.x!==0||this.vel.y!==0}destroy(){g.push(this.bounds),g.push(this.vel),g.push(this.force),g.push(this.friction),g.push(this.maxVel),this.shapes.forEach(e=>{g.push(e,!1)}),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}let Zt={Linear:{None:function(s){return s}},Quadratic:{In:function(s){return s*s},Out:function(s){return s*(2-s)},InOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}},Cubic:{In:function(s){return s*s*s},Out:function(s){return--s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}},Quartic:{In:function(s){return s*s*s*s},Out:function(s){return 1- --s*s*s*s},InOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}},Quintic:{In:function(s){return s*s*s*s*s},Out:function(s){return--s*s*s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}},Sinusoidal:{In:function(s){return 1-Math.cos(s*Math.PI/2)},Out:function(s){return Math.sin(s*Math.PI/2)},InOut:function(s){return .5*(1-Math.cos(Math.PI*s))}},Exponential:{In:function(s){return s===0?0:Math.pow(1024,s-1)},Out:function(s){return s===1?1:1-Math.pow(2,-10*s)},InOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}},Circular:{In:function(s){return 1-Math.sqrt(1-s*s)},Out:function(s){return Math.sqrt(1- --s*s)},InOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}},Elastic:{In:function(s){return s===0?0:s===1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out:function(s){return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut:function(s){return s===0?0:s===1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}},Back:{In:function(s){return s*s*((1.70158+1)*s-1.70158)},Out:function(s){return--s*s*((1.70158+1)*s+1.70158)+1},InOut:function(s){const e=2.5949095;return(s*=2)<1?.5*(s*s*((e+1)*s-e)):.5*((s-=2)*s*((e+1)*s+e)+2)}},Bounce:{In:function(s){return 1-Zt.Bounce.Out(1-s)},Out:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut:function(s){return s<.5?Zt.Bounce.In(s*2)*.5:Zt.Bounce.Out(s*2-1)*.5+.5}}},Lt={Linear:function(s,e){let t=s.length-1,i=t*e,r=Math.floor(i),n=Lt.Utils.Linear;return e<0?n(s[0],s[1],i):e>1?n(s[t],s[t-1],t-i):n(s[r],s[r+1>t?t:r+1],i-r)},Bezier:function(s,e){let t=0,i=s.length-1,r=Math.pow,n=Lt.Utils.Bernstein,o;for(o=0;o<=i;o++)t+=r(1-e,i-o)*r(e,o)*s[o]*n(i,o);return t},CatmullRom:function(s,e){let t=s.length-1,i=t*e,r=Math.floor(i),n=Lt.Utils.CatmullRom;return s[0]===s[t]?(e<0&&(r=Math.floor(i=t*(1+e))),n(s[(r-1+t)%t],s[r],s[(r+1)%t],s[(r+2)%t],i-r)):e<0?s[0]-(n(s[0],s[0],s[1],s[1],-i)-s[0]):e>1?s[t]-(n(s[t],s[t],s[t-1],s[t-1],i-t)-s[t]):n(s[r?r-1:0],s[r],s[t<r+1?t:r+1],s[t<r+2?t:r+2],i-r)},Utils:{Linear:function(s,e,t){return(e-s)*t+s},Bernstein:function(s,e){let t=Lt.Utils.Factorial;return t(s)/t(e)/t(s-e)},Factorial:function(){let s=[1];return function(e){let t=1,i;if(s[e])return s[e];for(i=e;i>1;i--)t*=i;return s[e]=t,t}}(),CatmullRom:function(s,e,t,i,r){let n=(t-s)*.5,o=(i-e)*.5,l=r*r,u=r*l;return(2*e-2*t+n+o)*u+(-3*e+3*t-2*n-o)*l+n*r+e}}};class xa{constructor(e){this.setProperties(e)}onResetEvent(e){this.setProperties(e)}setProperties(e){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Zt.Linear.None,this._interpolationFunction=Lt.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=M.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1;for(let t in e)typeof e!="object"&&(this._valuesStart[t]=parseFloat(e[t]))}_resumeCallback(e){this._startTime&&(this._startTime+=e)}onActivateEvent(){U(ri,this._resumeCallback,this)}onDeactivateEvent(){Fe(ri,this._resumeCallback)}to(e,t){return this._valuesEnd=e,typeof t!="undefined"&&(typeof t=="number"?this._duration=t:typeof t=="object"&&(t.duration&&(this._duration=t.duration),t.yoyo&&this.yoyo(t.yoyo),t.easing&&this.easing(t.easing),t.repeat&&this.repeat(t.repeat),t.delay&&this.delay(t.delay),t.interpolation&&this.interpolation(t.interpolation),t.autoStart&&this.start())),this}start(e=le.getTime()){this._onStartCallbackFired=!1,M.world.addChild(this),this._startTime=e+this._delayTime;for(let t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(this._valuesEnd[t].length===0)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array||(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this}stop(){return M.world.removeChildNow(this),this}delay(e){return this._delayTime=e,this}repeat(e){return this._repeat=e,this}yoyo(e){return this._yoyo=e,this}easing(e){if(typeof e!="function")throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=e,this}interpolation(e){return this._interpolationFunction=e,this}chain(){return this._chainedTweens=arguments,this}onStart(e){return this._onStartCallback=e,this}onUpdate(e){return this._onUpdateCallback=e,this}onComplete(e){return this._onCompleteCallback=e,this}update(e){this._tweenTimeTracker=M.lastUpdate>this._tweenTimeTracker?M.lastUpdate:this._tweenTimeTracker+e;let t=this._tweenTimeTracker,i;if(t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);let r=(t-this._startTime)/this._duration;r=r>1?1:r;let n=this._easingFunction(r);for(i in this._valuesEnd){let o=this._valuesStart[i]||0,l=this._valuesEnd[i];l instanceof Array?this._object[i]=this._interpolationFunction(l,n):(typeof l=="string"&&(l=o+parseFloat(l)),typeof l=="number"&&(this._object[i]=o+(l-o)*n))}if(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._object,n),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat){if(typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo){let o=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=o}this._valuesStart[i]=this._valuesStartRepeat[i]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=t+this._delayTime,!0}else{M.world.removeChildNow(this),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object);for(let o=0,l=this._chainedTweens.length;o<l;o++)this._chainedTweens[o].start(t);return!1}return!0}static get Easing(){return Zt}static get Interpolation(){return Lt}}class N_{constructor(e,t){this.vertexSize=e,this.objSize=t,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(e=this.objSize){return this.vertexCount+e>=this.maxVertex}resize(e){for(;e>this.maxVertex;)this.maxVertex<<=1;let t=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(t),this}push(e,t,i,r,n){let o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(this.vertexCount),this.bufferF32[o]=e,this.bufferF32[++o]=t,typeof i!="undefined"&&(this.bufferF32[++o]=i,this.bufferF32[++o]=r),typeof n!="undefined"&&(this.bufferU32[++o]=n),this.vertexCount++,this}toFloat32(e,t){return typeof t!="undefined"?this.bufferF32.subarray(e,t):this.bufferF32}toUint32(e,t){return typeof t!="undefined"?this.bufferU32.subarray(e,t):this.bufferU32}length(){return this.vertexCount}isEmpty(){return this.vertexCount===0}}class qh{constructor(e,t){this.init(e,t)}init(e,t){if(this.renderer=e,this.gl=e.gl,this.color=e.currentColor,this.viewMatrix=e.currentTransform,this.defaultShader=void 0,this.currentShader=void 0,this.mode=this.gl.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.vertexData=null,typeof t!="undefined"&&Array.isArray(t.attributes))t.attributes.forEach(i=>{this.addAttribute(i.name,i.size,i.type,i.normalized,i.offset),this.vertexData=new N_(this.vertexSize,6)});else throw new Error("attributes definition missing");if(typeof t!="undefined"&&typeof t.shader!="undefined")this.defaultShader=new Oh(this.gl,t.shader.vertex,t.shader.fragment);else throw new Error("shader definition missing")}reset(){this.gl=this.renderer.gl,this.vertexData.clear()}bind(){this.renderer.currentProgram!==this.defaultShader.program&&this.useShader(this.defaultShader)}useShader(e){this.renderer.currentProgram!==e.program&&(this.flush(),e.bind(),e.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),e.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize),this.currentShader=e,this.renderer.currentProgram=this.currentShader.program)}addAttribute(e,t,i,r,n){switch(this.attributes.push({name:e,size:t,type:i,normalized:r,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=t*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=t*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=t*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=t*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=t*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=t*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=t*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setProjection(e){this.currentShader.setUniform("uProjectionMatrix",e)}flush(e=this.mode){let t=this.vertexData,i=t.vertexCount;if(i>0){let r=this.gl,n=t.vertexSize;this.renderer.WebGLVersion>1?r.bufferData(r.ARRAY_BUFFER,t.toFloat32(),r.STREAM_DRAW,0,i*n):r.bufferData(r.ARRAY_BUFFER,t.toFloat32(0,i*n),r.STREAM_DRAW),r.drawArrays(e,0,i),t.clear()}}}var k_=`// Current vertex point
attribute vec2 aVertex;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
}
`,F_=`varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
`;class $_ extends qh{init(e){super.init(e,{attributes:[{name:"aVertex",size:2,type:e.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:e.gl.UNSIGNED_BYTE,normalized:!0,offset:2*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:k_,fragment:F_}})}drawVertices(e,t,i=t.length){let r=this.viewMatrix,n=this.vertexData,o=this.renderer.getGlobalAlpha(),l=this.renderer.currentColor.toUint32(o);n.isFull(i)&&this.flush(),e!==this.mode&&(this.flush(this.mode),this.mode=e),r.isIdentity()?t.forEach(u=>{n.push(u.x,u.y,void 0,void 0,l)}):t.forEach(u=>{r.apply(u),n.push(u.x,u.y,void 0,void 0,l)}),(this.mode===this.gl.LINE_STRIP||this.mode===this.gl.LINE_LOOP)&&this.flush(this.mode)}}var U_=`// Current vertex point
attribute vec2 aVertex;
attribute vec2 aRegion;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec2 vRegion;
varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
    vRegion = aRegion;
}
`,V_=`uniform sampler2D uSampler;
varying vec4 vColor;
varying vec2 vRegion;

void main(void) {
    gl_FragColor = texture2D(uSampler, vRegion) * vColor;
}
`;let Ni=[new B,new B,new B,new B];class z_ extends qh{init(e){super.init(e,{attributes:[{name:"aVertex",size:2,type:e.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aRegion",size:2,type:e.gl.FLOAT,normalized:!1,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:e.gl.UNSIGNED_BYTE,normalized:!0,offset:4*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:U_,fragment:V_}}),this.currentTextureUnit=-1,this.boundTextures=[]}reset(){super.reset();for(let e=0;e<this.renderer.maxTextures;e++){let t=this.getTexture2D(e);typeof t!="undefined"&&this.deleteTexture2D(t)}this.currentTextureUnit=-1}createTexture2D(e,t=null,i,r="no-repeat",n=t.width,o=t.height,l=!0,u=!0){let h=this.gl,d=Nt(n)&&Nt(o),a=r.search(/^repeat(-x)?$/)===0&&(d||this.renderer.WebGLVersion>1)?h.REPEAT:h.CLAMP_TO_EDGE,f=r.search(/^repeat(-y)?$/)===0&&(d||this.renderer.WebGLVersion>1)?h.REPEAT:h.CLAMP_TO_EDGE,c=h.createTexture();if(this.bindTexture2D(c,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),t===null||typeof t.byteLength!="undefined")h.texImage2D(h.TEXTURE_2D,0,h.RGBA,n,o,0,h.RGBA,h.UNSIGNED_BYTE,t,0);else if(typeof globalThis.OffscreenCanvas!="undefined"&&t instanceof globalThis.OffscreenCanvas){const p=t.transferToImageBitmap();h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,p),p.close()}else h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t);return d&&u===!0&&h.generateMipmap(h.TEXTURE_2D),c}deleteTexture2D(e){this.gl.deleteTexture(e),this.unbindTexture2D(e)}getTexture2D(e){return this.boundTextures[e]}bindTexture2D(e,t){let i=this.gl;e!==this.boundTextures[t]?(this.flush(),this.currentTextureUnit!==t&&(this.currentTextureUnit=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,e),this.boundTextures[t]=e):this.currentTextureUnit!==t&&(this.flush(),this.currentTextureUnit=t,i.activeTexture(i.TEXTURE0+t))}unbindTexture2D(e,t){return typeof t=="undefined"&&(t=this.boundTextures.indexOf(e)),t!==-1&&(delete this.boundTextures[t],t===this.currentTextureUnit&&(this.currentTextureUnit=-1)),t}uploadTexture(e,t,i,r=!1){let n=this.renderer.cache.getUnit(e),o=this.boundTextures[n];return typeof o=="undefined"||r?this.createTexture2D(n,e.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,e.repeat,t,i,e.premultipliedAlpha):this.bindTexture2D(o,n),this.currentTextureUnit}addQuad(e,t,i,r,n,o,l,u,h,d,a=!1){let f=this.vertexData;f.isFull(6)&&this.flush();let c=this.uploadTexture(e,r,n,a);this.currentShader.setUniform("uSampler",c);let p=this.viewMatrix,y=Ni[0].set(t,i),v=Ni[1].set(t+r,i),m=Ni[2].set(t,i+n),_=Ni[3].set(t+r,i+n);p.isIdentity()||(p.apply(y),p.apply(v),p.apply(m),p.apply(_)),f.push(y.x,y.y,o,l,d),f.push(v.x,v.y,u,l,d),f.push(m.x,m.y,o,h,d),f.push(m.x,m.y,o,h,d),f.push(v.x,v.y,u,l,d),f.push(_.x,_.y,u,h,d)}}let tr;class Zh extends bt{constructor(e){super(Object.assign(e,{context:"webgl"})),this.GPUVendor=void 0,this.GPURenderer=void 0,this.gl=this.renderTarget.context,this.lineWidth=1,this.lineJoin="round",this.vertexBuffer=this.gl.createBuffer(),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Qt,this.currentCompositor=void 0,this.currentProgram=void 0,this.compositors=new Map,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.addCompositor(new(this.settings.compositor||z_)(this),"quad",!0),this.addCompositor(new(this.settings.compositor||$_)(this),"primitive"),this.depthTest=e.depthTest,this.depthTest==="z-buffer"?(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.depthMask(!0)):(this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1)),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);let t=this.gl.getExtension("WEBGL_debug_renderer_info");t!==null&&(this.GPUVendor=this.gl.getParameter(t.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL)),this.customShader=void 0,this.cache=new jh(this.maxTextures),this.type="WebGL"+this.WebGLVersion,this.getCanvas().addEventListener("webglcontextlost",i=>{i.preventDefault(),this.isContextValid=!1,D(un,this)},!1),this.getCanvas().addEventListener("webglcontextrestored",()=>{this.reset(),this.isContextValid=!0,D(Wi,this)},!1),U(pi,()=>{this.reset()}),U(us,(i,r)=>{this.flush(),this.setViewport(0,0,i,r)})}get WebGLVersion(){return this.renderTarget.WebGLVersion}getSupportedCompressedTextureFormats(){if(typeof tr=="undefined"){const e=this.gl;tr={astc:e.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:e.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:e.getExtension("WEBGL_compressed_texture_etc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||e.getExtension("WEBGL_compressed_texture_es3_0")}}return tr}hasSupportedCompressedFormats(e){const t=this.getSupportedCompressedTextureFormats();for(var i in t)for(var r in t[i])if(e===t[i][r])return!0;return!1}reset(){super.reset(),this._colorStack.forEach(e=>{g.push(e)}),this._matrixStack.forEach(e=>{g.push(e)}),this._colorStack.length=0,this._matrixStack.length=0,this._blendStack.length=0,this.clear(),this.setViewport(),this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING)!==this.vertexBuffer&&this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.currentCompositor=void 0,this.currentProgram=void 0,this.customShader=void 0,this.compositors.forEach(e=>{this.isContextValid===!1?e.init(this):e.reset()}),this.setCompositor("quad"),this.gl.disable(this.gl.SCISSOR_TEST)}addCompositor(e,t="default",i=!1){if(typeof this.compositors.get(t)!="undefined")throw new Error("Invalid Compositor name");this.compositors.set(t,e),i===!0&&this.setCompositor(t)}setCompositor(e="default",t=this.customShader){let i=this.compositors.get(e);if(typeof i=="undefined")throw new Error("Invalid Compositor");return this.currentCompositor!==i&&(this.currentCompositor!==void 0&&this.currentCompositor.flush(),this.currentCompositor=i),e==="quad"&&typeof t=="object"?this.currentCompositor.useShader(t):this.currentCompositor.bind(),this.currentCompositor}resetTransform(){this.currentTransform.identity()}createPattern(e,t){if(this.setCompositor("quad"),G.WebGLVersion===1&&(!Nt(e.width)||!Nt(e.height))){let r=typeof e.src!="undefined"?e.src:e;throw new Error("[WebGL Renderer] "+r+" is not a POT texture ("+e.width+"x"+e.height+")")}let i=new ws(Gh(e.width,e.height,"pattern",t),e);return this.currentCompositor.uploadTexture(i),i}flush(){this.currentCompositor.flush()}setProjection(e){super.setProjection(e),this.currentCompositor.setProjection(e)}setViewport(e=0,t=0,i=this.getCanvas().width,r=this.getCanvas().height){this.gl.viewport(e,t,i,r)}clear(){let e=this.gl;e.clearColor(0,0,0,this.settings.transparent?0:1),this.lineWidth=1,this.depthTest==="z-buffer"?e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT):e.clear(e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}clearColor(e="#000000",t=!1){let i,r=this.gl;if(e instanceof ue)i=e.toArray();else{let n=g.pull("me.Color");i=n.parseCSS(e).toArray(),g.push(n)}r.clearColor(i[0],i[1],i[2],t===!0?1:i[3]),r.clear(r.COLOR_BUFFER_BIT)}clearRect(e,t,i,r){this.save(),this.clipRect(e,t,i,r),this.clearColor(),this.restore()}drawImage(e,t,i,r,n,o,l,u,h){typeof r=="undefined"?(r=u=e.width,n=h=e.height,o=t,l=i,t=0,i=0):typeof o=="undefined"&&(o=t,l=i,u=r,h=n,r=e.width,n=e.height,t=0,i=0),this.settings.subPixel===!1&&(o|=0,l|=0),this.setCompositor("quad");let d=typeof e.videoWidth!="undefined",a=this.cache.get(e),f=a.getUVs(t+","+i+","+r+","+n);this.currentCompositor.addQuad(a,o,l,u,h,f[0],f[1],f[2],f[3],this.currentTint.toUint32(this.getGlobalAlpha()),d)}drawPattern(e,t,i,r,n){let o=e.getUVs("0,0,"+r+","+n);this.setCompositor("quad"),this.currentCompositor.addQuad(e,t,i,r,n,o[0],o[1],o[2],o[3],this.currentTint.toUint32(this.getGlobalAlpha()))}beginPath(){this.path2D.beginPath()}moveTo(e,t){this.path2D.moveTo(e,t)}lineTo(e,t){this.path2D.lineTo(e,t)}rect(e,t,i,r){this.path2D.rect(e,t,i,r)}roundRect(e,t,i,r,n){this.path2D.roundRect(e,t,i,r,n)}stroke(e,t){this.setCompositor("primitive"),typeof e=="undefined"?t===!0?this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()):this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):super.stroke(e,t)}fill(e){this.stroke(e,!0)}closePath(){this.path2D.closePath()}getContext(){return this.gl}setBlendMode(e="normal",t=this.gl){if(this.currentBlendMode!==e)switch(this.flush(),t.enable(t.BLEND),this.currentBlendMode=e,e){case"screen":t.blendFunc(t.ONE,t.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":t.blendFunc(t.ONE,t.ONE);break;case"multiply":t.blendFunc(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA);break;default:t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal";break}}restore(){if(this._matrixStack.length!==0){let e=this._colorStack.pop(),t=this._matrixStack.pop();this.currentColor.copy(e),this.currentTransform.copy(t),this.setBlendMode(this._blendStack.pop()),g.push(e),g.push(t)}if(this._scissorStack.length!==0)this.currentScissor.set(this._scissorStack.pop());else{const e=this.getCanvas();this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=e.width,this.currentScissor[3]=e.height}}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(e){this.currentTransform.rotate(e)}scale(e,t){this.currentTransform.scale(e,t)}setAntiAlias(e=!1){super.setAntiAlias(e)}setGlobalAlpha(e){this.currentColor.alpha=e}getGlobalAlpha(){return this.currentColor.alpha}setColor(e){let t=this.currentColor.alpha;this.currentColor.copy(e),this.currentColor.alpha*=t}strokeArc(e,t,i,r,n,o=!1,l=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.arc(e,t,i,r,n,o),l===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillArc(e,t,i,r,n,o=!1){this.strokeArc(e,t,i,r,n,o,!0)}strokeEllipse(e,t,i,r,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.ellipse(e,t,i,r,0,0,360),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillEllipse(e,t,i,r){this.strokeEllipse(e,t,i,r,!0)}strokeLine(e,t,i,r){if(this.setCompositor("primitive"),this.lineWidth===1)this.path2D.beginPath(),this.path2D.moveTo(e,t),this.path2D.lineTo(i,r),this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points);else if(this.lineWidth>1){const n=this.lineWidth/2,o=Math.atan2(r-t,i-e),l=Math.sin(o)*n,u=Math.cos(o)*n,h=e-l,d=t+u,a=e+l,f=t-u,c=i+l,p=r-u,y=i-l,v=r+u;this.path2D.beginPath(),this.path2D.moveTo(h,d),this.path2D.lineTo(a,f),this.path2D.lineTo(c,p),this.path2D.lineTo(y,v),this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillLine(e,t,i,r){this.strokeLine(e,t,i,r)}strokePolygon(e,t=!1){const i=e.points,r=i.length;if(this.translate(e.pos.x,e.pos.y),t===!1&&this.lineWidth>1){const n=this.lineWidth/2;for(let u=0;u<r-1;u++){const h=i[u],d=i[u+1];this.fillEllipse(d.x,d.y,n,n),this.strokeLine(h.x,h.y,d.x,d.y)}const o=i[r-1],l=i[0];o.equals(l)||(this.fillEllipse(l.x,l.y,n,n),this.strokeLine(o.x,o.y,l.x,l.y))}else{this.setCompositor("primitive"),this.path2D.beginPath();for(let n=0;n<r-1;n++){const o=i[n],l=i[n+1];this.path2D.moveTo(o.x,o.y),this.path2D.lineTo(l.x,l.y)}this.path2D.closePath(),t===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}this.translate(-e.pos.x,-e.pos.y)}fillPolygon(e){this.strokePolygon(e,!0)}strokeRect(e,t,i,r,n=!1){if(n===!1&&this.lineWidth>1){const o=this.lineWidth/2;this.strokeLine(e,t,e+i,t),this.strokeLine(e+i,t,e+i,t+r),this.strokeLine(e+i,t+r,e,t+r),this.strokeLine(e,t+r,e,t),this.fillEllipse(e,t,o,o),this.fillEllipse(e+i,t,o,o),this.fillEllipse(e+i,t+r,o,o),this.fillEllipse(e,t+r,o,o)}else this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.rect(e,t,i,r),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRect(e,t,i,r){this.strokeRect(e,t,i,r,!0)}strokeRoundRect(e,t,i,r,n,o=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.roundRect(e,t,i,r,n),o===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRoundRect(e,t,i,r,n){this.strokeRoundRect(e,t,i,r,n,!0)}strokePoint(e,t){this.strokeLine(e,t,e+1,t+1)}fillPoint(e,t){this.strokePoint(e,t)}setTransform(e,t,i,r,n,o){this.resetTransform(),this.transform(e,t,i,r,n,o)}transform(e,t,i,r,n,o){if(typeof e=="object"?this.currentTransform.multiply(e):this.currentTransform.transform(e,t,i,r,n,o),this.settings.subPixel===!1){let l=this.currentTransform.toArray();l[6]|=0,l[7]|=0}}translate(e,t){let i=this.currentTransform;if(i.translate(e,t),this.settings.subPixel===!1){let r=i.toArray();r[6]|=0,r[7]|=0}}clipRect(e,t,i,r){let n=this.getCanvas(),o=this.gl;if(e!==0||t!==0||i!==n.width||r!==n.height){let l=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&l[0]===e&&l[1]===t&&l[2]===i&&l[3]===r)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(e+this.currentTransform.tx,n.height-r-t-this.currentTransform.ty,i,r),l[0]=e,l[1]=t,l[2]=i,l[3]=r}else o.disable(o.SCISSOR_TEST)}setMask(e,t=!1){let i=this.gl;this.flush(),this.maskLevel===0&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(e),this.flush(),i.colorMask(!0,!0,!0,!0),t===!0?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}class is extends W{constructor(e,t,i){super(0,0,1/0,1/0),this.color=g.pull("Color").parseCSS(t),this.onResetEvent(e,t,i)}onResetEvent(e,t,i=0){this.name=e,this.pos.z=i,this.floating=!0,this.color.parseCSS(t)}draw(e,t){e.save(),e.clipRect(0,0,t.width,t.height),e.clearColor(this.color),e.restore()}destroy(){g.push(this.color),this.color=void 0,super.destroy()}}class ba extends Me{constructor(e,t,i){super(e,t,i),this.floating=!0,this.offset.set(e,t),this.ratio=g.pull("Vector2d",1,1),typeof i.ratio!="undefined"&&(Nl(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),typeof i.anchorPoint=="undefined"?this.anchorPoint.set(0,0):typeof i.anchorPoint=="number"?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",U(Wi,this.createPattern,this)}get repeat(){return this._repeat}set repeat(e){switch(this._repeat=e,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0;break}this.resize(M.viewport.width,M.viewport.height),this.createPattern()}onActivateEvent(){U(Tr,this.updateLayer,this),U(ct,this.resize,this),U(Yi,this.updateLayer,this),this.ancestor.root!==!0&&this.updateLayer()}resize(e,t){return super.resize(this.repeatX?1/0:e,this.repeatY?1/0:t)}createPattern(){this._pattern=G.createPattern(this.image,this._repeat)}updateLayer(){const e=this.ratio.x,t=this.ratio.y,i=M.viewport;if(e===0&&t===0)return;const r=this.width,n=this.height,o=i.bounds.width,l=i.bounds.height,u=this.anchorPoint.x,h=this.anchorPoint.y,d=u*(e-1)*(o-i.width)+this.offset.x-e*i.pos.x,a=h*(t-1)*(l-i.height)+this.offset.y-t*i.pos.y;this.repeatX?this.pos.x=d%r:this.pos.x=d,this.repeatY?this.pos.y=a%n:this.pos.y=a,this.isDirty=!0}preDraw(e){e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),e.setTint(this.tint),this.blendMode!==e.getBlendMode()&&e.setBlendMode(this.blendMode)}draw(e,t){const i=this.width,r=this.height,n=t.bounds.width,o=t.bounds.height,l=this.anchorPoint.x,u=this.anchorPoint.y;let h=this.pos.x,d=this.pos.y;this.ratio.x===0&&this.ratio.y===0&&(h=h+l*(n-i),d=d+u*(o-r)),e.translate(h,d),e.drawPattern(this._pattern,0,0,t.width*2,t.height*2)}onDeactivateEvent(){Fe(Tr,this.updateLayer),Fe(ct,this.resize),Fe(Yi,this.updateLayer)}destroy(){g.push(this.ratio),this.ratio=void 0,Fe(Wi,this.createPattern),super.destroy()}}class wa extends Me{constructor(e,t,i){if(super(e,t,i),typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(e){super.width=this.nss_width=e}get height(){return super.height}set height(e){super.height=this.nss_height=e}draw(e){let t=this.current,i=this.pos.x,r=this.pos.y,n=t.width,o=t.height,l=t.offset,u=this.offset;t.angle!==0&&(e.translate(-i,-r),e.rotate(t.angle),i-=o,n=t.height,o=t.width);let h=u.x+l.x,d=u.y+l.y,a=this.insetx||n/4,f=this.insety||o/4;e.drawImage(this.image,h,d,a,f,i,r,a,f),e.drawImage(this.image,h+n-a,d,a,f,i+this.nss_width-a,r,a,f),e.drawImage(this.image,h,d+o-f,a,f,i,r+this.nss_height-f,a,f),e.drawImage(this.image,h+n-a,d+o-f,a,f,i+this.nss_width-a,r+this.nss_height-f,a,f);let c=n-(a<<1),p=o-(f<<1),y=this.nss_width-(a<<1),v=this.nss_height-(f<<1);e.drawImage(this.image,h+a,d,c,f,i+a,r,y,f),e.drawImage(this.image,h+a,d+o-f,c,f,i+a,r+this.nss_height-f,y,f),e.drawImage(this.image,h,d+f,a,p,i,r+f,a,v),e.drawImage(this.image,h+n-a,d+f,a,p,i+this.nss_width-a,r+f,a,v),e.drawImage(this.image,h+a,d+f,c,p,i+a,r+f,y,v)}}function zr(s,e){s.font=e.font,s.fillStyle=e.fillStyle.toRGBA(),s.strokeStyle=e.strokeStyle.toRGBA(),s.lineWidth=e.lineWidth,s.textAlign=e.textAlign,s.textBaseline=e.textBaseline}const G_=["ex","em","pt","px"],j_=[12,24,.75,1];class ss extends W{constructor(e,t,i){super(e,t,i.width||0,i.height||0),this.fillStyle=g.pull("Color",0,0,0),this.strokeStyle=g.pull("Color",0,0,0),this.lineWidth=0,this.textAlign="left",this.textBaseline="top",this.lineHeight=1,this.wordWrapWidth=-1,this.fontSize=10,this._text=[],this.onResetEvent(e,t,i)}onResetEvent(e,t,i){typeof this.fillStyle=="undefined"&&(this.fillStyle=g.pull("Color",0,0,0)),typeof this.strokeStyle=="undefined"&&(this.strokeStyle=g.pull("Color",0,0,0)),typeof i.fillStyle!="undefined"&&(i.fillStyle instanceof ue?this.fillStyle.copy(i.fillStyle):this.fillStyle.parseCSS(i.fillStyle)),typeof i.strokeStyle!="undefined"&&(i.strokeStyle instanceof ue?this.strokeStyle.copy(i.strokeStyle):this.strokeStyle.parseCSS(i.strokeStyle)),this.lineWidth=i.lineWidth||0,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this.fontSize=10,typeof i.anchorPoint!="undefined"?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),typeof i.floating!="undefined"&&(this.floating=!!i.floating),this.setFont(i.font,i.size),i.bold===!0&&this.bold(),i.italic===!0&&this.italic(),this.canvasTexture=g.pull("CanvasRenderTarget",2,2,{offscreenCanvas:!1}),this.metrics=new Qh(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(e,t=10){let i=e.split(",").map(r=>(r=r.trim(),/(^".*"$)|(^'.*'$)/.test(r)?r:'"'+r+'"'));if(typeof t=="number")this.fontSize=t,t+="px";else{let r=t.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(r[1]),r[2]?this.fontSize*=j_[G_.indexOf(r[2])]:t+="px"}return this.height=this.fontSize,this.font=t+" "+i.join(","),this.isDirty=!0,this}setText(e=""){let t=this.getBounds();this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split(`
`)),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,this.canvasTexture.context)),t.addBounds(this.metrics.measureText(this._text,this.canvasTexture.context),!0);let i=Math.ceil(this.metrics.width),r=Math.ceil(this.metrics.height);return G.WebGLVersion===1&&(i=vo(this.metrics.width),r=vo(this.metrics.height)),this.canvasTexture.invalidate(G),(this.canvasTexture.width<i||this.canvasTexture.height<r)&&this.canvasTexture.resize(i,r),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y),this.isDirty=!0,this}measureText(e,t=this._text){return this.metrics.measureText(t,this.canvasTexture.context)}draw(e,t,i=this.pos.x,r=this.pos.y){typeof this.ancestor=="undefined"&&((this.pos.x!==i||this.pos.y!==r)&&(this.pos.x=i,this.pos.y=r,this.isDirty=!0),this.setText(t),e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity())),i=this.metrics.x,r=this.metrics.y,e.settings.subPixel===!1&&(i=~~i,r=~~r),e.drawImage(this.canvasTexture.canvas,i,r),typeof this.ancestor=="undefined"&&e.restore()}drawStroke(e,t,i,r){this.draw(e,t,i,r)}_drawFont(e,t,i,r){zr(e,this);for(let n=0;n<t.length;n++){const o=t[n].trimEnd();this.fillStyle.alpha>0&&e.fillText(o,i,r),this.lineWidth>0&&this.strokeStyle.alpha>0&&e.strokeText(o,i,r),r+=this.metrics.lineHeight()}return this.metrics}destroy(){typeof G.gl!="undefined"&&(G.setCompositor("quad"),G.currentCompositor.deleteTexture2D(G.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),G.cache.delete(this.canvasTexture.canvas),g.push(this.canvasTexture),this.canvasTexture=void 0,g.push(this.fillStyle),g.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Qh extends de{constructor(e){super(),this.ancestor=e,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof ss?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(e,t){if(this.ancestor instanceof ss)return t.measureText(e).width;{let i=e.split("");const r=i.length;let n=0,o=null;for(let l=0;l<r;l++){let u=i[l].charCodeAt(0),h=this.ancestor.fontData.glyphs[u];if(typeof h!="undefined"){let d=o&&o.kerning?o.getKerning(u):0;n+=(h.xadvance+d)*this.ancestor.fontScale.x,o=h}}return n}}measureText(e,t){let i;Array.isArray(e)?i=e:i=(""+e).split(`
`),typeof t!="undefined"&&(t.save(),zr(t,this.ancestor)),this.width=this.height=0;for(let r=0;r<i.length;r++)this.width=Math.max(this.lineWidth(i[r].trimEnd(),t),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor(this.ancestor.textAlign==="right"?this.ancestor.pos.x-this.width:this.ancestor.textAlign==="center"?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(this.ancestor.textBaseline.search(/^(top|hanging)$/)===0?this.ancestor.pos.y:this.ancestor.textBaseline==="middle"?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),typeof t!="undefined"&&t.restore(),this}wordWrap(e,t,i){let r,n="",o=[];Array.isArray(e)&&(e=e.join(" ")),r=e.replace(/[\r\n]+/g," ").split(" "),typeof i!="undefined"&&(i.save(),zr(i,this.ancestor));for(let l=0;l<r.length;l++){let u=r[l];this.lineWidth(n+u+" ",i)<t?n+=u+" ":(o.push(n+`
`),n=u+" ")}return o.push(n),typeof i!="undefined"&&i.restore(),o}}class Ta extends W{constructor(e,t,i){super(e,t,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=g.pull("Vector2d",1,1),this.fontImage=typeof i.font=="object"?i.font:Re(i.font),typeof i.fontData!="string"?this.fontData=g.pull("BitmapTextData",$r(i.font)):this.fontData=g.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:$r(i.fontData)),typeof i.floating!="undefined"&&(this.floating=!!i.floating),typeof i.fillStyle!="undefined"&&(this.fillStyle=i.fillStyle),typeof i.anchorPoint!="undefined"?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Qh(this),typeof i.size=="number"&&i.size!==1&&this.resize(i.size),this.setText(i.text)}set(e,t){return this.textAlign=e,t&&this.resize(t),this.isDirty=!0,this}setText(e=""){return this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split(`
`),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.updateBounds(),this}updateBounds(e=!0){let t=this.getBounds();if(t.clear(),typeof this.metrics!="undefined"){let i,r;switch(t.addBounds(this.metrics.measureText(this._text)),this.textAlign){case"right":i=this.metrics.width*1;break;case"center":i=this.metrics.width*.5;break;default:i=0;break}switch(this.textBaseline){case"middle":r=this.metrics.height*.5;break;case"ideographic":case"alphabetic":case"bottom":r=this.metrics.height*1;break;default:r=0;break}t.translate(i,r)}return e===!0&&typeof this.ancestor!="undefined"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&t.translate(this.ancestor.getAbsolutePosition()),t}get fillStyle(){return this.tint}set fillStyle(e){e instanceof ue?this.tint.copy(e):this.tint.parseCSS(e)}resize(e){return this.fontScale.set(e,e),this.updateBounds(),this.isDirty=!0,this}measureText(e=this._text){return this.metrics.measureText(e)}draw(e,t,i,r){let n=e.globalAlpha();typeof this.ancestor=="undefined"?(this.setText(t),e.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,r=this.pos.y);let o=i,l=this.metrics.lineHeight(),u=0;for(let h=0;h<this._text.length;h++){i=o;const d=this._text[h].trimEnd();let a=this.metrics.lineWidth(d);switch(this.textAlign){case"right":i-=a;break;case"center":i-=a*.5;break}switch(this.textBaseline){case"middle":r-=l*.5;break;case"ideographic":case"alphabetic":case"bottom":r-=l;break}this.isDirty===!0&&typeof this.ancestor=="undefined"&&(h===0&&(this.pos.y=r),u<a&&(u=a,this.pos.x=i));let f=null;for(let c=0,p=d.length;c<p;c++){let y=d.charCodeAt(c),v=this.fontData.glyphs[y];if(typeof v!="undefined"){let m=v.width,_=v.height,x=f&&f.kerning?f.getKerning(y):0,b=this.fontScale.x,E=this.fontScale.y;m!==0&&_!==0&&e.drawImage(this.fontImage,v.x,v.y,m,_,i+v.xoffset*b,r+v.yoffset*E,m*b,_*E),i+=(v.xadvance+x)*b,f=v}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(y))}r+=l}typeof this.ancestor=="undefined"&&e.setGlobalAlpha(n),this.isDirty=!1}destroy(){g.push(this.fontScale),this.fontScale=void 0,g.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Ea extends Me{constructor(e,t,i){super(e,t,i),this.name=i.name,this.type=i.type,this.id=i.id;let r=i.shapes;typeof r=="undefined"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new he(this,r),this.body.collisionType=Q.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Q.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class Aa extends W{constructor(e,t,i){super(e,t,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(n=>{typeof i[n]!="undefined"&&(this.triggerSettings[n]=i[n])});let r=i.shapes;typeof r=="undefined"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new he(this,r),this.body.collisionType=Q.types.ACTION_OBJECT,this.body.setCollisionMask(Q.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){let e=this.ancestor.getRootAncestor();return typeof this.triggerSettings.container=="string"&&(this.triggerSettings.container=e.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){let e=this.ancestor.getRootAncestor();hi.load(this.gotolevel,this.getTriggerSettings()),e.app.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){let e=this.getTriggerSettings(),t=this.ancestor.getRootAncestor();if(e.event==="level")this.gotolevel=e.to,this.fade&&this.duration?this.fading||(this.fading=!0,t.app.viewport.fadeIn(this.fade,this.duration,()=>this.onFadeComplete())):hi.load(this.gotolevel,e);else throw new Error("Trigger invalid type")}onCollision(e,t){return this.name==="Trigger"&&this.triggerEvent.apply(this),!1}}function X_(s){let e=s.texture.context,t=s.texture.width/2,i=s.texture.height/2,r=s.radiusX,n=s.radiusY,o,l,u,h,d;s.texture.clear(),r>=n?(o=1,u=1,l=n/r,h=r/n,d=e.createRadialGradient(t,i*h,0,t,n*h,r)):(l=1,h=1,o=r/n,u=n/r,d=e.createRadialGradient(t*u,i,0,t*u,i,n)),d.addColorStop(0,s.color.toRGBA(s.intensity)),d.addColorStop(1,s.color.toRGBA(0)),e.fillStyle=d,e.setTransform(o,0,0,l,0,0),e.fillRect(0,0,s.texture.width*u,s.texture.height*h)}class Sa extends W{constructor(e,t,i,r=i,n="#FFF",o=.7){super(e,t,i*2,r*2),this.color=g.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=r,this.intensity=o,this.blendMode="lighter",this.visibleArea=g.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=g.pull("CanvasRenderTarget",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),X_(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}update(e){return!0}draw(e,t){e.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){g.push(this.color),this.color=void 0,g.push(this.texture),this.texture=void 0,g.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}const qt=9,Ca=1<<qt;class Jh{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(e){if(this.kerning){let t=this.kerning[e>>>qt];if(t)return t[e&Ca-1]||0}return 0}setKerning(e,t){this.kerning||(this.kerning={});let i=this.kerning[e>>>qt];typeof i=="undefined"&&(this.kerning[e>>>qt]={},i=this.kerning[e>>>qt]),i[e&Ca-1]=t}}const Pa=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function Ra(s,e){let t=s.match(e);if(!t)throw new Error("Could not find pattern "+e+" in string: "+s);return t[0].split("=")[1]}function H_(s){let e=Object.keys(s);for(let t=0;t<e.length;t++)if(e[t]>32)return s[e[t]];return null}function Y_(s){let e=32,t=s[e];t||(t=new Jh,t.id=e,t.xadvance=H_(s).xadvance,s[e]=t)}class Ia{constructor(e){this.onResetEvent(e)}onResetEvent(e){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(e)}parse(e){if(!e)throw new Error("File containing font data was empty, cannot load the bitmap font.");let t=e.split(/\r\n|\n/),i=e.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");let r=i[0].split("=")[1].split(",");this.padTop=parseFloat(r[0]),this.padLeft=parseFloat(r[1]),this.padBottom=parseFloat(r[2]),this.padRight=parseFloat(r[3]),this.lineHeight=parseFloat(Ra(t[1],/lineHeight\=\d+/g));let n=parseFloat(Ra(t[1],/base\=\d+/g)),o=this.padTop+this.padBottom,l=null;for(let h=4;h<t.length;h++){let d=t[h],a=d.split(/=|\s+/);if(!(!d||/^kernings/.test(d)))if(/^kerning\s/.test(d)){let f=parseFloat(a[2]),c=parseFloat(a[4]),p=parseFloat(a[6]);l=this.glyphs[f],l!==null&&typeof l!="undefined"&&l.setKerning(c,p)}else{l=new Jh;let f=parseFloat(a[2]);l.id=f,l.x=parseFloat(a[4]),l.y=parseFloat(a[6]),l.width=parseFloat(a[8]),l.height=parseFloat(a[10]),l.xoffset=parseFloat(a[12]),l.yoffset=parseFloat(a[14]),l.xadvance=parseFloat(a[16]),l.width>0&&l.height>0&&(this.descent=Math.min(n+l.yoffset,this.descent)),this.glyphs[f]=l}}this.descent+=this.padBottom,Y_(this.glyphs);let u=null;for(let h=0;h<Pa.length;h++){let d=Pa[h];if(u=this.glyphs[d.charCodeAt(0)],u)break}if(u)this.capHeight=u.height;else for(let h in this.glyphs)if(this.glyphs.hasOwnProperty(h)){if(l=this.glyphs[h],l.height===0||l.width===0)continue;this.capHeight=Math.max(this.capHeight,l.height)}this.capHeight-=o}}const Gr=-1,W_=0,jr=1;let F=[];for(let s=0;s<10;s++)F.push(new B);let st=[];for(let s=0;s<5;s++)st.push([]);function Oa(s,e,t){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=s.length;for(let o=0;o<n;o++){const l=s[o].dot(e);l<i&&(i=l),l>r&&(r=l)}t[0]=i,t[1]=r}function Ma(s,e,t,i,r,n){let o=st.pop(),l=st.pop(),u=F.pop().copy(e).sub(s),h=u.dot(r);if(Oa(t,r,o),Oa(i,r,l),l[0]+=h,l[1]+=h,o[0]>l[1]||l[0]>o[1])return F.push(u),st.push(o),st.push(l),!0;if(n){let d=0;if(o[0]<l[0])if(n.aInB=!1,o[1]<l[1])d=o[1]-l[0],n.bInA=!1;else{let f=o[1]-l[0],c=l[1]-o[0];d=f<c?f:-c}else if(n.bInA=!1,o[1]>l[1])d=o[0]-l[1],n.aInB=!1;else{let f=o[1]-l[0],c=l[1]-o[0];d=f<c?f:-c}let a=Math.abs(d);a<n.overlap&&(n.overlap=a,n.overlapN.copy(r),d<0&&n.overlapN.negateSelf())}return F.push(u),st.push(o),st.push(l),!1}function ir(s,e){let t=s.length2(),i=e.dot(s);return i<0?Gr:i>t?jr:W_}function K_(s,e,t,i,r){let n=e.points,o=e.normals,l=o.length,u=i.points,h=i.normals,d=h.length,a=F.pop().copy(s.pos).add(s.ancestor.getAbsolutePosition()).add(e.pos),f=F.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(i.pos);for(let c=0;c<l;c++)if(Ma(a,f,n,u,o[c],r))return F.push(a),F.push(f),!1;for(let c=0;c<d;c++)if(Ma(a,f,n,u,h[c],r))return F.push(a),F.push(f),!1;return r&&(r.a=s,r.b=t,r.overlapV.copy(r.overlapN).scale(r.overlap)),F.push(a),F.push(f),!0}function q_(s,e,t,i,r){let n=F.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(e.pos),o=e.radius,l=i.radius,u=o+l,h=u*u,d=n.length2();if(d>h)return F.push(n),!1;if(r){let a=Math.sqrt(d);r.a=s,r.b=t,r.overlap=u-a,r.overlapN.copy(n.normalize()),r.overlapV.copy(n).scale(r.overlap),r.aInB=o<=l&&a<=l-o,r.bInA=l<=o&&a<=o-l}return F.push(n),!0}function eu(s,e,t,i,r){let n=F.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(e.pos),o=i.radius,l=o*o,u=e.points,h=e.edges,d=h.length,a=F.pop(),f=F.pop(),c=F.pop(),p=0;for(let y=0;y<d;y++){const v=y===d-1?0:y+1,m=y===0?d-1:y-1;let _=0,x=null;a.copy(h[y]),c.copy(n).sub(u[y]),r&&c.length2()>l&&(r.aInB=!1);let b=ir(a,c),E=!0;if(b===Gr){let S=null;if(d>1&&(a.copy(h[m]),S=F.pop().copy(n).sub(u[m]),b=ir(a,S),b!==jr&&(E=!1)),E){if(p=c.length(),p>o)return F.push(n),F.push(a),F.push(f),F.push(c),S&&F.push(S),!1;r&&(r.bInA=!1,x=c.normalize(),_=o-p)}S&&F.push(S)}else if(b===jr){if(d>1&&(a.copy(h[v]),c.copy(n).sub(u[v]),b=ir(a,c),b!==Gr&&(E=!1)),E){if(p=c.length(),p>o)return F.push(n),F.push(a),F.push(f),F.push(c),!1;r&&(r.bInA=!1,x=c.normalize(),_=o-p)}}else{f.copy(e.normals[y]),p=c.dot(f);let S=Math.abs(p);if((d===1||p>0)&&S>o)return F.push(n),F.push(a),F.push(f),F.push(c),!1;r&&(x=f,_=o-p,(p>=0||_<2*o)&&(r.bInA=!1))}x&&r&&Math.abs(_)<Math.abs(r.overlap)&&(r.overlap=_,r.overlapN.copy(x))}return r&&(r.a=s,r.b=t,r.overlapV.copy(r.overlapN).scale(r.overlap)),F.push(n),F.push(a),F.push(f),F.push(c),!0}function Z_(s,e,t,i,r){let n=eu(t,i,s,e,r);if(n&&r){let o=r.a,l=r.aInB;r.overlapN.negateSelf(),r.overlapV.negateSelf(),r.a=r.b,r.b=o,r.aInB=r.bInA,r.bInA=l}return n}var La={__proto__:null,testEllipseEllipse:q_,testEllipsePolygon:Z_,testPolygonEllipse:eu,testPolygonPolygon:K_};class Q_{constructor(){this.a=null,this.b=null,this.overlapN=new B,this.overlapV=new B,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}let J_={pos:new B(0,0),ancestor:{_absPos:new B(0,0),getAbsolutePosition:function(){return this._absPos}}},sr=new de,rr=new de;class ex{constructor(e){this.world=e,this.response=new Q_}shouldCollide(e,t){let i=e.body,r=t.body;return typeof i=="object"&&typeof r=="object"&&e!==t&&e.isKinematic!==!0&&t.isKinematic!==!0&&i.shapes.length>0&&r.shapes.length>0&&!(i.isStatic===!0&&r.isStatic===!0)&&(i.collisionMask&r.collisionType)!==0&&(i.collisionType&r.collisionMask)!==0}collides(e,t,i=this.response){for(let r=e.shapes.length,n;r--,n=e.shapes[r];)for(let o=t.shapes.length,l;o--,l=t.shapes[o];)if(La["test"+n.type+l.type].call(this,e.ancestor,n,t.ancestor,l,i.clear())===!0)return i.indexShapeA=r,i.indexShapeB=o,!0;return!1}collisions(e){let t=0,i=this.world.broadphase.retrieve(e);return sr.addBounds(e.getBounds(),!0),sr.addBounds(e.body.getBounds()),i.forEach(r=>{this.shouldCollide(e,r)&&(rr.addBounds(r.getBounds(),!0),rr.addBounds(r.body.getBounds()),sr.overlaps(rr)&&this.collides(e.body,r.body)&&(t++,e.onCollision&&e.onCollision(this.response,r)!==!1&&e.body.isStatic===!1&&e.body.respondToCollision.call(e.body,this.response),r.onCollision&&r.onCollision(this.response,e)!==!1&&r.body.isStatic===!1&&r.body.respondToCollision.call(r.body,this.response)))}),t>0}rayCast(e,t=[]){let i=0,r=this.world.broadphase.retrieve(e);for(let n=r.length,o;n--,o=r[n];)if(o.body&&e.getBounds().overlaps(o.getBounds())){const l=o.body.shapes.length;if(o.body.shapes.length===0)continue;let u=e,h=0;do{let d=o.body.getShape(h);La["test"+u.type+d.type].call(this,J_,u,o,d)&&(t[i]=o,i++),h++}while(h<l)}return t.length=i,t}}class tx extends ye{constructor(e=0,t=0,i=1/0,r=1/0){super(e,t,i,r,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=void 0,this.physic="builtin",this.fps=60,this.gravity=new B(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Rl(this,this.getBounds().clone(),Q.maxChildren,Q.maxDepth),this.detector=new ex(this),U(pi,this.reset,this),U(Yi,()=>{this.broadphase.clear(this.getBounds())})}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(e){return this.physic==="builtin"&&this.bodies.add(e),this}removeBody(e){return this.physic==="builtin"&&this.bodies.delete(e),this}bodyApplyGravity(e){if(!e.ignoreGravity&&e.gravityScale!==0){let t=this.gravity;e.force.x+=e.mass*t.x*e.gravityScale,e.force.y+=e.mass*t.y*e.gravityScale}}update(e){return(this.physic==="builtin"||Ah()===!0)&&(this.broadphase.clear(),this.broadphase.insertContainer(this)),this.step(e),super.update(e)}step(e){if(this.physic==="builtin"){let t=V.isPaused();this.bodies.forEach(i=>{if(!i.isStatic){let r=i.ancestor;!(t&&!r.updateWhenPaused)&&(r.inViewport||r.alwaysUpdate)&&(this.bodyApplyGravity(i),i.update(e)===!0&&(r.isDirty=!0),this.detector.collisions(r),i.force.set(0,0))}})}D(tg,e)}}class Ba extends W{constructor(e){super(e.getRandomPointX(),e.getRandomPointY(),e.settings.image.width,e.settings.image.height),this.onResetEvent(e,!0)}onResetEvent(e,t=!1){t===!1?(this.pos.set(e.getRandomPointX(),e.getRandomPointY()),this.resize(e.settings.image.width,e.settings.image.height),this.currentTransform.identity()):this.vel=g.pull("Vector2d"),this.image=e.settings.image,this.alwaysUpdate=!0,typeof e.settings.tint=="string"&&this.tint.parseCSS(e.settings.tint),e.settings.textureAdditive===!0&&(this.blendMode="additive"),e.settings.blendMode!=="normal"&&(this.blendMode=e.settings.blendMode);let i=e.settings.angle+(e.settings.angleVariation>0?(Tt(0,2)-1)*e.settings.angleVariation:0),r=e.settings.speed+(e.settings.speedVariation>0?(Tt(0,2)-1)*e.settings.speedVariation:0);this.vel.set(r*Math.cos(i),-r*Math.sin(i)),this.life=Tt(e.settings.minLife,e.settings.maxLife),this.startLife=this.life,this.startScale=P(Tt(e.settings.minStartScale,e.settings.maxStartScale),e.settings.minStartScale,e.settings.maxStartScale),this.endScale=P(Tt(e.settings.minEndScale,e.settings.maxEndScale),e.settings.minEndScale,e.settings.maxEndScale),this.gravity=e.settings.gravity,this.wind=e.settings.wind,this.followTrajectory=e.settings.followTrajectory,this.onlyInViewport=e.settings.onlyInViewport,this._deltaInv=le.maxfps/1e3,e.settings.followTrajectory||(this.angle=Tt(e.settings.minRotation,e.settings.maxRotation))}update(e){let t=e*this._deltaInv;if(this.life=this.life>e?this.life-e:0,this.life<=0)return this.ancestor.removeChild(this),!1;let i=this.life/this.startLife,r=this.startScale;this.startScale>this.endScale?(r*=i,r=r<this.endScale?this.endScale:r):this.startScale<this.endScale&&(r/=i,r=r>this.endScale?this.endScale:r),this.alpha=i,this.vel.x+=this.wind*t,this.vel.y+=this.gravity*t;let n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t,this.currentTransform.setTransform(r,0,0,0,r,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(e)}draw(e){let t=this.width,i=this.height;e.drawImage(this.image,0,0,t,i,-t/2,-i/2,t,i)}}class Xr extends W{constructor(e,t,i){if(typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(e,t,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new Me(0,0,i)),i.anchorPoint?this.anchorPoint.setMuted(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.setMuted(0,0),typeof i.name=="string"&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,typeof i.shapes=="undefined"&&(i.shapes=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])),this.body=new he(this,i.shapes,()=>this.onBodyUpdate()),this.width===0&&this.height===0&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(e){if(e instanceof W)this.children[0]=e,this.children[0].ancestor=this,this.updateBounds();else throw new Error(e+"should extend me.Renderable")}update(e){return this.renderable&&(this.isDirty|=this.renderable.update(e)),super.update(e)}updateBounds(e=!0){let t=this.getBounds();if(t.clear(),t.addFrame(0,0,this.width,this.height),this.children&&this.children.length>0&&t.addBounds(this.children[0].getBounds()),this.body&&t.addBounds(this.body.getBounds()),e===!0){let i=this.getAbsolutePosition();t.centerOn(i.x+t.x+t.width/2,i.y+t.y+t.height/2)}return t}onBodyUpdate(){this.updateBounds()}preDraw(e){e.save(),e.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof W&&e.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(e,t){let i=this.renderable;i instanceof W&&(i.preDraw(e),i.draw(e,t),i.postDraw(e))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function ix(s){try{if(fh(s))return new Zh(s)}catch(e){console.log("Error creating WebGL renderer :"+e.message)}return new Ts(s)}function sx(s,e,t){let i=s.renderer,r=i.getCanvas(),n=i.getContext(),o=i.settings,l=pn,u=o.zoomX=r.width*e*l,h=o.zoomY=r.height*t*l;i.scaleRatio.set(e*l,t*l),r.style.width=u/l+"px",r.style.height=h/l+"px",i.setAntiAlias(n,o.antiAlias),i.setBlendMode(o.blendMode,n),s.repaint()}function ki(s){let e=s.renderer,t=e.settings,i=t.scale,r=t.scale,n;if(t.autoScale){let o=1/0,l=1/0;if(globalThis.getComputedStyle){let a=globalThis.getComputedStyle(e.getCanvas(),null);o=parseInt(a.maxWidth,10)||1/0,l=parseInt(a.maxHeight,10)||1/0}typeof s.settings.scaleTarget!="undefined"?n=ps(s.settings.scaleTarget):n=uh(s.getParentElement());let u=Math.min(o,n.width),h=Math.min(l,n.height),d=u/h;if(t.scaleMethod==="fill-min"&&d>e.designRatio||t.scaleMethod==="fill-max"&&d<e.designRatio||t.scaleMethod==="flex-width"){let a=Math.min(o,t.height*d);i=r=u/a,e.resize(Math.floor(a),t.height)}else if(t.scaleMethod==="fill-min"&&d<e.designRatio||t.scaleMethod==="fill-max"&&d>e.designRatio||t.scaleMethod==="flex-height"){let a=Math.min(l,t.width*(h/u));i=r=h/a,e.resize(t.width,Math.floor(a))}else t.scaleMethod==="flex"?e.resize(Math.floor(u),Math.floor(h)):t.scaleMethod==="stretch"?(i=u/t.width,r=h/t.height):d<e.designRatio?i=r=u/t.width:i=r=h/t.height}sx(s,i,r)}function rx(s){let e=s.renderer.type,t=typeof s.renderer.GPURenderer=="string"?" ("+s.renderer.GPURenderer+")":"",i=e.includes("WebGL")&&s.renderer.depthTest==="z-buffer"?"Depth Test | ":"",r=dn?"Web Audio":"HTML5 Audio";console.log(e+" renderer"+t+" | "+i+r+" | pixel ratio "+pn+" | "+(ni.nodeJS?"node.js":ni.isMobile?"mobile":"desktop")+" | "+ds()+" | "+eh),console.log("resolution: requested "+s.settings.width+"x"+s.settings.height+", got "+s.renderer.width+"x"+s.renderer.height)}class nx{constructor(e,t,i){this.parentElement=void 0,this.renderer=void 0,this.viewport=void 0,this.world=void 0,this.mergeGroup=!0,this.lastUpdate=0,this.isInitialized=!1,this.settings=void 0,this.pauseOnBlur=!0,this.resumeOnFocus=!0,this.stopOnBlur=!1,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0,i.legacy!==!0&&this.init(e,t,i)}init(e,t,i){this.settings=Object.assign(dh,i||{}),this.settings.width=e,this.settings.height=t,this.settings.transparent=!!this.settings.transparent,this.settings.antiAlias=!!this.settings.antiAlias,this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat,this.settings.depthTest=this.settings.depthTest==="z-buffer"?"z-buffer":"sorting",this.settings.subPixel=!!this.settings.subPixel,this.settings.verbose=!!this.settings.verbose,this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)!==-1?this.settings.autoScale=this.settings.scale==="auto"||!0:(this.settings.scaleMethod="fit",this.settings.autoScale=this.settings.scale==="auto"||!1);let r=Uh();if(r.webgl===!0||r.webgl1===!0||r.webgl2===!0?(this.settings.renderer=Cr,r.webgl1===!0&&(this.settings.preferWebGL1=!0)):r.canvas===!0&&(this.settings.renderer=ph),this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1,this.settings.zoomX=e*this.settings.scale,this.settings.zoomY=t*this.settings.scale,this.parentElement=Zi(this.settings.parent),typeof this.settings.scaleTarget!="undefined"&&(this.settings.scaleTarget=Zi(this.settings.scaleTarget)),typeof this.settings.renderer=="number")switch(this.settings.renderer){case gh:case Cr:this.renderer=ix(this.settings);break;default:this.renderer=new Ts(this.settings);break}else{let n=this.settings.renderer;this.renderer=new n(this.settings)}U(Bl,()=>ki(this),this),U(Ui,()=>ki(this),this),this.parentElement.appendChild(this.renderer.getCanvas()),ni.isMobile&&lh(!1),ki(this),"MutationObserver"in globalThis&&new MutationObserver(()=>ki(this)).observe(this.parentElement,{attributes:!1,childList:!0,subtree:!0}),this.settings.consoleHeader!==!1&&rx(this),this.world=new tx(0,0,this.settings.width,this.settings.height),this.world.app=this,this.world.physic=this.settings.physic,this.lastUpdate=globalThis.performance.now(),this.world.autoSort=!(this.renderer.type==="WEBGL"&&this.settings.depthTest==="z-buffer"),this.isInitialized=!0,D(qp,this),U(an,this.repaint,this),U(on,this.repaint,this),U(ri,this.repaint,this),U(Ll,this.reset,this),U(Ml,n=>{this.update(n),this.draw()},this),U(_r,()=>{this.stopOnBlur===!0&&V.stop(!0),this.pauseOnBlur===!0&&V.pause(!0)}),U(xr,()=>{this.stopOnBlur===!0&&V.restart(!0),this.resumeOnFocus===!0&&V.resume(!0)})}reset(){let e=V.get();typeof e!="undefined"&&(this.viewport=e.cameras.get("default")),D(pi),this.updateFrameRate()}get sortOn(){return this.world.sortOn}set sortOn(e){this.world.sortOn=e}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/le.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=this.stepSize*10,this.isAlwaysDirty=le.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=!0}update(e){if(++this.frameCounter%this.frameRate===0){for(this.frameCounter=0,D(hn,e),this.accumulator+=le.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=le.interpolation?le.getDelta():this.stepSize,this.accumulatorUpdateDelta=le.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||le.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),V.isPaused()!==!0&&D(Qp,e),this.isDirty=this.world.update(this.updateDelta),this.isDirty=V.current().update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,le.interpolation){this.accumulator=0;break}D(Zp,this.lastUpdate)}}draw(){this.renderer.isContextValid===!0&&(this.isDirty||this.isAlwaysDirty)&&(D(Jp,globalThis.performance.now()),this.renderer.clear(),V.current().draw(this.renderer,this.world),this.isDirty=!1,this.renderer.flush(),D(eg,globalThis.performance.now()))}}Object.defineProperty(bt.prototype,"Texture",{get:function(){return Ve("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),ws}});bt.prototype.getScreenCanvas=function(){return Ve("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()};bt.prototype.getScreenContext=function(){return Ve("getScreenContext","getContext","13.1.0"),this.getContext()};bt.prototype.getWidth=function(){return Ve("getWidth","width","15.12.0"),this.width};bt.prototype.getHeight=function(){return Ve("getHeight","height","15.12.0"),this.height};Ts.prototype.setLineWidth=function(s){Ve("setLineWidth","lineWidth","17.3.0"),this.lineWidth=s};Zh.prototype.setLineWidth=function(s){Ve("setLineWidth","lineWidth","17.3.0"),this.lineWidth=s};const ox="17.4.0";let Hr=!1;const M=new nx(0,0,{legacy:!0});function ax(){Hr!==!0&&(console.log("melonJS 2 (v"+ox+") | http://melonjs.org"),g.register("me.Entity",Xr),g.register("me.Collectable",Ea),g.register("me.Trigger",Aa),g.register("me.Light2d",Sa),g.register("me.Tween",xa,!0),g.register("me.Color",ue,!0),g.register("me.Particle",Ba,!0),g.register("me.Sprite",Me),g.register("me.NineSliceSprite",wa),g.register("me.Renderable",W),g.register("me.Text",ss,!0),g.register("me.BitmapText",Ta),g.register("me.BitmapTextData",Ia,!0),g.register("me.ImageLayer",ba),g.register("me.ColorLayer",is,!0),g.register("me.Vector2d",B,!0),g.register("me.Vector3d",De,!0),g.register("me.ObservableVector2d",Ne,!0),g.register("me.ObservableVector3d",ke,!0),g.register("me.Matrix2d",Qt,!0),g.register("me.Matrix3d",Gi,!0),g.register("me.Rect",xe,!0),g.register("me.RoundRect",Xi,!0),g.register("me.Polygon",Ke,!0),g.register("me.Line",ji,!0),g.register("me.Point",si,!0),g.register("me.Ellipse",ii,!0),g.register("me.Bounds",de,!0),g.register("Entity",Xr),g.register("Collectable",Ea),g.register("Trigger",Aa),g.register("Light2d",Sa),g.register("Tween",xa,!0),g.register("Color",ue,!0),g.register("Particle",Ba,!0),g.register("Sprite",Me),g.register("NineSliceSprite",wa),g.register("Renderable",W),g.register("Text",ss,!0),g.register("BitmapText",Ta),g.register("BitmapTextData",Ia,!0),g.register("ImageLayer",ba),g.register("ColorLayer",is,!0),g.register("Vector2d",B,!0),g.register("Vector3d",De,!0),g.register("ObservableVector2d",Ne,!0),g.register("ObservableVector3d",ke,!0),g.register("Matrix2d",Qt,!0),g.register("Matrix3d",Gi,!0),g.register("Rect",xe,!0),g.register("RoundRect",Xi,!0),g.register("Polygon",Ke,!0),g.register("Line",ji,!0),g.register("Point",si,!0),g.register("Ellipse",ii,!0),g.register("Bounds",de,!0),g.register("CanvasRenderTarget",Nr,!0),D(hs),Dn(Uh().nocache||!1),_h(),Hr=!0)}ah(()=>{ax()});class tu extends Me{constructor(e,t){super(e,t,{image:"player"}),this.resize(32,32),this.body=new he(this),this.body.addShape(new xe(0,0,this.width,this.height)),typeof this.body.setCollisionType=="function"?this.body.setCollisionType(Q.types.PLAYER_OBJECT):this.body.collisionType=Q.types.PLAYER_OBJECT,typeof this.body.setCollisionMask=="function"&&this.body.setCollisionMask(Q.types.WORLD_SHAPE|Q.types.ACTION_OBJECT|Q.types.COLLECTABLE_OBJECT),this.body.setMaxVelocity(2,2),this.body.setFriction(0,0),this.alwaysUpdate=!0}update(e){return this.body.vel.set(0,0),A.isKeyPressed("left")&&(this.body.vel.x=-this.body.maxVel.x),A.isKeyPressed("right")&&(this.body.vel.x=this.body.maxVel.x),A.isKeyPressed("up")&&(this.body.vel.y=-this.body.maxVel.y),A.isKeyPressed("down")&&(this.body.vel.y=this.body.maxVel.y),this.body.update(e),super.update(e)}onCollision(){const e=Array.from(arguments);console.log("Player.onCollision called",e);let t=e[0]||null,i=null;if(e.length===1?i=t&&t.body?t.body.owner:null:e.length>=2&&(i=e[1]),i&&(console.log("Player collided with",i.constructor?i.constructor.name:i),typeof i.onCollision=="function"))try{i.onCollision(t,this)}catch(r){console.error("Error calling other.onCollision",r)}return!1}}class lx extends xi{onResetEvent(){M.world.addChild(new is("bg","#202025"),0),A.bindKey(A.KEY.LEFT,"left"),A.bindKey(A.KEY.A,"left"),A.bindKey(A.KEY.RIGHT,"right"),A.bindKey(A.KEY.D,"right"),A.bindKey(A.KEY.UP,"up"),A.bindKey(A.KEY.W,"up"),A.bindKey(A.KEY.DOWN,"down"),A.bindKey(A.KEY.S,"down"),M.world.gravity.set(0,0);const e=new tu(100,100);M.world.addChild(e,10),M.viewport.follow(e.pos,M.viewport.AXIS.BOTH,.15)}onDestroyEvent(){A.unbindKey(A.KEY.LEFT),A.unbindKey(A.KEY.A),A.unbindKey(A.KEY.RIGHT),A.unbindKey(A.KEY.D),A.unbindKey(A.KEY.UP),A.unbindKey(A.KEY.W),A.unbindKey(A.KEY.DOWN),A.unbindKey(A.KEY.S)}}const hx=[{name:"player",type:"image",src:"data/img/player.jpg"}];class ux extends W{constructor(e,t,i,r,n="#cc4444"){super(e,t,i,r),this.anchorPoint.set(0,0),this.floating=!1,this.color=n}draw(e){e.save(),e.setColor(this.color),e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}}class fx extends Xr{constructor(e,t,i,r,n="#cc4444",o){super(e,t,{width:i,height:r}),this.anchorPoint.set(0,0),this.floating=!1,this.color=n,this.stage=o,this.body=new he(this),this.body.addShape(new xe(0,0,this.width,this.height)),this.body.setStatic(!0),typeof this.body.setCollisionType=="function"?this.body.setCollisionType(Q.types.WORLD_SHAPE):this.body.collisionType=Q.types.WORLD_SHAPE,typeof this.body.setCollisionMask=="function"&&this.body.setCollisionMask(Q.types.PLAYER_OBJECT)}draw(e){e.save(),e.setColor(this.color),e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}onCollision(e,t){return console.log("Door.onCollision",{door:this,other:t}),typeof this.stage=="string"&&V.change(this.stage),!1}}class cx extends xi{onResetEvent(){M.world.addChild(new is("bg","#bfbfd2ff"),0),A.bindKey(A.KEY.LEFT,"left"),A.bindKey(A.KEY.A,"left"),A.bindKey(A.KEY.RIGHT,"right"),A.bindKey(A.KEY.D,"right"),A.bindKey(A.KEY.UP,"up"),A.bindKey(A.KEY.W,"up"),A.bindKey(A.KEY.DOWN,"down"),A.bindKey(A.KEY.S,"down"),M.world.gravity.set(0,0);const e=new tu(100,100);M.world.addChild(e,10);const t=new ux(20,20,120,80,"#55aaff"),i=new fx(400,200,80,120,"#ffaa55","play");M.world.addChild(t,5),M.world.addChild(i,5)}onDestroyEvent(){A.unbindKey(A.KEY.LEFT),A.unbindKey(A.KEY.A),A.unbindKey(A.KEY.RIGHT),A.unbindKey(A.KEY.D),A.unbindKey(A.KEY.UP),A.unbindKey(A.KEY.W),A.unbindKey(A.KEY.DOWN),A.unbindKey(A.KEY.S)}}Wg.onReady(()=>{Co.init(960,540,{parent:"screen",scale:"auto",renderer:Co.AUTO}),R_.preload(hx,()=>{V.set(V.PLAY,new lx),V.set(V.ROOM,new cx),V.change(V.ROOM)})});
